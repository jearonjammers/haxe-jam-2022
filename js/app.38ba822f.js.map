{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///file:///usr/local/lib/haxe/std/js/_std/EReg.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/HxOverrides.hx","webpack:///file:///usr/local/lib/haxe/std/Lambda.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/Reflect.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/Std.hx","webpack:///file:///usr/local/lib/haxe/std/StringTools.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/Component.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/Disposer.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/ComponentBuilder.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/Entity.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlPlatform.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Value.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/SignalConnection.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/SignalBase.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Signal2.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Signal1.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/animation/AnimatedFloat.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/System.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Logger.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/SpeedAdjuster.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/animation/Sine.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/asset/AssetEntry.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/asset/Manifest.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/math/Point.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/display/Sprite.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/display/FillSprite.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/display/ImageSprite.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/input/Acceleration.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/input/Attitude.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/input/KeyboardEvent.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/input/MouseEvent.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/input/PointerEvent.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/input/TouchPoint.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/math/FMath.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/math/Matrix.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/math/Rectangle.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicAsset.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicAssetPackLoader.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicFile.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicKeyboard.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicMouse.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicPointer.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicTexture.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/BasicTouch.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/CatapultClient.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/DebugLogic.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/DummySound.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/DummyStorage.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/DummyTouch.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/EventGroup.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/HeavySignal1.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/KeyCodes.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/MainLoop.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/MathUtil.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/MouseCodes.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/OverdrawGraphics.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/CanvasGraphics.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/CanvasRenderer.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/CanvasTexture.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/CanvasTextureRoot.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlAssetPackLoader.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlCatapultClient.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlExternal.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlLogHandler.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlMotion.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlMouse.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlSound.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlStage.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlStorage.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlUtil.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/HtmlWeb.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/WebAudioSound.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/WebGLBatcher.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/WebGLGraphics.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/WebGLRenderer.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/WebGLTexture.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/html/WebGLTextureRoot.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/shader/ShaderGL.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/shader/DrawPatternGL.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/shader/DrawTextureGL.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/shader/FillRectGL.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/scene/Director.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/scene/Scene.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/scene/Transition.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Assert.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/BitSets.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Promise.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Signal0.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/Strings.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/Background.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/Container.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/Game.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/Loader.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/Main.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/cafe/BarTable.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/game/cafe/Meter.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/haxe/Exception.hx","webpack:///file:///usr/local/lib/haxe/std/haxe/ValueException.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/haxe/ds/IntMap.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/haxe/ds/StringMap.hx","webpack:///file:///usr/local/lib/haxe/std/haxe/iterators/ArrayIterator.hx","webpack:///file:///usr/local/lib/haxe/std/haxe/rtti/Meta.hx","webpack:///file:///usr/local/lib/haxe/std/js/Boot.hx","webpack:///file:///usr/local/lib/haxe/std/js/Browser.hx","webpack:///file:///usr/local/lib/haxe/std/js/html/CanvasElement.hx","webpack:///file:///usr/local/lib/haxe/std/js/_std/String.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/util/PackageLog.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/Log.hx","webpack:///file:///Users/jeremy/Desktop/flambe-vue-starter/src/flambe/platform/ManifestBuilder.hx","webpack:///./src/App.vue","webpack:///src/App.vue","webpack:///./src/App.vue?a7d1","webpack:///./src/App.vue?a938","webpack:///./src/main.js","webpack:///./src/App.vue?4757"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","this","opt","split","join","len","pos","a","indexOf","obj","it","pred","field","start","sub","by","owner","_disposables","freeDisposables","snapshot","disposable","dispose","_compMap","component","prev","remove","tail","firstComponent","next","onAdded","onStop","_flags","onRemoved","entity","parent","append","firstChild","disposeChildren","toStringImpl","output","u2514","String","u241c","u2500","u2502","last","indent","canvas","setAttribute","style","outlineStyle","_stage","_pointer","_mouse","_renderer","createRenderer","mainLoop","musicPlaying","_canvas","_container","parentElement","lastTouchTime","onMouse","event","bounds","getBoundingClientRect","x","getX","y","getY","preventDefault","button","focus","velocity","type","detail","addEventListener","standardTouch","msTouch","basicTouch","_touch","onTouch","changedTouches","target","timeStamp","touch","id","identifier","pointerId","submitMove","submitUp","submitDown","oldErrorHandler","message","url","line","hiddenApi","onVisibilityChanged","Reflect","prefix","onPageTransitionChange","hidden","_skipFrame","_lastUpdate","requestAnimationFrame","performance","hasPerfNow","now","updateFrame","update","_catapult","manifest","promise","_storage","localStorage","locale","tag","dt","_keyboard","onKey","keyCode","_web","_external","_motion","clientX","left","width","clientY","top","height","gl","_value","_changed","listener","oldValue","newValue","_signal","signal","_listener","stayInList","_head","_deferredTasks","conn","defer","listAdd","prioritize","listRemove","task","fn","DISPATCHING_SENTINEL","head","_next","connectImpl","emitImpl","arg1","arg2","willEmit","didEmit","_behavior","behavior","_calledInit","_platform","assertCalledInit","_handler","handler","log","Info","text","fields","Warn","Error","level","scale","_realDt","end","cycles","speed","_count","offset","_distance","_center","isComplete","Math","sin","format","bytes","_entries","packData","packName","required","asset","path","inferFormat","Data","add","extension","DDS","GIF","JPG","JXR","M4A","MP3","OGG","OPUS","PKM","PNG","PVR","WAV","WEBP","entry","basePath","_supportsCrossOrigin","_localBase","localBase","_remoteBase","_localMatrix","dirtyMatrix","rotation","_","scaleX","scaleY","anchorX","anchorY","alpha","disablePixelSnapping","sprite","_scratchPoint","scissor","contains","hitTestBackwards","containsLocal","g","save","blendMode","matrix","getLocalMatrix","m02","m12","round","transform","m00","m10","m01","m11","draw","director","scenes","occludedScenes","scene","render","hitTest","localX","getNaturalWidth","localY","getNaturalHeight","_sinCache","_cosCache","cos","connectHover","_hoverConnection","hit","getParentSprite","_pointerOut","visible","pixelSnapping","onHover","_pointerDown","_pointerMove","_pointerIn","_pointerUp","color","texture","init","z","pitch","roll","azimuth","viewX","viewY","source","_stopped","_source","Touch","min","max","identity","lhs","rhs","b","set","det","determinant","ii","points","other","_disposed","copyFrom","onDisposed","_reloadCount","platform","_bytesLoaded","_pack","entries","handleSuccess","groups","group","_assetsRemaining","pickBestEntry","bestEntry","getFullURL","loadEntry","handleError","badEntry","isAudio","handleLoad","catapult","query","baseUrl","removeUrlParams","foundEntry","getAssetFormats","formats","onFormatsAvailable","map","handleProgress","oldAsset","reload","bytesLoaded","bytesTotal","_manifest","loader","textures","sounds","files","ext","warnOnExtension","disposed","sound","file","_content","content","that","down","up","backButton","_keyStates","_sharedEvent","pointer","Mouse","move","scroll","_x","_y","_cursor","Default","_buttonStates","buttonCode","prepare","_isDown","isDown","chain","onPointerDown","onPointerMove","onPointerUp","root","_width","_height","rootX","rootY","_parent","_maxPoints","maxPoints","_pointMap","_points","point","_pointerTouch","_loaders","cause","onRestart","getKeyboard","connect","O","Control","toggleOverdrawGraphics","renderer","_savedGraphics","graphics","_playback","_instance","_sound","volume","_complete","clear","_hash","dispatcher","addListener","removeEventListener","hasListenersValue","connection","K","Unknown","_tickables","onUpdate","onStart","updateEntity","willRender","didRender","Left","Middle","Right","_impl","impl","drawRegion","destX","destY","Add","_canvasCtx","drawSubTexture","_firstDraw","sourceX","sourceY","sourceW","sourceH","image","fillRect","hex","toString","factor","op","_hasGPU","Canvas","CANVAS_TEXTURES","createTexture","_graphics","formatTests","checkRemaining","webp","onload","onerror","src","jxr","audio","canPlayType","blacklist","userAgent","match","types","mimeType","_detectBlobSupport","xhr","XMLHttpRequest","open","responseType","_URL","events","addDisposingListener","supportsBlob","handleTextureError","download","blob","buffer","decoded","preload","ref","_mediaRefCount","_mediaElements","code","error","duration","progress","buffered","load","_supportedFormats","detectImageFormats","imageFormats","concat","detectAudioFormats","intervalId","hasInterval","clearRetryInterval","retries","maybeRetry","lastProgress","onprogress","loaded","status","response","responseText","onLoad","send","_socket","WebSocket","onError","onMessage","_tagPrefix","acceleration","accelerationIncludingGravity","attitude","_sharedAcceleration","_sharedAccelerationIncludingGravity","motionEvents","onListenersChanged","onDeviceMotion","_sharedAttitude","orientationEvents","hasListeners","onDeviceOrientation","input","initAcceleration","gamma","beta","audioElement","resize","scaleFactor","computeScaleFactor","hideMobileBrowser","onWindowResize","orientation","onOrientationChange","fullscreen","updateFullscreen","devicePixelRatio","ctx","getContext","backingStorePixelRatio","screenWidth","screenHeight","container","rect","resizeCanvas","scaledWidth","scaledHeight","htmlStyle","overflow","state","storage","func","delay","capitalized","charAt","toUpperCase","VENDOR_PREFIXES","names","loadExtension","element","setProperty","useCapture","angle","Landscape","Portrait","createEmptyCanvas","globalCompositeOperation","drawImage","restore","windows","chrome","getSupportedExtensions","_detectSupport","AudioContext","gain","createGain","_gl","clearColor","enable","pixelStorei","_vertexBuffer","createBuffer","bindBuffer","_quadIndexBuffer","_drawTextureShader","_drawPatternShader","_fillRectShader","_backbufferWidth","_backbufferHeight","flush","_lastTexture","_currentTexture","nativeTexture","_lastRenderTarget","_currentRenderTarget","framebuffer","prepareQuad","renderTarget","_lastBlendMode","shader","_lastShader","_lastScissor","clone","_pendingSetScissor","_quads","_maxQuads","_dataOffset","elementsPerVertex","bindRenderTarget","_currentBlendMode","_currentShader","maxQuads","Float32Array","BYTES_PER_ELEMENT","indices","Uint16Array","_scratchQuadArray","_batcher","batcher","_renderTarget","current","_stateList","_scratchMatrix","transformQuad","rootWidth","rootHeight","u1","v1","u2","v2","transformArray","_inverseProjection","applyScissor","flip","x2","y2","Normal","x1","y1","stage","onResize","WebGL","uploadImageData","bindTexture","texParameteri","resized","drawBorder","texImage2D","deleteTexture","fragSource","_program","createProgram","attachShader","createShader","vertSource","linkProgram","useProgram","getProgramParameter","getProgramInfoLog","shaderSource","compileShader","getShaderParameter","typeName","getShaderInfoLog","loc","a_pos","getAttribLocation","a_uv","a_alpha","u_texture","getUniformLocation","u_region","setTexture","unit","bytesPerFloat","stride","a_rgb","_root","completeTransition","_transitor","ll","comp","opaque","get_topScene","show","invalidateVisibility","_from","from","_to","to","_transition","transition","_onComplete","onComplete","shown","condition","fail","enabled","bits","mask","success","progressChanged","hasResult","_progress","_total","_result","once","total","dot","fileName","lastIndexOf","question","slash","getFileExtension","base","relative","stack","pack","getTexture","_title","setXY","_flamingo","cloud1","cloud2","cloud3","imgRatio","imgHeight","imgWidth","containerRatio","containerHeight","containerWidth","finalWidth","finalHeight","_scratch","size","getSize","setScale","removeChild","_disposer","_anchorX","_anchorY","_rotation","_meterTime","_meterDrink","setFill","_barTable","rootSpr","lineSpr","ballSpr","centerAnchor","addChild","bootstrap","onDev","main","mainPack","onGameLoaded","table","_slots","e","percent","_fill","HEIGHT_MAX","backing","fill","__previousException","previous","__nativeException","native","h","keys","array","meta","getMeta","__meta__","Array","cl","__class__","__nativeClassName","__resolveNativeClass","$hxEnums","__enum__","con","__constructs__","_hx_index","_hx_name","__params__","__string_rec","str","tostr","s2","hasp","k","substring","cc","intf","__interfaces__","__interfLoop","Bool","Dynamic","Float","Int","__downcastCheck","__isNativeObj","Class","__name__","Enum","__ename__","__toStr","getItem","random","setItem","removeItem","attribs","HxOverrides","detected","withCredentials","pattern","_vm","_c","_self","attrs","ui","def","_b","staticClass","gameWidth","uiprops","_e","staticRenderFns","gameHeight","computed","mounted","flambe","methods","layoutScale","document","Vue","config","productionTip","App","$mount"],"mappings":"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","file":"js/app.38ba822f.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/haxe-jam-2022/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class EReg {\n\tvar r:HaxeRegExp;\n\n\tpublic inline function new(r:String, opt:String):Void {\n\t\tthis.r = new HaxeRegExp(r, opt.split(\"u\").join(\"\")); // 'u' (utf8) depends on page encoding\n\t}\n\n\tpublic function match(s:String):Bool {\n\t\tif (r.global)\n\t\t\tr.lastIndex = 0;\n\t\tr.m = r.exec(s);\n\t\tr.s = s;\n\t\treturn (r.m != null);\n\t}\n\n\tpublic function matched(n:Int):String {\n\t\treturn if (r.m != null && n >= 0 && n < r.m.length) r.m[n] else throw \"EReg::matched\";\n\t}\n\n\tpublic function matchedLeft():String {\n\t\tif (r.m == null)\n\t\t\tthrow \"No string matched\";\n\t\treturn r.s.substr(0, r.m.index);\n\t}\n\n\tpublic function matchedRight():String {\n\t\tif (r.m == null)\n\t\t\tthrow \"No string matched\";\n\t\tvar sz = r.m.index + r.m[0].length;\n\t\treturn r.s.substr(sz, r.s.length - sz);\n\t}\n\n\tpublic function matchedPos():{pos:Int, len:Int} {\n\t\tif (r.m == null)\n\t\t\tthrow \"No string matched\";\n\t\treturn {pos: r.m.index, len: r.m[0].length};\n\t}\n\n\tpublic function matchSub(s:String, pos:Int, len:Int = -1):Bool {\n\t\treturn if (r.global) {\n\t\t\tr.lastIndex = pos;\n\t\t\tr.m = r.exec(len < 0 ? s : s.substr(0, pos + len));\n\t\t\tvar b = r.m != null;\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t}\n\t\t\tb;\n\t\t} else {\n\t\t\t// TODO: check some ^/$ related corner cases\n\t\t\tvar b = match(len < 0 ? s.substr(pos) : s.substr(pos, len));\n\t\t\tif (b) {\n\t\t\t\tr.s = s;\n\t\t\t\tr.m.index += pos;\n\t\t\t}\n\t\t\tb;\n\t\t}\n\t}\n\n\tpublic function split(s:String):Array<String> {\n\t\t// we can't use directly s.split because it's ignoring the 'g' flag\n\t\tvar d = \"#__delim__#\";\n\t\treturn replace(s, d).split(d);\n\t}\n\n\tpublic inline function replace(s:String, by:String):String {\n\t\treturn (cast s).replace(r, by);\n\t}\n\n\tpublic function map(s:String, f:EReg->String):String {\n\t\tvar offset = 0;\n\t\tvar buf = new StringBuf();\n\t\tdo {\n\t\t\tif (offset >= s.length)\n\t\t\t\tbreak;\n\t\t\telse if (!matchSub(s, offset)) {\n\t\t\t\tbuf.add(s.substr(offset));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar p = matchedPos();\n\t\t\tbuf.add(s.substr(offset, p.pos - offset));\n\t\t\tbuf.add(f(this));\n\t\t\tif (p.len == 0) {\n\t\t\t\tbuf.add(s.substr(p.pos, 1));\n\t\t\t\toffset = p.pos + 1;\n\t\t\t} else\n\t\t\t\toffset = p.pos + p.len;\n\t\t} while (r.global);\n\t\tif (!r.global && offset > 0 && offset < s.length)\n\t\t\tbuf.add(s.substr(offset));\n\t\treturn buf.toString();\n\t}\n\n\tpublic static inline function escape(s:String):String {\n\t\treturn (cast s).replace(escapeRe, \"\\\\$&\");\n\t}\n\n\tstatic var escapeRe = new js.lib.RegExp(\"[.*+?^${}()|[\\\\]\\\\\\\\]\", \"g\");\n}\n\n@:native(\"RegExp\")\nprivate extern class HaxeRegExp extends js.lib.RegExp {\n\tvar m:js.lib.RegExp.RegExpMatch;\n\tvar s:String;\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:noDoc\nclass HxOverrides {\n\tstatic function dateStr(date:Date):String {\n\t\tvar m = date.getMonth() + 1;\n\t\tvar d = date.getDate();\n\t\tvar h = date.getHours();\n\t\tvar mi = date.getMinutes();\n\t\tvar s = date.getSeconds();\n\t\treturn date.getFullYear() + \"-\" + (if (m < 10) \"0\" + m else \"\" + m) + \"-\" + (if (d < 10) \"0\" + d else \"\" + d) + \" \"\n\t\t\t+ (if (h < 10) \"0\" + h else \"\" + h) + \":\" + (if (mi < 10) \"0\" + mi else \"\" + mi) + \":\" + (if (s < 10) \"0\" + s else \"\" + s);\n\t}\n\n\tstatic function strDate(s:String):Date {\n\t\tswitch (s.length) {\n\t\t\tcase 8: // hh:mm:ss\n\t\t\t\tvar k = s.split(\":\");\n\t\t\t\tvar d = js.Syntax.construct(Date);\n\t\t\t\t(cast d)[cast \"setTime\"](0);\n\t\t\t\t(cast d)[cast \"setUTCHours\"](k[0]);\n\t\t\t\t(cast d)[cast \"setUTCMinutes\"](k[1]);\n\t\t\t\t(cast d)[cast \"setUTCSeconds\"](k[2]);\n\t\t\t\treturn d;\n\t\t\tcase 10: // YYYY-MM-DD\n\t\t\t\tvar k = s.split(\"-\");\n\t\t\t\treturn new Date(cast k[0], (cast k[1]) - 1, cast k[2], 0, 0, 0);\n\t\t\tcase 19: // YYYY-MM-DD hh:mm:ss\n\t\t\t\tvar k = s.split(\" \");\n\t\t\t\tvar y = k[0].split(\"-\");\n\t\t\t\tvar t = k[1].split(\":\");\n\t\t\t\treturn new Date(cast y[0], (cast y[1]) - 1, cast y[2], cast t[0], cast t[1], cast t[2]);\n\t\t\tdefault:\n\t\t\t\tthrow \"Invalid date format : \" + s;\n\t\t}\n\t}\n\n\t@:pure\n\tstatic function cca(s:String, index:Int):Null<Int> {\n\t\tvar x = (cast s).charCodeAt(index);\n\t\tif (x != x) // fast isNaN\n\t\t\treturn js.Lib.undefined; // isNaN will still return true\n\t\treturn x;\n\t}\n\n\t@:pure\n\tstatic function substr(s:String, pos:Int, ?len:Int):String {\n\t\tif (len == null) {\n\t\t\tlen = s.length;\n\t\t} else if (len < 0) {\n\t\t\tif (pos == 0)\n\t\t\t\tlen = s.length + len;\n\t\t\telse\n\t\t\t\treturn \"\";\n\t\t}\n\n\t\t#if (js_es < 5)\n\t\tif (pos < 0) {\n\t\t\tpos = s.length + pos;\n\t\t\tif (pos < 0)\n\t\t\t\tpos = 0;\n\t\t}\n\t\t#end\n\n\t\treturn (cast s).substr(pos, len);\n\t}\n\n\t@:pure\n\tstatic function indexOf<T>(a:Array<T>, obj:T, i:Int) {\n\t\tvar len = a.length;\n\t\tif (i < 0) {\n\t\t\ti += len;\n\t\t\tif (i < 0)\n\t\t\t\ti = 0;\n\t\t}\n\t\twhile (i < len) {\n\t\t\tif (js.Syntax.strictEq(a[i], obj))\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t@:pure\n\tstatic function lastIndexOf<T>(a:Array<T>, obj:T, i:Int) {\n\t\tvar len = a.length;\n\t\tif (i >= len)\n\t\t\ti = len - 1;\n\t\telse if (i < 0)\n\t\t\ti += len;\n\t\twhile (i >= 0) {\n\t\t\tif (js.Syntax.strictEq(a[i], obj))\n\t\t\t\treturn i;\n\t\t\ti--;\n\t\t}\n\t\treturn -1;\n\t}\n\n\tstatic function remove<T>(a:Array<T>, obj:T) {\n\t\tvar i = a.indexOf(obj);\n\t\tif (i == -1)\n\t\t\treturn false;\n\t\ta.splice(i, 1);\n\t\treturn true;\n\t}\n\n\t@:pure\n\tstatic function iter<T>(a:Array<T>):Iterator<T>\n\t\tuntyped {\n\t\t\treturn {\n\t\t\t\tcur: 0,\n\t\t\t\tarr: a,\n\t\t\t\thasNext: function() {\n\t\t\t\t\treturn __this__.cur < __this__.arr.length;\n\t\t\t\t},\n\t\t\t\tnext: function() {\n\t\t\t\t\treturn __this__.arr[__this__.cur++];\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t@:ifFeature(\"anon_read.keyValueIterator\", \"dynamic_read.keyValueIterator\", \"closure_read.keyValueIterator\")\n\tstatic function keyValueIter<T>( a : Array<T> ) {\n\t\treturn new haxe.iterators.ArrayKeyValueIterator(a);\n\t}\n\n\t@:pure\n\tstatic function now(): Float return js.lib.Date.now();\n\n\tstatic function __init__()\n\t\tuntyped {\n\t\t\t#if (js_es < 5)\n\t\t\t__feature__('HxOverrides.indexOf',\n\t\t\t\tif (Array.prototype.indexOf) js.Syntax.code(\"HxOverrides\").indexOf = function(a, o, i) return Array.prototype.indexOf.call(a, o, i));\n\t\t\t__feature__('HxOverrides.lastIndexOf',\n\t\t\t\tif (Array.prototype.lastIndexOf) js.Syntax.code(\"HxOverrides\").lastIndexOf = function(a, o, i) return Array.prototype.lastIndexOf.call(a, o, i));\n\t\t\t#end\n\n\t\t\t__feature__('HxOverrides.now',\n\t\t\t\tif (js.Syntax.typeof(performance) != 'undefined' && js.Syntax.typeof(performance.now) == 'function') {\n\t\t\t\t\tHxOverrides.now = performance.now.bind(performance);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport haxe.ds.List;\n\n/**\n\tThe `Lambda` class is a collection of methods to support functional\n\tprogramming. It is ideally used with `using Lambda` and then acts as an\n\textension to Iterable types.\n\n\tOn static platforms, working with the Iterable structure might be slower\n\tthan performing the operations directly on known types, such as Array and\n\tList.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n\n\t@see https://haxe.org/manual/std-Lambda.html\n**/\nclass Lambda {\n\t/**\n\t\tCreates an Array from Iterable `it`.\n\n\t\tIf `it` is an Array, this function returns a copy of it.\n\t**/\n\tpublic static function array<A>(it:Iterable<A>):Array<A> {\n\t\tvar a = new Array<A>();\n\t\tfor (i in it)\n\t\t\ta.push(i);\n\t\treturn a;\n\t}\n\n\t/**\n\t\tCreates a List form Iterable `it`.\n\n\t\tIf `it` is a List, this function returns a copy of it.\n\t**/\n\tpublic static function list<A>(it:Iterable<A>):List<A> {\n\t\tvar l = new List<A>();\n\t\tfor (i in it)\n\t\t\tl.add(i);\n\t\treturn l;\n\t}\n\n\t/**\n\t\tCreates a new Array by applying function `f` to all elements of `it`.\n\t\tThe order of elements is preserved.\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static inline function map<A, B>(it:Iterable<A>, f:(item:A) -> B):Array<B> {\n\t\treturn [for (x in it) f(x)];\n\t}\n\n\t/**\n\t\tSimilar to map, but also passes the index of each element to `f`.\n\t\tThe order of elements is preserved.\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static inline function mapi<A, B>(it:Iterable<A>, f:(index:Int, item:A) -> B):Array<B> {\n\t\tvar i = 0;\n\t\treturn [for (x in it) f(i++, x)];\n\t}\n\n\t/**\n\t\tConcatenate a list of iterables.\n\t\tThe order of elements is preserved.\n\t**/\n\tpublic static inline function flatten<A>(it:Iterable<Iterable<A>>):Array<A> {\n\t\treturn [for (e in it) for (x in e) x];\n\t}\n\n\t/**\n\t\tA composition of map and flatten.\n\t\tThe order of elements is preserved.\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static inline function flatMap<A, B>(it:Iterable<A>, f:(item:A) -> Iterable<B>):Array<B> {\n\t\treturn Lambda.flatten(Lambda.map(it, f));\n\t}\n\n\t/**\n\t\tTells if `it` contains `elt`.\n\n\t\tThis function returns true as soon as an element is found which is equal\n\t\tto `elt` according to the `==` operator.\n\n\t\tIf no such element is found, the result is false.\n\t**/\n\tpublic static function has<A>(it:Iterable<A>, elt:A):Bool {\n\t\tfor (x in it)\n\t\t\tif (x == elt)\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `it` contains an element for which `f` is true.\n\n\t\tThis function returns true as soon as an element is found for which a\n\t\tcall to `f` returns true.\n\n\t\tIf no such element is found, the result is false.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function exists<A>(it:Iterable<A>, f:(item:A) -> Bool) {\n\t\tfor (x in it)\n\t\t\tif (f(x))\n\t\t\t\treturn true;\n\t\treturn false;\n\t}\n\n\t/**\n\t\tTells if `f` is true for all elements of `it`.\n\n\t\tThis function returns false as soon as an element is found for which a\n\t\tcall to `f` returns false.\n\n\t\tIf no such element is found, the result is true.\n\n\t\tIn particular, this function always returns true if `it` is empty.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function foreach<A>(it:Iterable<A>, f:(item:A) -> Bool) {\n\t\tfor (x in it)\n\t\t\tif (!f(x))\n\t\t\t\treturn false;\n\t\treturn true;\n\t}\n\n\t/**\n\t\tCalls `f` on all elements of `it`, in order.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function iter<A>(it:Iterable<A>, f:(item:A) -> Void) {\n\t\tfor (x in it)\n\t\t\tf(x);\n\t}\n\n\t/**\n\t\tReturns a Array containing those elements of `it` for which `f` returned\n\t\ttrue.\n\t\tIf `it` is empty, the result is the empty Array even if `f` is null.\n\t\tOtherwise if `f` is null, the result is unspecified.\n\t**/\n\tpublic static function filter<A>(it:Iterable<A>, f:(item:A) -> Bool) {\n\t\treturn [for (x in it) if (f(x)) x];\n\t}\n\n\t/**\n\t\tFunctional fold on Iterable `it`, using function `f` with start argument\n\t\t`first`.\n\n\t\tIf `it` has no elements, the result is `first`.\n\n\t\tOtherwise the first element of `it` is passed to `f` alongside `first`.\n\t\tThe result of that call is then passed to `f` with the next element of\n\t\t`it`, and so on until `it` has no more elements.\n\n\t\tIf `it` or `f` are null, the result is unspecified.\n\t**/\n\tpublic static function fold<A, B>(it:Iterable<A>, f:(item:A, result:B) -> B, first:B):B {\n\t\tfor (x in it)\n\t\t\tfirst = f(x, first);\n\t\treturn first;\n\t}\n\n\t/**\n\t\tSimilar to fold, but also passes the index of each element to `f`.\n\n\t\tIf `it` or `f` are null, the result is unspecified.\n\t**/\n\tpublic static function foldi<A, B>(it:Iterable<A>, f:(item:A, result:B, index:Int) -> B, first:B):B {\n\t\tvar i = 0;\n\t\tfor (x in it) {\n\t\t\tfirst = f(x, first, i);\n\t\t\t++i;\n\t\t}\n\t\treturn first;\n\t}\n\n\t/**\n\t\tReturns the number of elements in `it` for which `pred` is true, or the\n\t\ttotal number of elements in `it` if `pred` is null.\n\n\t\tThis function traverses all elements.\n\t**/\n\tpublic static function count<A>(it:Iterable<A>, ?pred:(item:A) -> Bool) {\n\t\tvar n = 0;\n\t\tif (pred == null)\n\t\t\tfor (_ in it)\n\t\t\t\tn++;\n\t\telse\n\t\t\tfor (x in it)\n\t\t\t\tif (pred(x))\n\t\t\t\t\tn++;\n\t\treturn n;\n\t}\n\n\t/**\n\t\tTells if Iterable `it` does not contain any element.\n\t**/\n\tpublic static function empty<T>(it:Iterable<T>):Bool {\n\t\treturn !it.iterator().hasNext();\n\t}\n\n\t/**\n\t\tReturns the index of the first element `v` within Iterable `it`.\n\n\t\tThis function uses operator `==` to check for equality.\n\n\t\tIf `v` does not exist in `it`, the result is -1.\n\t**/\n\tpublic static function indexOf<T>(it:Iterable<T>, v:T):Int {\n\t\tvar i = 0;\n\t\tfor (v2 in it) {\n\t\t\tif (v == v2)\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t\tReturns the first element of `it` for which `f` is true.\n\n\t\tThis function returns as soon as an element is found for which a call to\n\t\t`f` returns true.\n\n\t\tIf no such element is found, the result is null.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function find<T>(it:Iterable<T>, f:(item:T) -> Bool):Null<T> {\n\t\tfor (v in it) {\n\t\t\tif (f(v))\n\t\t\t\treturn v;\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t\tReturns the index of the first element of `it` for which `f` is true.\n\n\t\tThis function returns as soon as an element is found for which a call to\n\t\t`f` returns true.\n\n\t\tIf no such element is found, the result is -1.\n\n\t\tIf `f` is null, the result is unspecified.\n\t**/\n\tpublic static function findIndex<T>(it:Iterable<T>, f:(item:T) -> Bool):Int {\n\t\tvar i = 0;\n\t\tfor (v in it) {\n\t\t\tif (f(v))\n\t\t\t\treturn i;\n\t\t\ti++;\n\t\t}\n\t\treturn -1;\n\t}\n\n\t/**\n\t\tReturns a new Array containing all elements of Iterable `a` followed by\n\t\tall elements of Iterable `b`.\n\n\t\tIf `a` or `b` are null, the result is unspecified.\n\t**/\n\tpublic static function concat<T>(a:Iterable<T>, b:Iterable<T>):Array<T> {\n\t\tvar l = new Array();\n\t\tfor (x in a)\n\t\t\tl.push(x);\n\t\tfor (x in b)\n\t\t\tl.push(x);\n\t\treturn l;\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi class Reflect {\n\t@:pure\n\tpublic inline static function hasField(o:Dynamic, field:String):Bool {\n\t\treturn js.lib.Object.prototype.hasOwnProperty.call(o, field);\n\t}\n\n\t@:pure\n\tpublic static function field(o:Dynamic, field:String):Dynamic {\n\t\ttry\n\t\t\treturn o[cast field]\n\t\tcatch (e:Dynamic)\n\t\t\treturn null;\n\t}\n\n\tpublic inline static function setField(o:Dynamic, field:String, value:Dynamic):Void {\n\t\to[cast field] = value;\n\t}\n\n\tpublic static function getProperty(o:Dynamic, field:String):Dynamic\n\t\tuntyped {\n\t\t\tvar tmp;\n\t\t\treturn if (o == null) __define_feature__(\"Reflect.getProperty\",\n\t\t\t\tnull) else if (o.__properties__ && (tmp = o.__properties__[\"get_\" + field])) o[tmp]() else o[field];\n\t\t}\n\n\tpublic static function setProperty(o:Dynamic, field:String, value:Dynamic):Void\n\t\tuntyped {\n\t\t\tvar tmp;\n\t\t\tif (o.__properties__ && (tmp = o.__properties__[\"set_\" + field]))\n\t\t\t\to[tmp](value)\n\t\t\telse\n\t\t\t\to[field] = __define_feature__(\"Reflect.setProperty\", value);\n\t\t}\n\n\tpublic inline static function callMethod(o:Dynamic, func:haxe.Constraints.Function, args:Array<Dynamic>):Dynamic {\n\t\treturn (cast func : js.lib.Function).apply(o, args);\n\t}\n\n\tpublic static function fields(o:Dynamic):Array<String> {\n\t\tvar a = [];\n\t\tif (o != null)\n\t\t\tuntyped {\n\t\t\t\tvar hasOwnProperty = js.lib.Object.prototype.hasOwnProperty;\n\t\t\t\tjs.Syntax.code(\"for( var f in o ) {\");\n\t\t\t\tif (f != \"__id__\" && f != \"hx__closures__\" && hasOwnProperty.call(o, f))\n\t\t\t\t\ta.push(f);\n\t\t\t\tjs.Syntax.code(\"}\");\n\t\t\t}\n\t\treturn a;\n\t}\n\n\t@:access(js.Boot)\n\tpublic static function isFunction(f:Dynamic):Bool {\n\t\treturn js.Syntax.typeof(f) == \"function\" && !(js.Boot.isClass(f) || js.Boot.isEnum(f));\n\t}\n\n\tpublic static function compare<T>(a:T, b:T):Int {\n\t\treturn (a == b) ? 0 : (((cast a) > (cast b)) ? 1 : -1);\n\t}\n\n\tpublic static function compareMethods(f1:Dynamic, f2:Dynamic):Bool {\n\t\tif (f1 == f2)\n\t\t\treturn true;\n\t\tif (!isFunction(f1) || !isFunction(f2))\n\t\t\treturn false;\n\t\treturn f1.scope == f2.scope && f1.method == f2.method && f1.method != null;\n\t}\n\n\t@:access(js.Boot)\n\tpublic static function isObject(v:Dynamic):Bool {\n\t\tif (v == null)\n\t\t\treturn false;\n\t\tvar t = js.Syntax.typeof(v);\n\t\treturn (t == \"string\" || (t == \"object\" && v.__enum__ == null))\n\t\t\t|| (t == \"function\" && (js.Boot.isClass(v) || js.Boot.isEnum(v)) != null);\n\t}\n\n\tpublic static function isEnumValue(v:Dynamic):Bool {\n\t\treturn v != null && v.__enum__ != null;\n\t}\n\n\tpublic static function deleteField(o:Dynamic, field:String):Bool {\n\t\tif (!hasField(o, field))\n\t\t\treturn false;\n\t\tjs.Syntax.delete(o, field);\n\t\treturn true;\n\t}\n\n\tpublic static function copy<T>(o:Null<T>):Null<T> {\n\t\tif (o == null)\n\t\t\treturn null;\n\t\tvar o2:Dynamic = {};\n\t\tfor (f in Reflect.fields(o))\n\t\t\tReflect.setField(o2, f, Reflect.field(o, f));\n\t\treturn o2;\n\t}\n\n\t@:overload(function(f:Array<Dynamic>->Void):Dynamic {})\n\tpublic static function makeVarArgs(f:Array<Dynamic>->Dynamic):Dynamic {\n\t\treturn function() {\n\t\t\tvar a = untyped Array.prototype.slice.call(js.Syntax.code(\"arguments\"));\n\t\t\treturn f(a);\n\t\t};\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport js.Boot;\nimport js.Syntax;\n\n@:keepInit\n@:coreApi class Std {\n\t@:deprecated('Std.is is deprecated. Use Std.isOfType instead.')\n\tpublic static inline function is(v:Dynamic, t:Dynamic):Bool {\n\t\treturn isOfType(v, t);\n\t}\n\n\tpublic static inline function isOfType(v:Dynamic, t:Dynamic):Bool {\n\t\treturn @:privateAccess js.Boot.__instanceof(v, t);\n\t}\n\n\tpublic static inline function downcast<T:{}, S:T>(value:T, c:Class<S>):S@:privateAccess {\n\t\treturn if (js.Boot.__downcastCheck(value, c)) cast value else null;\n\t}\n\n\t@:deprecated('Std.instance() is deprecated. Use Std.downcast() instead.')\n\tpublic static inline function instance<T:{}, S:T>(value:T, c:Class<S>):S {\n\t\treturn downcast(value, c);\n\t}\n\n\t@:pure\n\tpublic static function string(s:Dynamic):String {\n\t\treturn @:privateAccess js.Boot.__string_rec(s, \"\");\n\t}\n\n\tpublic static inline function int(x:Float):Int {\n\t\treturn (cast x) | 0;\n\t}\n\n\t@:pure\n\tpublic static function parseInt(x:String):Null<Int> {\n\t\tif(x != null) {\n\t\t\tfor(i in 0...x.length) {\n\t\t\t\tvar c = StringTools.fastCodeAt(x, i);\n\t\t\t\tif(c <= 8 || (c >= 14 && c != ' '.code && c != '-'.code)) {\n\t\t\t\t\tvar nc = StringTools.fastCodeAt(x, i + 1);\n\t\t\t\t\tvar v = js.Lib.parseInt(x, (nc == \"x\".code || nc == \"X\".code) ? 16 : 10);\n\t\t\t\t\treturn Math.isNaN(v) ? null : cast v;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic static inline function parseFloat(x:String):Float {\n\t\treturn js.Syntax.code(\"parseFloat({0})\", x);\n\t}\n\n\tpublic static function random(x:Int):Int {\n\t\treturn x <= 0 ? 0 : Math.floor(Math.random() * x);\n\t}\n\n\tstatic function __init__():Void\n\t\tuntyped {\n\t\t\t__feature__(\"js.Boot.getClass\", String.prototype.__class__ = __feature__(\"Type.resolveClass\", $hxClasses[\"String\"] = String, String));\n\t\t\t__feature__(\"js.Boot.isClass\", String.__name__ = __feature__(\"Type.getClassName\", \"String\", true));\n\t\t\t__feature__(\"Type.resolveClass\", $hxClasses[\"Array\"] = Array);\n\t\t\t__feature__(\"js.Boot.isClass\", Array.__name__ = __feature__(\"Type.getClassName\", \"Array\", true));\n\t\t\t__feature__(\"Date.*\", {\n\t\t\t\t__feature__(\"js.Boot.getClass\",\n\t\t\t\t\tjs.Syntax.code('Date').prototype.__class__ = __feature__(\"Type.resolveClass\", $hxClasses[\"Date\"] = js.Syntax.code('Date'), js.Syntax.code('Date')));\n\t\t\t\t__feature__(\"js.Boot.isClass\", js.Syntax.code('Date').__name__ = \"Date\");\n\t\t\t});\n\t\t\t__feature__(\"Int.*\", js.Syntax.code('var Int = { };'));\n\t\t\t__feature__(\"Dynamic.*\", js.Syntax.code('var Dynamic = { };'));\n\t\t\t__feature__(\"Float.*\", js.Syntax.code('var Float = Number'));\n\t\t\t__feature__(\"Bool.*\", js.Syntax.code('var Bool = Boolean'));\n\t\t\t__feature__(\"Class.*\", js.Syntax.code('var Class = { };'));\n\t\t\t__feature__(\"Enum.*\", js.Syntax.code('var Enum = { };'));\n\t\t\t#if (js_es < 5)\n\t\t\t__feature__(\"Array.map\", if (Array.prototype.map == null) Array.prototype.map = function(f) {\n\t\t\t\tvar a = [];\n\t\t\t\tfor (i in 0...__this__.length)\n\t\t\t\t\ta[i] = f(__this__[i]);\n\t\t\t\treturn a;\n\t\t\t});\n\t\t\t__feature__(\"Array.filter\", if (Array.prototype.filter == null) Array.prototype.filter = function(f) {\n\t\t\t\tvar a = [];\n\t\t\t\tfor (i in 0...__this__.length) {\n\t\t\t\t\tvar e = __this__[i];\n\t\t\t\t\tif (f(e))\n\t\t\t\t\t\ta.push(e);\n\t\t\t\t}\n\t\t\t\treturn a;\n\t\t\t});\n\t\t\t#end\n\t\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\nimport haxe.iterators.StringIterator;\nimport haxe.iterators.StringKeyValueIterator;\n\n#if cpp\nusing cpp.NativeString;\n#end\n\n/**\n\tThis class provides advanced methods on Strings. It is ideally used with\n\t`using StringTools` and then acts as an [extension](https://haxe.org/manual/lf-static-extension.html)\n\tto the `String` class.\n\n\tIf the first argument to any of the methods is null, the result is\n\tunspecified.\n**/\nclass StringTools {\n\t/**\n\t\tEncode an URL by using the standard format.\n\t**/\n\t#if (!java && !cpp && !lua && !eval) inline #end public static function urlEncode(s:String):String {\n\t\t#if flash\n\t\treturn untyped __global__[\"encodeURIComponent\"](s);\n\t\t#elseif neko\n\t\treturn untyped new String(_urlEncode(s.__s));\n\t\t#elseif js\n\t\treturn untyped encodeURIComponent(s);\n\t\t#elseif cpp\n\t\treturn untyped s.__URLEncode();\n\t\t#elseif java\n\t\treturn postProcessUrlEncode(java.net.URLEncoder.encode(s, \"UTF-8\"));\n\t\t#elseif cs\n\t\treturn untyped cs.system.Uri.EscapeDataString(s);\n\t\t#elseif python\n\t\treturn python.lib.urllib.Parse.quote(s, \"\");\n\t\t#elseif hl\n\t\tvar len = 0;\n\t\tvar b = @:privateAccess s.bytes.urlEncode(len);\n\t\treturn @:privateAccess String.__alloc__(b, len);\n\t\t#elseif lua\n\t\ts = lua.NativeStringTools.gsub(s, \"\\n\", \"\\r\\n\");\n\t\ts = lua.NativeStringTools.gsub(s, \"([^%w %-%_%.%~])\", function(c) {\n\t\t\treturn lua.NativeStringTools.format(\"%%%02X\", lua.NativeStringTools.byte(c) + '');\n\t\t});\n\t\ts = lua.NativeStringTools.gsub(s, \" \", \"+\");\n\t\treturn s;\n\t\t#else\n\t\treturn null;\n\t\t#end\n\t}\n\n\t#if java\n\tprivate static function postProcessUrlEncode(s:String):String {\n\t\tvar ret = new StringBuf();\n\t\tvar i = 0, len = s.length;\n\t\twhile (i < len) {\n\t\t\tswitch (_charAt(s, i++)) {\n\t\t\t\tcase '+'.code:\n\t\t\t\t\tret.add('%20');\n\t\t\t\tcase '%'.code if (i <= len - 2):\n\t\t\t\t\tvar c1 = _charAt(s, i++), c2 = _charAt(s, i++);\n\t\t\t\t\tswitch [c1, c2] {\n\t\t\t\t\t\tcase ['2'.code, '1'.code]:\n\t\t\t\t\t\t\tret.addChar('!'.code);\n\t\t\t\t\t\tcase ['2'.code, '7'.code]:\n\t\t\t\t\t\t\tret.addChar('\\''.code);\n\t\t\t\t\t\tcase ['2'.code, '8'.code]:\n\t\t\t\t\t\t\tret.addChar('('.code);\n\t\t\t\t\t\tcase ['2'.code, '9'.code]:\n\t\t\t\t\t\t\tret.addChar(')'.code);\n\t\t\t\t\t\tcase ['7'.code, 'E'.code] | ['7'.code, 'e'.code]:\n\t\t\t\t\t\t\tret.addChar('~'.code);\n\t\t\t\t\t\tcase _:\n\t\t\t\t\t\t\tret.addChar('%'.code);\n\t\t\t\t\t\t\tret.addChar(cast c1);\n\t\t\t\t\t\t\tret.addChar(cast c2);\n\t\t\t\t\t}\n\t\t\t\tcase var chr:\n\t\t\t\t\tret.addChar(cast chr);\n\t\t\t}\n\t\t}\n\t\treturn ret.toString();\n\t}\n\t#end\n\n\t/**\n\t\tDecode an URL using the standard format.\n\t**/\n\t#if (!java && !cpp && !lua && !eval) inline #end public static function urlDecode(s:String):String {\n\t\t#if flash\n\t\treturn untyped __global__[\"decodeURIComponent\"](s.split(\"+\").join(\" \"));\n\t\t#elseif neko\n\t\treturn untyped new String(_urlDecode(s.__s));\n\t\t#elseif js\n\t\treturn untyped decodeURIComponent(s.split(\"+\").join(\" \"));\n\t\t#elseif cpp\n\t\treturn untyped s.__URLDecode();\n\t\t#elseif java\n\t\ttry\n\t\t\treturn java.net.URLDecoder.decode(s, \"UTF-8\")\n\t\tcatch (e:Dynamic)\n\t\t\tthrow e;\n\t\t#elseif cs\n\t\treturn untyped cs.system.Uri.UnescapeDataString(s);\n\t\t#elseif python\n\t\treturn python.lib.urllib.Parse.unquote(s);\n\t\t#elseif hl\n\t\tvar len = 0;\n\t\tvar b = @:privateAccess s.bytes.urlDecode(len);\n\t\treturn @:privateAccess String.__alloc__(b, len);\n\t\t#elseif lua\n\t\ts = lua.NativeStringTools.gsub(s, \"+\", \" \");\n\t\ts = lua.NativeStringTools.gsub(s, \"%%(%x%x)\", function(h) {\n\t\t\treturn lua.NativeStringTools.char(lua.Lua.tonumber(h, 16));\n\t\t});\n\t\ts = lua.NativeStringTools.gsub(s, \"\\r\\n\", \"\\n\");\n\t\treturn s;\n\t\t#else\n\t\treturn null;\n\t\t#end\n\t}\n\n\t/**\n\t\tEscapes HTML special characters of the string `s`.\n\n\t\tThe following replacements are made:\n\n\t\t- `&` becomes `&amp`;\n\t\t- `<` becomes `&lt`;\n\t\t- `>` becomes `&gt`;\n\n\t\tIf `quotes` is true, the following characters are also replaced:\n\n\t\t- `\"` becomes `&quot`;\n\t\t- `'` becomes `&#039`;\n\t**/\n\tpublic static function htmlEscape(s:String, ?quotes:Bool):String {\n\t\tvar buf = new StringBuf();\n\t\tfor (code in #if neko iterator(s) #else new haxe.iterators.StringIteratorUnicode(s) #end) {\n\t\t\tswitch (code) {\n\t\t\t\tcase '&'.code:\n\t\t\t\t\tbuf.add(\"&amp;\");\n\t\t\t\tcase '<'.code:\n\t\t\t\t\tbuf.add(\"&lt;\");\n\t\t\t\tcase '>'.code:\n\t\t\t\t\tbuf.add(\"&gt;\");\n\t\t\t\tcase '\"'.code if (quotes):\n\t\t\t\t\tbuf.add(\"&quot;\");\n\t\t\t\tcase '\\''.code if (quotes):\n\t\t\t\t\tbuf.add(\"&#039;\");\n\t\t\t\tcase _:\n\t\t\t\t\tbuf.addChar(code);\n\t\t\t}\n\t\t}\n\t\treturn buf.toString();\n\t}\n\n\t/**\n\t\tUnescapes HTML special characters of the string `s`.\n\n\t\tThis is the inverse operation to htmlEscape, i.e. the following always\n\t\tholds: `htmlUnescape(htmlEscape(s)) == s`\n\n\t\tThe replacements follow:\n\n\t\t- `&amp;` becomes `&`\n\t\t- `&lt;` becomes `<`\n\t\t- `&gt;` becomes `>`\n\t\t- `&quot;` becomes `\"`\n\t\t- `&#039;` becomes `'`\n\t**/\n\tpublic static function htmlUnescape(s:String):String {\n\t\treturn s.split(\"&gt;\")\n\t\t\t.join(\">\")\n\t\t\t.split(\"&lt;\")\n\t\t\t.join(\"<\")\n\t\t\t.split(\"&quot;\")\n\t\t\t.join('\"')\n\t\t\t.split(\"&#039;\")\n\t\t\t.join(\"'\")\n\t\t\t.split(\"&amp;\")\n\t\t\t.join(\"&\");\n\t}\n\n\t/**\n\t\tReturns `true` if `s` contains `value` and  `false` otherwise.\n\n\t\tWhen `value` is `null`, the result is unspecified.\n\t**/\n\tpublic static inline function contains(s:String, value:String):Bool {\n\t\t#if (js && js_es >= 6)\n\t\treturn (cast s).includes(value);\n\t\t#else \n\t\treturn s.indexOf(value) != -1;\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the string `s` starts with the string `start`.\n\n\t\tIf `start` is `null`, the result is unspecified.\n\n\t\tIf `start` is the empty String `\"\"`, the result is true.\n\t**/\n\tpublic static #if (cs || java || python || (js && js_es >= 6)) inline #end function startsWith(s:String, start:String):Bool {\n\t\t#if java\n\t\treturn (cast s : java.NativeString).startsWith(start);\n\t\t#elseif cs\n\t\treturn untyped s.StartsWith(start);\n\t\t#elseif hl\n\t\treturn @:privateAccess (s.length >= start.length && s.bytes.compare(0, start.bytes, 0, start.length << 1) == 0);\n\t\t#elseif python\n\t\treturn python.NativeStringTools.startswith(s, start);\n\t\t#elseif (js && js_es >= 6)\n\t\treturn (cast s).startsWith(start);\n\t\t#else\n\t\treturn (s.length >= start.length && s.lastIndexOf(start, 0) == 0);\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the string `s` ends with the string `end`.\n\n\t\tIf `end` is `null`, the result is unspecified.\n\n\t\tIf `end` is the empty String `\"\"`, the result is true.\n\t**/\n\tpublic static #if (cs || java || python || (js && js_es >= 6)) inline #end function endsWith(s:String, end:String):Bool {\n\t\t#if java\n\t\treturn (cast s : java.NativeString).endsWith(end);\n\t\t#elseif cs\n\t\treturn untyped s.EndsWith(end);\n\t\t#elseif hl\n\t\tvar elen = end.length;\n\t\tvar slen = s.length;\n\t\treturn @:privateAccess (slen >= elen && s.bytes.compare((slen - elen) << 1, end.bytes, 0, elen << 1) == 0);\n\t\t#elseif python\n\t\treturn python.NativeStringTools.endswith(s, end);\n\t\t#elseif (js && js_es >= 6)\n\t\treturn (cast s).endsWith(end);\n\t\t#else\n\t\tvar elen = end.length;\n\t\tvar slen = s.length;\n\t\treturn (slen >= elen && s.indexOf(end, (slen - elen)) == (slen - elen));\n\t\t#end\n\t}\n\n\t/**\n\t\tTells if the character in the string `s` at position `pos` is a space.\n\n\t\tA character is considered to be a space character if its character code\n\t\tis 9,10,11,12,13 or 32.\n\n\t\tIf `s` is the empty String `\"\"`, or if pos is not a valid position within\n\t\t`s`, the result is false.\n\t**/\n\tpublic static function isSpace(s:String, pos:Int):Bool {\n\t\t#if (python || lua)\n\t\tif (s.length == 0 || pos < 0 || pos >= s.length)\n\t\t\treturn false;\n\t\t#end\n\t\tvar c = s.charCodeAt(pos);\n\t\treturn (c > 8 && c < 14) || c == 32;\n\t}\n\n\t/**\n\t\tRemoves leading space characters of `s`.\n\n\t\tThis function internally calls `isSpace()` to decide which characters to\n\t\tremove.\n\n\t\tIf `s` is the empty String `\"\"` or consists only of space characters, the\n\t\tresult is the empty String `\"\"`.\n\t**/\n\tpublic #if cs inline #end static function ltrim(s:String):String {\n\t\t#if cs\n\t\treturn untyped s.TrimStart();\n\t\t#else\n\t\tvar l = s.length;\n\t\tvar r = 0;\n\t\twhile (r < l && isSpace(s, r)) {\n\t\t\tr++;\n\t\t}\n\t\tif (r > 0)\n\t\t\treturn s.substr(r, l - r);\n\t\telse\n\t\t\treturn s;\n\t\t#end\n\t}\n\n\t/**\n\t\tRemoves trailing space characters of `s`.\n\n\t\tThis function internally calls `isSpace()` to decide which characters to\n\t\tremove.\n\n\t\tIf `s` is the empty String `\"\"` or consists only of space characters, the\n\t\tresult is the empty String `\"\"`.\n\t**/\n\tpublic #if cs inline #end static function rtrim(s:String):String {\n\t\t#if cs\n\t\treturn untyped s.TrimEnd();\n\t\t#else\n\t\tvar l = s.length;\n\t\tvar r = 0;\n\t\twhile (r < l && isSpace(s, l - r - 1)) {\n\t\t\tr++;\n\t\t}\n\t\tif (r > 0) {\n\t\t\treturn s.substr(0, l - r);\n\t\t} else {\n\t\t\treturn s;\n\t\t}\n\t\t#end\n\t}\n\n\t/**\n\t\tRemoves leading and trailing space characters of `s`.\n\n\t\tThis is a convenience function for `ltrim(rtrim(s))`.\n\t**/\n\tpublic #if (cs || java) inline #end static function trim(s:String):String {\n\t\t#if cs\n\t\treturn untyped s.Trim();\n\t\t#elseif java\n\t\treturn (cast s : java.NativeString).trim();\n\t\t#else\n\t\treturn ltrim(rtrim(s));\n\t\t#end\n\t}\n\n\t/**\n\t\tConcatenates `c` to `s` until `s.length` is at least `l`.\n\n\t\tIf `c` is the empty String `\"\"` or if `l` does not exceed `s.length`,\n\t\t`s` is returned unchanged.\n\n\t\tIf `c.length` is 1, the resulting String length is exactly `l`.\n\n\t\tOtherwise the length may exceed `l`.\n\n\t\tIf `c` is null, the result is unspecified.\n\t**/\n\tpublic static function lpad(s:String, c:String, l:Int):String {\n\t\tif (c.length <= 0)\n\t\t\treturn s;\n\n\t\tvar buf = new StringBuf();\n\t\tl -= s.length;\n\t\twhile (buf.length < l) {\n\t\t\tbuf.add(c);\n\t\t}\n\t\tbuf.add(s);\n\t\treturn buf.toString();\n\t}\n\n\t/**\n\t\tAppends `c` to `s` until `s.length` is at least `l`.\n\n\t\tIf `c` is the empty String `\"\"` or if `l` does not exceed `s.length`,\n\t\t`s` is returned unchanged.\n\n\t\tIf `c.length` is 1, the resulting String length is exactly `l`.\n\n\t\tOtherwise the length may exceed `l`.\n\n\t\tIf `c` is null, the result is unspecified.\n\t**/\n\tpublic static function rpad(s:String, c:String, l:Int):String {\n\t\tif (c.length <= 0)\n\t\t\treturn s;\n\n\t\tvar buf = new StringBuf();\n\t\tbuf.add(s);\n\t\twhile (buf.length < l) {\n\t\t\tbuf.add(c);\n\t\t}\n\t\treturn buf.toString();\n\t}\n\n\t/**\n\t\tReplace all occurrences of the String `sub` in the String `s` by the\n\t\tString `by`.\n\n\t\tIf `sub` is the empty String `\"\"`, `by` is inserted after each character\n\t\tof `s` except the last one. If `by` is also the empty String `\"\"`, `s`\n\t\tremains unchanged.\n\n\t\tIf `sub` or `by` are null, the result is unspecified.\n\t**/\n\tpublic static function replace(s:String, sub:String, by:String):String {\n\t\t#if java\n\t\tif (sub.length == 0)\n\t\t\treturn s.split(sub).join(by);\n\t\telse\n\t\t\treturn (cast s : java.NativeString).replace(sub, by);\n\t\t#elseif cs\n\t\tif (sub.length == 0)\n\t\t\treturn s.split(sub).join(by);\n\t\telse\n\t\t\treturn untyped s.Replace(sub, by);\n\t\t#else\n\t\treturn s.split(sub).join(by);\n\t\t#end\n\t}\n\n\t/**\n\t\tEncodes `n` into a hexadecimal representation.\n\n\t\tIf `digits` is specified, the resulting String is padded with \"0\" until\n\t\tits `length` equals `digits`.\n\t**/\n\tpublic static function hex(n:Int, ?digits:Int) {\n\t\t#if flash\n\t\tvar n:UInt = n;\n\t\tvar s:String = untyped n.toString(16);\n\t\ts = s.toUpperCase();\n\t\t#else\n\t\tvar s = \"\";\n\t\tvar hexChars = \"0123456789ABCDEF\";\n\t\tdo {\n\t\t\ts = hexChars.charAt(n & 15) + s;\n\t\t\tn >>>= 4;\n\t\t} while (n > 0);\n\t\t#end\n\t\t#if python\n\t\tif (digits != null && s.length < digits) {\n\t\t\tvar diff = digits - s.length;\n\t\t\tfor (_ in 0...diff) {\n\t\t\t\ts = \"0\" + s;\n\t\t\t}\n\t\t}\n\t\t#else\n\t\tif (digits != null)\n\t\t\twhile (s.length < digits)\n\t\t\t\ts = \"0\" + s;\n\t\t#end\n\t\treturn s;\n\t}\n\n\t/**\n\t\tReturns the character code at position `index` of String `s`, or an\n\t\tend-of-file indicator at if `position` equals `s.length`.\n\n\t\tThis method is faster than `String.charCodeAt()` on some platforms, but\n\t\tthe result is unspecified if `index` is negative or greater than\n\t\t`s.length`.\n\n\t\tEnd of file status can be checked by calling `StringTools.isEof()` with\n\t\tthe returned value as argument.\n\n\t\tThis operation is not guaranteed to work if `s` contains the `\\0`\n\t\tcharacter.\n\t**/\n\tpublic static #if !eval inline #end function fastCodeAt(s:String, index:Int):Int {\n\t\t#if neko\n\t\treturn untyped __dollar__sget(s.__s, index);\n\t\t#elseif cpp\n\t\treturn untyped s.cca(index);\n\t\t#elseif flash\n\t\treturn untyped s.cca(index);\n\t\t#elseif java\n\t\treturn (index < s.length) ? cast(_charAt(s, index), Int) : -1;\n\t\t#elseif cs\n\t\treturn (cast(index, UInt) < s.length) ? cast(s[index], Int) : -1;\n\t\t#elseif js\n\t\treturn (cast s).charCodeAt(index);\n\t\t#elseif python\n\t\treturn if (index >= s.length) -1 else python.internal.UBuiltins.ord(python.Syntax.arrayAccess(s, index));\n\t\t#elseif hl\n\t\treturn @:privateAccess s.bytes.getUI16(index << 1);\n\t\t#elseif lua\n\t\t#if lua_vanilla\n\t\treturn lua.NativeStringTools.byte(s, index + 1);\n\t\t#else\n\t\treturn lua.lib.luautf8.Utf8.byte(s, index + 1);\n\t\t#end\n\t\t#else\n\t\treturn untyped s.cca(index);\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns the character code at position `index` of String `s`, or an\n\t\tend-of-file indicator at if `position` equals `s.length`.\n\n\t\tThis method is faster than `String.charCodeAt()` on some platforms, but\n\t\tthe result is unspecified if `index` is negative or greater than\n\t\t`s.length`.\n\n\t\tThis operation is not guaranteed to work if `s` contains the `\\0`\n\t\tcharacter.\n\t**/\n\tpublic static #if !eval inline #end function unsafeCodeAt(s:String, index:Int):Int {\n\t\t#if neko\n\t\treturn untyped __dollar__sget(s.__s, index);\n\t\t#elseif cpp\n\t\treturn untyped s.cca(index);\n\t\t#elseif flash\n\t\treturn untyped s.cca(index);\n\t\t#elseif java\n\t\treturn cast(_charAt(s, index), Int);\n\t\t#elseif cs\n\t\treturn cast(s[index], Int);\n\t\t#elseif js\n\t\treturn (cast s).charCodeAt(index);\n\t\t#elseif python\n\t\treturn python.internal.UBuiltins.ord(python.Syntax.arrayAccess(s, index));\n\t\t#elseif hl\n\t\treturn @:privateAccess s.bytes.getUI16(index << 1);\n\t\t#elseif lua\n\t\t#if lua_vanilla\n\t\treturn lua.NativeStringTools.byte(s, index + 1);\n\t\t#else\n\t\treturn lua.lib.luautf8.Utf8.byte(s, index + 1);\n\t\t#end\n\t\t#else\n\t\treturn untyped s.cca(index);\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns an iterator of the char codes.\n\n\t\tNote that char codes may differ across platforms because of different\n\t\tinternal encoding of strings in different runtimes.\n\t\tFor the consistent cross-platform UTF8 char codes see `haxe.iterators.StringIteratorUnicode`.\n\t**/\n\tpublic static inline function iterator(s:String):StringIterator {\n\t\treturn new StringIterator(s);\n\t}\n\n\t/**\n\t\tReturns an iterator of the char indexes and codes.\n\n\t\tNote that char codes may differ across platforms because of different\n\t\tinternal encoding of strings in different of runtimes.\n\t\tFor the consistent cross-platform UTF8 char codes see `haxe.iterators.StringKeyValueIteratorUnicode`.\n\t**/\n\tpublic static inline function keyValueIterator(s:String):StringKeyValueIterator {\n\t\treturn new StringKeyValueIterator(s);\n\t}\n\n\t/**\n\t\tTells if `c` represents the end-of-file (EOF) character.\n\t**/\n\t@:noUsing public static inline function isEof(c:Int):Bool {\n\t\t#if (flash || cpp || hl)\n\t\treturn c == 0;\n\t\t#elseif js\n\t\treturn c != c; // fast NaN\n\t\t#elseif (neko || lua || eval)\n\t\treturn c == null;\n\t\t#elseif (cs || java || python)\n\t\treturn c == -1;\n\t\t#else\n\t\treturn false;\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns a String that can be used as a single command line argument\n\t\ton Unix.\n\t\tThe input will be quoted, or escaped if necessary.\n\t**/\n\t@:noCompletion\n\t@:deprecated('StringTools.quoteUnixArg() is deprecated. Use haxe.SysTools.quoteUnixArg() instead.')\n\tpublic static function quoteUnixArg(argument:String):String {\n\t\treturn inline haxe.SysTools.quoteUnixArg(argument);\n\t}\n\n\t/**\n\t\tCharacter codes of the characters that will be escaped by `quoteWinArg(_, true)`.\n\t**/\n\t@:noCompletion\n\t@:deprecated('StringTools.winMetaCharacters is deprecated. Use haxe.SysTools.winMetaCharacters instead.')\n\tpublic static var winMetaCharacters:Array<Int> = cast haxe.SysTools.winMetaCharacters;\n\n\t/**\n\t\tReturns a String that can be used as a single command line argument\n\t\ton Windows.\n\t\tThe input will be quoted, or escaped if necessary, such that the output\n\t\twill be parsed as a single argument using the rule specified in\n\t\thttp://msdn.microsoft.com/en-us/library/ms880421\n\n\t\tExamples:\n\t\t```haxe\n\t\tquoteWinArg(\"abc\") == \"abc\";\n\t\tquoteWinArg(\"ab c\") == '\"ab c\"';\n\t\t```\n\t**/\n\t@:noCompletion\n\t@:deprecated('StringTools.quoteWinArg() is deprecated. Use haxe.SysTools.quoteWinArg() instead.')\n\tpublic static function quoteWinArg(argument:String, escapeMetaCharacters:Bool):String {\n\t\treturn inline haxe.SysTools.quoteWinArg(argument, escapeMetaCharacters);\n\t}\n\n\t#if java\n\tprivate static inline function _charAt(str:String, idx:Int):java.StdTypes.Char16\n\t\treturn (cast str : java.NativeString).charAt(idx);\n\t#end\n\n\t#if neko\n\tprivate static var _urlEncode = neko.Lib.load(\"std\", \"url_encode\", 1);\n\tprivate static var _urlDecode = neko.Lib.load(\"std\", \"url_decode\", 1);\n\t#end\n\n\t#if utf16\n\tstatic inline var MIN_SURROGATE_CODE_POINT = 65536;\n\n\tstatic inline function utf16CodePointAt(s:String, index:Int):Int {\n\t\tvar c = StringTools.fastCodeAt(s, index);\n\t\tif (c >= 0xD800 && c <= 0xDBFF) {\n\t\t\tc = ((c - 0xD7C0) << 10) | (StringTools.fastCodeAt(s, index + 1) & 0x3FF);\n\t\t}\n\t\treturn c;\n\t}\n\t#end\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.util.Disposable;\n\n/**\n * Components are bits of data and logic that can be added to entities.\n */\n#if (!macro && !display)\n@:autoBuild(flambe.platform.ComponentBuilder.build())\n#end\n@:componentBase\nclass Component\n    implements Disposable\n{\n    /** The entity this component is attached to, or null. */\n    @:allow(flambe)\n    public var owner (default, null) :Entity = null;\n\n    /** The owner's next component, for iteration. */\n    @:allow(flambe)\n    public var next (default, null) :Component = null;\n\n    /**\n     * The component's name, generated based on its class. Components with the same name replace\n     * eachother when added to an entity.\n     */\n    public var name (get, null) :String;\n\n    /**\n     * Called after this component has been added to an entity.\n     */\n    public function onAdded ()\n    {\n    }\n\n    /**\n     * Called just before this component has been removed from its entity.\n     */\n    public function onRemoved ()\n    {\n    }\n\n    /**\n     * Called just before this component's first update after being added. This is the best place to\n     * put initialization logic that requires accessing other components/entities, since it waits\n     * until the rest of the entity hierarchy is accessible.\n     *\n     * Note that onStart may be delayed until the next frame after adding a component, depending on\n     * where in the update step it was added.\n     */\n    public function onStart ()\n    {\n    }\n\n    /**\n     * Called just before this component will be removed from its entity, if onStart was previously\n     * called.\n     */\n    public function onStop ()\n    {\n    }\n\n    /**\n     * Called when this component receives a game update.\n     * @param dt The time elapsed since the last frame, in seconds.\n     */\n    public function onUpdate (dt :Float)\n    {\n    }\n\n    /**\n     * Removes this component from its owning entity.\n     */\n    public function dispose ()\n    {\n        if (owner != null) {\n            owner.remove(this);\n        }\n    }\n\n    private function get_name () :String\n    {\n        return null; // Subclasses will automagically implement this\n    }\n\n    // Component flags\n    @:allow(flambe) static inline var STARTED = 1 << 0;\n    private static inline var NEXT_FLAG = 1 << 1; // Must be last!\n\n    @:allow(flambe) var _flags :Int = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.util.Disposable;\nimport flambe.util.Signal0;\nimport flambe.util.Signal1;\nimport flambe.util.Signal2;\n\n/**\n * A component that manages a set of Disposable objects. When this component is removed from its\n * owner, all managed Disposables are disposed.\n */\nclass Disposer extends Component\n{\n    public function new ()\n    {\n        _disposables = [];\n    }\n\n    /**\n     * Add a Disposable, so that it also gets disposed when this component does.\n     * @returns This instance, for chaining.\n     */\n    public function add (disposable :Disposable) :Disposer\n    {\n        _disposables.push(disposable);\n        return this;\n    }\n\n    /**\n     * Remove a Disposable from this disposer.\n     * @returns True if the disposable was removed.\n     */\n    public function remove (disposable :Disposable) :Bool\n    {\n        return _disposables.remove(disposable);\n    }\n\n    /**\n     * Chainable convenience method for connecting a signal listener and adding its SignalConnection\n     * to this disposer.\n     * @returns This instance, for chaining.\n     */\n    public function connect0 (signal :Signal0, listener :Listener0) :Disposer\n    {\n        add(signal.connect(listener));\n        return this;\n    }\n\n    /**\n     * Chainable convenience method for connecting a signal listener and adding its SignalConnection\n     * to this disposer.\n     * @returns This instance, for chaining.\n     */\n    public function connect1<A> (signal :Signal1<A>, listener :Listener1<A>) :Disposer\n    {\n        add(signal.connect(listener));\n        return this;\n    }\n\n    /**\n     * Chainable convenience method for connecting a signal listener and adding its SignalConnection\n     * to this disposer.\n     * @returns This instance, for chaining.\n     */\n    public function connect2<A,B> (signal :Signal2<A,B>, listener :Listener2<A,B>) :Disposer\n    {\n        add(signal.connect(listener));\n        return this;\n    }\n\n    override public function onRemoved ()\n    {\n        freeDisposables();\n    }\n\n    override public function dispose ()\n    {\n        super.dispose();\n        freeDisposables(); // Cleanup even if this component had no owner\n    }\n\n    private function freeDisposables ()\n    {\n        var snapshot = _disposables;\n        _disposables = [];\n        for (disposable in snapshot) {\n            disposable.dispose();\n        }\n    }\n\n    private var _disposables :Array<Disposable>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport haxe.macro.Expr;\nimport haxe.macro.Context;\nimport haxe.macro.Type;\n\nimport flambe.util.Macros;\n\nusing Lambda;\nusing flambe.util.Iterables;\n\nclass ComponentBuilder\n{\n    public static function build () :Array<Field>\n    {\n        var pos = Context.currentPos();\n        var cl = Context.getLocalClass().get();\n\n        var name = Context.makeExpr(getComponentName(cl), pos);\n        var componentType = TPath({pack: cl.pack, name: cl.name, params: []});\n\n        var fields = Macros.buildFields(macro {\n            #if doc @:noDoc #end\n            var public__static__inline__NAME = $name;\n        });\n\n        // Only override get_name if this component directly extends a @:componentBase and creates a\n        // new namespace\n        if (extendsComponentBase(cl)) {\n            fields = fields.concat(Macros.buildFields(macro {\n                function override__private__get_name () :String {\n                    return $name;\n                }\n            }));\n        }\n\n        return fields.concat(Context.getBuildFields());\n    }\n\n    private static function getComponentName (cl :ClassType) :String\n    {\n        // Traverse up to the last non-component base\n        while (true) {\n            if (extendsComponentBase(cl)) {\n                break;\n            }\n            cl = cl.superClass.t.get();\n        }\n\n        // Look up the ID, otherwise generate one\n        var fullName = cl.pack.concat([cl.name]).join(\".\");\n        var name = _nameCache.get(fullName);\n        if (name == null) {\n            name = cl.name + \"_\" + _nextId;\n            _nameCache.set(fullName, name);\n            ++_nextId;\n        }\n\n        return name;\n    }\n\n    private static function extendsComponentBase (cl :ClassType)\n    {\n        var superClass = cl.superClass.t.get();\n        return superClass.meta.has(\":componentBase\");\n    }\n\n    private static var _nameCache = new Map<String,String>();\n    private static var _nextId = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\n#if macro\nimport haxe.macro.Context;\nimport haxe.macro.Expr;\nimport haxe.macro.Type;\nusing haxe.macro.ExprTools;\n#end\n\nimport flambe.util.Disposable;\n\nusing Lambda;\nusing flambe.util.BitSets;\n\n/**\n * A node in the entity hierarchy, and a collection of components.\n *\n * To iterate over the hierarchy, use the parent, firstChild, next and firstComponent fields. For\n * example:\n *\n * ```haxe\n * // Iterate over entity's children\n * var child = entity.firstChild;\n * while (child != null) {\n *     var next = child.next; // Store in case the child is removed in process()\n *     process(child);\n *     child = next;\n * }\n * ```\n */\n@:final class Entity\n    implements Disposable\n{\n    /** This entity's parent. */\n    public var parent (default, null) :Entity = null;\n\n    /** This entity's first child. */\n    public var firstChild (default, null) :Entity = null;\n\n    /** This entity's next sibling, for iteration. */\n    public var next (default, null) :Entity = null;\n\n    /** This entity's first component. */\n    public var firstComponent (default, null) :Component = null;\n\n    public function new ()\n    {\n#if flash\n        _compMap = cast new flash.utils.Dictionary();\n#elseif js\n        _compMap = {};\n#end\n    }\n\n    /**\n     * Add a component to this entity. Any previous component of this type will be replaced.\n     * @returns This instance, for chaining.\n     */\n    public function add (component :Component) :Entity\n    {\n        // Remove the component from any previous owner. Don't just call dispose, which has\n        // additional behavior in some components (like Disposer).\n        if (component.owner != null) {\n            component.owner.remove(component);\n        }\n\n        var name = component.name;\n        var prev = getComponent(name);\n        if (prev != null) {\n            // Remove the previous component under this name\n            remove(prev);\n        }\n\n        untyped _compMap[name] = component;\n\n        // Append it to the component list\n        var tail = null, p = firstComponent;\n        while (p != null) {\n            tail = p;\n            p = p.next;\n        }\n        if (tail != null) {\n            tail.next = component;\n        } else {\n            firstComponent = component;\n        }\n\n        component.owner = this;\n        component.next = null;\n        component.onAdded();\n\n        return this;\n    }\n\n    /**\n     * Remove a component from this entity.\n     * @return Whether the component was removed.\n     */\n    public function remove (component :Component) :Bool\n    {\n        var prev :Component = null, p = firstComponent;\n        while (p != null) {\n            var next = p.next;\n            if (p == component) {\n                // Splice out the component\n                if (prev == null) {\n                    firstComponent = next;\n                } else {\n                    prev.owner = this;\n                    prev.next = next;\n                }\n\n                // Remove it from the _compMap\n#if flash\n                untyped __delete__(_compMap, p.name);\n#elseif js\n                untyped js.Syntax.plainCode(\"delete\")(_compMap[p.name]);\n#end\n\n                // Notify the component it was removed\n                if (p._flags.contains(Component.STARTED)) {\n                    p.onStop();\n                    p._flags = p._flags.remove(Component.STARTED);\n                }\n                p.onRemoved();\n                p.owner = null;\n                p.next = null;\n                return true;\n            }\n            prev = p;\n            p = next;\n        }\n        return false;\n    }\n\n    /**\n     * Gets a component of a given type from this entity.\n     */\n#if (display || dox)\n    public function get<A:Component> (componentClass :Class<A>) :A return null;\n\n#else\n    macro public function get<A:Component> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<A>\n    {\n        var type = requireComponentType(componentClass);\n        var name = macro $componentClass.NAME;\n        return needSafeCast(type)\n            ? macro Std.downcast($self.getComponent($name), $componentClass)\n            : macro $self._internal_unsafeCast($self.getComponent($name), $componentClass);\n    }\n#end\n\n    /**\n     * Checks if this entity has a component of the given type.\n     */\n#if (display || dox)\n    public function has<A:Component> (componentClass :Class<A>) :Bool return false;\n\n#else\n    macro public function has<A> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<Bool>\n    {\n        return macro $self.get($componentClass) != null;\n    }\n#end\n\n    /**\n     * Gets a component of a given type from this entity, or any of its parents. Searches upwards in\n     * the hierarchy until the component is found, or returns null if not found.\n     */\n#if (display || dox)\n    public function getFromParents<A:Component> (componentClass :Class<A>) :A return null;\n\n#else\n    macro public function getFromParents<A> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<A>\n    {\n        var type = requireComponentType(componentClass);\n        var name = macro $componentClass.NAME;\n        return needSafeCast(type)\n            ? macro $self._internal_getFromParents($name, $componentClass)\n            : macro $self._internal_unsafeCast($self._internal_getFromParents($name), $componentClass);\n    }\n#end\n\n    /**\n     * Gets a component of a given type from this entity, or any of its children. Searches downwards\n     * in a depth-first search until the component is found, or returns null if not found.\n     */\n#if (display || dox)\n    public function getFromChildren<A:Component> (componentClass :Class<A>) :A return null;\n\n#else\n    macro public function getFromChildren<A> (self :Expr, componentClass :ExprOf<Class<A>>) :ExprOf<A>\n    {\n        var type = requireComponentType(componentClass);\n        var name = macro $componentClass.NAME;\n        return needSafeCast(type)\n            ? macro $self._internal_getFromChildren($name, $componentClass)\n            : macro $self._internal_unsafeCast($self._internal_getFromChildren($name), $componentClass);\n    }\n#end\n\n    /**\n     * Gets a component by name from this entity.\n     */\n    inline public function getComponent (name :String) :Component\n    {\n        return untyped _compMap[name];\n    }\n\n    /**\n     * Adds a child to this entity.\n     * @param append Whether to add the entity to the end or beginning of the child list.\n     * @returns This instance, for chaining.\n     */\n    public function addChild (entity :Entity, append :Bool=true) :Entity\n    {\n        if (entity.parent != null) {\n            entity.parent.removeChild(entity);\n        }\n        entity.parent = this;\n\n        if (append) {\n            // Append it to the child list\n            var tail = null, p = firstChild;\n            while (p != null) {\n                tail = p;\n                p = p.next;\n            }\n            if (tail != null) {\n                tail.next = entity;\n            } else {\n                firstChild = entity;\n            }\n\n        } else {\n            // Prepend it to the child list\n            entity.next = firstChild;\n            firstChild = entity;\n        }\n\n        return this;\n    }\n\n    public function removeChild (entity :Entity)\n    {\n        var prev :Entity = null, p = firstChild;\n        while (p != null) {\n            var next = p.next;\n            if (p == entity) {\n                // Splice out the entity\n                if (prev == null) {\n                    firstChild = next;\n                } else {\n                    prev.next = next;\n                }\n                p.parent = null;\n                p.next = null;\n                return;\n            }\n            prev = p;\n            p = next;\n        }\n    }\n\n    /**\n     * Dispose all of this entity's children, without touching its own components or removing itself\n     * from its parent.\n     */\n    public function disposeChildren ()\n    {\n        while (firstChild != null) {\n            firstChild.dispose();\n        }\n    }\n\n    /**\n     * Removes this entity from its parent, and disposes all its components and children.\n     */\n    public function dispose ()\n    {\n        if (parent != null) {\n            parent.removeChild(this);\n        }\n\n        while (firstComponent != null) {\n            firstComponent.dispose();\n        }\n        disposeChildren();\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return toStringImpl(\"\");\n    }\n\n    private function toStringImpl (indent :String) :String\n    {\n        var output = \"\";\n        var p = firstComponent;\n        while (p != null) {\n            output += p.name;\n            if (p.next != null) {\n                output += \", \";\n            }\n            p = p.next;\n        }\n        output += \"\\n\";\n\n        // Oof, Haxe doesn't support escaped unicode in string literals\n        var u2514 = String.fromCharCode(0x2514); // \n        var u241c = String.fromCharCode(0x251c); // \n        var u2500 = String.fromCharCode(0x2500); // \n        var u2502 = String.fromCharCode(0x2502); // \n\n        var p = firstChild;\n        while (p != null) {\n            var last = p.next == null;\n            output += indent + (last ? u2514 : u241c) + u2500+u2500+\" \";\n            output += p.toStringImpl(indent + (last ? \" \" : u2502) + \"   \");\n            p = p.next;\n        }\n        return output;\n    }\n\n    // Semi-private helper methods\n#if !display\n    @:extern // Inline even in debug builds\n    inline public function _internal_unsafeCast<A:Component> (component :Component, cl :Class<A>) :A\n    {\n        return cast component;\n    }\n\n    public function _internal_getFromParents<A:Component> (name :String, ?safeCast :Class<A>) :A\n    {\n        var entity = this;\n        do {\n            var component = entity.getComponent(name);\n            if (safeCast != null) {\n                component = Std.downcast(component, safeCast);\n            }\n            if (component != null) {\n                return cast component;\n            }\n            entity = entity.parent;\n        } while (entity != null);\n\n        return null; // Not found\n    }\n\n    public function _internal_getFromChildren<A:Component> (name :String, ?safeCast :Class<A>) :A\n    {\n        var component = getComponent(name);\n        if (safeCast != null) {\n            component = Std.downcast(component, safeCast);\n        }\n        if (component != null) {\n            return cast component;\n        }\n\n        var child = firstChild;\n        while (child != null) {\n            var component = child._internal_getFromChildren(name, safeCast);\n            if (component != null) {\n                return component;\n            }\n\n            child = child.next;\n        }\n\n        return null; // Not found\n    }\n#end\n\n#if macro\n    // Gets the ClassType from an expression, or aborts if it's not a component class\n    private static function requireComponentType (componentClass :Expr) :ClassType\n    {\n        var path = getClassName(componentClass);\n        if (path != null) {\n            var type = Context.getType(path.join(\".\"));\n            switch (type) {\n            case TInst(ref,_):\n                var cl = ref.get();\n                if (Context.unify(type, Context.getType(\"flambe.Component\")) && cl.superClass != null) {\n                    return cl;\n                }\n            default:\n            }\n        }\n\n        Context.error(\"Expected a class that extends Component, got \" + componentClass.toString(),\n            componentClass.pos);\n        return null;\n    }\n\n    // Gets a class name from a given expression\n    private static function getClassName<A> (componentClass :Expr) :Array<String>\n    {\n        switch (componentClass.expr) {\n        case EConst(CIdent(name)):\n            return [name];\n        case EField(expr, name):\n            var path = getClassName(expr);\n            if (path != null) {\n                path.push(name);\n            }\n            return path;\n        default:\n            return null;\n        }\n    }\n\n    private static function needSafeCast (componentClass :ClassType) :Bool\n    {\n        return !componentClass.superClass.t.get().meta.has(\":componentBase\");\n    }\n#end\n\n    /**\n     * Maps String -> Component. Usually you would use a Haxe Map here, but I'm dropping down to plain\n     * Object/Dictionary for the quickest possible lookups in this critical part of Flambe.\n     */\n    private var _compMap :Dynamic<Component>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.asset.AssetPack;\nimport flambe.asset.Manifest;\nimport flambe.display.Texture;\nimport flambe.subsystem.*;\nimport flambe.util.Assert;\nimport flambe.util.Logger;\nimport flambe.util.Promise;\nimport flambe.util.Signal1;\n\nclass HtmlPlatform\n    implements Platform\n{\n    public static var instance (default, null) :HtmlPlatform = new HtmlPlatform();\n\n    public var mainLoop (default, null) :MainLoop;\n    public var musicPlaying :Bool;\n\n    private function new ()\n    {\n    }\n\n    public function init ()\n    {\n        HtmlUtil.fixAndroidMath();\n\n#if html\n        // If running in a plain web browser, look up the canvas from the embedder\n        var canvas :CanvasElement = null;\n        try {\n            // Use the canvas assigned to us by the flambe.js embedder\n            canvas = (untyped Browser.window).flambe.canvas;\n        } catch (error :Dynamic) {\n        }\n        Assert.that(canvas != null,\n            \"Could not find a Flambe canvas! Are you embedding with flambe.js?\");\n#else\n        // Otherwise create our own\n        var canvas = Browser.document.createCanvasElement();\n        Browser.document.getElementById(\"content\").appendChild(canvas);\n#end\n\n        // Allow the canvas to trap keyboard focus\n        canvas.setAttribute(\"tabindex\", \"0\");\n        // ...but hide the focus rectangle\n        canvas.style.outlineStyle = \"none\";\n        (untyped canvas.style).webkitTapHighlightColor = \"transparent\";\n\n        // Browser optimization hints\n#if !flambe_transparent\n        canvas.setAttribute(\"moz-opaque\", \"true\");\n#end\n        // canvas.style.webkitTransform = \"translateZ(0)\";\n        // canvas.style.backgroundColor = \"#000\";\n\n        _stage = new HtmlStage(canvas);\n        _pointer = new BasicPointer();\n        _mouse = new HtmlMouse(_pointer, canvas);\n\n        _renderer = createRenderer(canvas);\n\n        mainLoop = new MainLoop();\n\n        // Used by browsers that don't support audio very well\n        musicPlaying = false;\n\n        _canvas = canvas;\n        _container = canvas.parentElement;\n        _container.style.overflow = \"hidden\";\n        _container.style.position = \"relative\";\n\n        // Prevent double tap zooming on IE10. Maybe this should be in the MSPointer block below,\n        // but I have no idea without testing, so apply it always\n        // http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx\n        (untyped _container.style).msTouchAction = \"none\";\n\n        var lastTouchTime = 0;\n        var onMouse = function (event :MouseEvent) {\n            if (event.timeStamp - lastTouchTime < 1000) {\n                // Ignore if there was too recent a touch event, to filter out mouse events emulated\n                // by mobile browsers: http://www.w3.org/TR/touch-events/#mouse-events\n                return;\n            }\n            var bounds = canvas.getBoundingClientRect();\n            var x = getX(event, bounds);\n            var y = getY(event, bounds);\n\n            switch (event.type) {\n            case \"mousedown\":\n                if (event.target == canvas) {\n                    event.preventDefault();\n                    _mouse.submitDown(x, y, event.button);\n                    canvas.focus();\n                }\n\n            case \"mousemove\":\n                _mouse.submitMove(x, y);\n\n            case \"mouseup\":\n                _mouse.submitUp(x, y, event.button);\n\n            case \"mousewheel\", \"DOMMouseScroll\":\n                var velocity = (event.type == \"mousewheel\") ? (untyped event).wheelDelta/40 : -event.detail;\n                if (_mouse.submitScroll(x, y, velocity)) {\n                    // Only prevent page scrolling if the event was handled\n                    event.preventDefault();\n                }\n            }\n        };\n        // Add listeners on the window object so dragging and releasing outside of the canvas works\n        Browser.window.addEventListener(\"mousedown\", onMouse, false);\n        Browser.window.addEventListener(\"mousemove\", onMouse, false);\n        Browser.window.addEventListener(\"mouseup\", onMouse, false);\n\n        // But the wheel listener should only go on the canvas\n        canvas.addEventListener(\"mousewheel\", onMouse, false);\n        canvas.addEventListener(\"DOMMouseScroll\", onMouse, false); // https://bugzil.la/719320\n\n        // Suppress the context menu so right-click events aren't interfered with\n        canvas.addEventListener(\"contextmenu\", function (event) event.preventDefault(), false);\n\n        // Detect touch support. See http://modernizr.github.com/Modernizr/touch.html for more\n        // sophisticated detection methods, but this seems to cover all important browsers\n        var standardTouch :Bool = js.Syntax.plainCode(\"typeof\")(Browser.window.ontouchstart) != \"undefined\";\n\n        // The pointer event handles mouse movement, touch events, and stylus events.\n        // We check to see if multiple points are supported indicating true touch support.\n        // http://blogs.msdn.com/b/ie/archive/2011/10/19/handling-multi-touch-and-mouse-input-in-all-browsers.aspx\n        var msTouch :Bool = js.Syntax.plainCode(\"'msMaxTouchPoints' in window.navigator && (window.navigator.msMaxTouchPoints > 1)\");\n\n        if (standardTouch || msTouch) {\n            var basicTouch = new BasicTouch(_pointer, standardTouch ?\n                4 : (untyped Browser.navigator).msMaxTouchPoints);\n            _touch = basicTouch;\n\n            var onTouch = function (event :Dynamic) {\n                var changedTouches :Array<Dynamic> = standardTouch ? event.changedTouches : [event];\n                var bounds = event.target.getBoundingClientRect();\n                lastTouchTime = event.timeStamp;\n\n                switch (event.type) {\n                case \"touchstart\", \"MSPointerDown\", \"pointerdown\":\n                    event.preventDefault();\n                    if (HtmlUtil.SHOULD_HIDE_MOBILE_BROWSER) {\n                        HtmlUtil.hideMobileBrowser();\n                    }\n                    for (touch in changedTouches) {\n                        var x = getX(touch, bounds);\n                        var y = getY(touch, bounds);\n                        var id = Std.int(standardTouch ? touch.identifier : touch.pointerId);\n                        basicTouch.submitDown(id, x, y);\n                    }\n\n                case \"touchmove\", \"MSPointerMove\", \"pointermove\":\n                    event.preventDefault();\n                    for (touch in changedTouches) {\n                        var x = getX(touch, bounds);\n                        var y = getY(touch, bounds);\n                        var id = Std.int(standardTouch ? touch.identifier : touch.pointerId);\n                        basicTouch.submitMove(id, x, y);\n                    }\n\n                case \"touchend\", \"touchcancel\", \"MSPointerUp\", \"pointerup\":\n                    for (touch in changedTouches) {\n                        var x = getX(touch, bounds);\n                        var y = getY(touch, bounds);\n                        var id = Std.int(standardTouch ? touch.identifier : touch.pointerId);\n                        basicTouch.submitUp(id, x, y);\n                    }\n                }\n            };\n\n            if (standardTouch) {\n                canvas.addEventListener(\"touchstart\", onTouch, false);\n                canvas.addEventListener(\"touchmove\", onTouch, false);\n                canvas.addEventListener(\"touchend\", onTouch, false);\n                canvas.addEventListener(\"touchcancel\", onTouch, false);\n            } else {\n                canvas.addEventListener(\"MSPointerDown\", onTouch, false);\n                canvas.addEventListener(\"MSPointerMove\", onTouch, false);\n                canvas.addEventListener(\"MSPointerUp\", onTouch, false);\n            }\n\n        } else {\n            _touch = new DummyTouch();\n        }\n\n        // Handle uncaught errors\n        var oldErrorHandler = (untyped Browser.window).onerror;\n        (untyped Browser.window).onerror = function (message :String, url :String, line :Int) {\n            System.uncaughtError.emit(message);\n            return (oldErrorHandler != null) ? oldErrorHandler(message, url, line) : false;\n        };\n\n        // Handle visibility changes if the browser supports them\n        // http://www.w3.org/TR/page-visibility/\n        var hiddenApi = HtmlUtil.loadExtension(\"hidden\", Browser.document);\n        if (hiddenApi.value != null) {\n            var onVisibilityChanged = function (_) {\n                System.hidden._ = Reflect.field(Browser.document, hiddenApi.field);\n            };\n            onVisibilityChanged(null); // Update now\n            Browser.document.addEventListener(hiddenApi.prefix + \"visibilitychange\",\n                onVisibilityChanged, false);\n        } else {\n            // Adds some lock screen support for iOS, possibly other devices that don't support the\n            // page visibility api.\n            var onPageTransitionChange = function (event) {\n                System.hidden._ = (event.type == \"pagehide\");\n            };\n            Browser.window.addEventListener(\"pageshow\", onPageTransitionChange, false);\n            Browser.window.addEventListener(\"pagehide\", onPageTransitionChange, false);\n        }\n\n        // Skip the next frame when coming back from being hidden\n        System.hidden.changed.connect(function (hidden,_) {\n            if (!hidden) {\n                _skipFrame = true;\n            }\n        });\n        _skipFrame = false;\n\n        _lastUpdate = HtmlUtil.now();\n\n        // Use requestAnimationFrame if available, otherwise a 60 FPS setInterval\n        // https://developer.mozilla.org/en/DOM/window.mozRequestAnimationFrame\n        var requestAnimationFrame = HtmlUtil.loadExtension(\"requestAnimationFrame\").value;\n        if (requestAnimationFrame != null) {\n            // Use the high resolution, monotonic timer if available\n            // http://www.w3.org/TR/hr-time/\n            var performance :Performance = Browser.window.performance;\n            var hasPerfNow = (performance != null) && HtmlUtil.polyfill(\"now\", performance);\n\n            if (hasPerfNow) {\n                // performance.now is relative to navigationStart, rather than a timestamp\n                _lastUpdate = performance.now();\n            } else {\n                Log.warn(\"No monotonic timer support, falling back to the system date\");\n            }\n\n            var updateFrame = null;\n            updateFrame = function (now :Float) {\n                update(hasPerfNow ? performance.now() : now);\n                requestAnimationFrame(updateFrame, canvas);\n            };\n            requestAnimationFrame(updateFrame, canvas);\n\n        } else {\n            Log.warn(\"No requestAnimationFrame support, falling back to setInterval\");\n            Browser.window.setInterval(function () {\n                update(HtmlUtil.now());\n            }, 16); // ~60 FPS\n        }\n\n#if debug\n        new DebugLogic(this);\n#if html\n        _catapult = HtmlCatapultClient.canUse() ? new HtmlCatapultClient() : null;\n#end\n#end\n        Log.info(\"Initialized HTML platform\", [\"renderer\", _renderer.type]);\n    }\n\n    public function loadAssetPack (manifest :Manifest) :Promise<AssetPack>\n    {\n        return new HtmlAssetPackLoader(this, manifest).promise;\n    }\n\n    public function getStage () :StageSystem\n    {\n        return _stage;\n    }\n\n    public function getStorage () :StorageSystem\n    {\n        if (_storage == null) {\n            // Safely access localStorage (browsers may throw an error on direct access)\n            // http://dev.w3.org/html5/webstorage/#dom-localstorage\n            var localStorage = Browser.getLocalStorage();\n            if (localStorage != null) {\n                _storage = new HtmlStorage(localStorage);\n            } else {\n                Log.warn(\"localStorage is unavailable, falling back to unpersisted storage\");\n                _storage = new DummyStorage();\n            }\n        }\n        return _storage;\n    }\n\n    public function getLocale () :String\n    {\n        // https://developer.mozilla.org/en-US/docs/DOM/window.navigator.language\n        var locale = Browser.navigator.language;\n        if (locale == null) {\n            // IE uses the non-standard userLanguage (or browserLanguage or systemLanguage, but\n            // userLanguage seems to match String's locale-aware methods)\n            locale = (untyped Browser.navigator).userLanguage;\n        }\n        return locale;\n    }\n\n    public function createLogHandler (tag :String) :LogHandler\n    {\n#if (debug || flambe_keep_logs)\n        if (HtmlLogHandler.isSupported()) {\n            return new HtmlLogHandler(tag);\n        }\n#end\n        return null;\n    }\n\n    public function getTime () :Float\n    {\n        return HtmlUtil.now() / 1000;\n    }\n\n    public function getCatapultClient ()\n    {\n        return _catapult;\n    }\n\n    private function update (now :Float)\n    {\n        var dt = (now-_lastUpdate) / 1000;\n        _lastUpdate = now;\n\n        if (System.hidden._) {\n            return; // Prevent updates while hidden\n        }\n        if (_skipFrame) {\n            _skipFrame = false;\n            return;\n        }\n\n        mainLoop.update(dt);\n        mainLoop.render(_renderer);\n    }\n\n    public function getPointer () :PointerSystem\n    {\n        return _pointer;\n    }\n\n    public function getMouse () :MouseSystem\n    {\n        return _mouse;\n    }\n\n    public function getTouch () :TouchSystem\n    {\n        return _touch;\n    }\n\n    public function getKeyboard () :KeyboardSystem\n    {\n        if (_keyboard == null) {\n            _keyboard = new BasicKeyboard();\n            var onKey = function (event :KeyboardEvent) {\n                switch (event.type) {\n                case \"keydown\":\n                    if (_keyboard.submitDown(event.keyCode)) {\n                        event.preventDefault();\n                    }\n                case \"keyup\":\n                    _keyboard.submitUp(event.keyCode);\n                }\n            };\n            _canvas.addEventListener(\"keydown\", onKey, false);\n            _canvas.addEventListener(\"keyup\", onKey, false);\n        }\n        return _keyboard;\n    }\n\n    public function getWeb () :WebSystem\n    {\n        if (_web == null) {\n            _web = new HtmlWeb();\n        }\n        return _web;\n    }\n\n    public function getExternal () :ExternalSystem\n    {\n        if (_external == null) {\n            _external = new HtmlExternal();\n        }\n        return _external;\n    }\n\n    public function getMotion () :MotionSystem\n    {\n        if (_motion == null) {\n            _motion = new HtmlMotion();\n        }\n        return _motion;\n    }\n\n    public function getRenderer () :InternalRenderer<Dynamic>\n    {\n        return _renderer;\n    }\n\n    private function getX (event :Dynamic, bounds :Dynamic) :Float\n    {\n        return (event.clientX - bounds.left)*_stage.width/bounds.width;\n    }\n\n    private function getY (event :Dynamic, bounds :Dynamic) :Float\n    {\n        return (event.clientY - bounds.top)*_stage.height/bounds.height;\n    }\n\n    private function createRenderer (canvas :CanvasElement) :InternalRenderer<Dynamic>\n    {\n#if !flambe_disable_webgl\n\n#if firefox\n        // WebGL is buggy in Firefox OS 1.1, so blacklist it there\n        // https://developer.mozilla.org/en-US/docs/Gecko_user_agent_string_reference#Firefox_OS\n        var majorVersion = ~/\\bFirefox\\/(\\d+)/;\n        if (!majorVersion.match(Browser.navigator.userAgent) || Std.parseInt(majorVersion.matched(1)) >= 26)\n#end\n        try {\n            var gl = canvas.getContextWebGL(cast {\n#if !flambe_transparent\n                alpha: false,\n#end\n                depth: false,\n                // http://blog.tojicode.com/2013/12/failifmajorperformancecaveat-with-great.html\n                failIfMajorPerformanceCaveat: true,\n            });\n            if (gl != null) {\n#if !flambe_disable_canvas\n                // TODO(bruno): Remove this check once failIfMajorPerformanceCaveat becomes\n                // prevalent\n                if (HtmlUtil.detectSlowDriver(gl)) {\n                    Log.warn(\"Detected a slow WebGL driver, falling back to canvas\");\n                } else\n#end\n                return new WebGLRenderer(_stage, gl);\n            }\n        } catch (_ :Dynamic) {\n            // Getting the WebGL context blows up on some (headless?) systems\n        }\n#end\n\n#if !flambe_disable_canvas\n        // No WebGL, fall back to canvas\n        return new CanvasRenderer(canvas);\n#end\n\n#if (flambe_disable_webgl && flambe_disable_canvas)\n#error \"Build with either flambe_disable_webgl or flambe_disable_canvas, not both!\"\n#end\n        Log.error(\"No renderer available!\");\n        return null;\n    }\n\n    // Statically initialized subsystems\n    private var _mouse :HtmlMouse;\n    private var _pointer :BasicPointer;\n    private var _renderer :InternalRenderer<Dynamic>;\n    private var _stage :HtmlStage;\n    private var _touch :TouchSystem;\n\n    // Lazily initialized subsystems\n    private var _external :ExternalSystem;\n    private var _keyboard :BasicKeyboard;\n    private var _motion :MotionSystem;\n    private var _storage :StorageSystem;\n    private var _web :WebSystem;\n\n    private var _canvas :CanvasElement;\n    private var _container :Element;\n\n    private var _lastUpdate :Float;\n    private var _skipFrame :Bool;\n\n    private var _catapult :HtmlCatapultClient;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nimport flambe.util.Signal2;\n\n/**\n * Wraps a single value, notifying listeners when the value changes.\n */\n#if !js\n@:generic // Generate typed templates on static targets\n#end\nclass Value<A>\n{\n    /**\n     * The wrapped value, setting this to a different value will fire the `changed` signal.\n     */\n    public var _ (get, set) :A;\n\n    /**\n     * Emitted when the value has changed. The first listener parameter is the new current value,\n     * the second parameter is the old previous value.\n     */\n    public var changed (get, null) :Signal2<A,A>;\n\n    public function new (value :A, ?listener :Listener2<A,A>)\n    {\n        _value = value;\n        _changed = (listener != null) ? new Signal2(listener) : null;\n    }\n\n    /**\n     * Immediately calls a listener with the current value, and again whenever the value changes.\n     * @returns A handle that can be disposed to stop watching for changes.\n     */\n    public function watch (listener :Listener2<A,A>) :Disposable\n    {\n        listener(_value, _value);\n        return changed.connect(listener);\n    }\n\n    inline private function get__ () :A\n    {\n        return _value;\n    }\n\n    private function set__ (newValue :A) :A\n    {\n        var oldValue = _value;\n        if (newValue != oldValue) {\n            _value = newValue;\n            if (_changed != null) {\n                _changed.emit(newValue, oldValue);\n            }\n        }\n        return newValue;\n    }\n\n    private function get_changed ()\n    {\n        if (_changed == null) {\n            _changed = new Signal2();\n        }\n        return _changed;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return \"\"+_value;\n    }\n\n    private var _value :A;\n    private var _changed :Signal2<A,A>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Represents a connected signal listener.\n */\nclass SignalConnection\n    implements Disposable\n{\n    /**\n     * True if the listener will remain connected after being used.\n     */\n    public var stayInList (default, null) :Bool;\n\n    @:allow(flambe) function new (signal :SignalBase, listener :Dynamic)\n    {\n        _signal = signal;\n        _listener = listener;\n        stayInList = true;\n    }\n\n    /**\n     * Tells the connection to dispose itself after being used once.\n     * @returns This instance, for chaining.\n     */\n    public function once ()\n    {\n        stayInList = false;\n        return this;\n    }\n\n    /**\n     * Disconnects the listener from the signal.\n     */\n    public function dispose ()\n    {\n        if (_signal != null) {\n            _signal.disconnect(this);\n            _signal = null;\n        }\n    }\n\n    @:allow(flambe) var _next :SignalConnection = null;\n\n    @:allow(flambe) var _listener :Dynamic;\n    private var _signal :SignalBase;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nclass SignalBase\n{\n    private function new (listener :Dynamic)\n    {\n        _head = (listener != null) ? new SignalConnection(this, listener) : null;\n        _deferredTasks = null;\n    }\n\n    /**\n     * Whether this signal has at least one listener.\n     */\n    inline public function hasListeners () :Bool\n    {\n        return _head != null;\n    }\n\n    private function connectImpl (listener :Dynamic, prioritize :Bool) :SignalConnection\n    {\n        var conn = new SignalConnection(this, listener);\n        if (dispatching()) {\n            defer(function () {\n                listAdd(conn, prioritize);\n            });\n        } else {\n            listAdd(conn, prioritize);\n        }\n        return conn;\n    }\n\n    @:allow(flambe) function disconnect (conn :SignalConnection)\n    {\n        if (dispatching()) {\n            defer(function () {\n                listRemove(conn);\n            });\n        } else {\n            listRemove(conn);\n        }\n    }\n\n    private function defer (fn :Void->Void)\n    {\n        var tail = null, p = _deferredTasks;\n        while (p != null) {\n            tail = p;\n            p = p.next;\n        }\n\n        var task = new Task(fn);\n        if (tail != null) {\n            tail.next = task;\n        } else {\n            _deferredTasks = task;\n        }\n    }\n\n    private function willEmit () :SignalConnection\n    {\n        // Should never happen, since the public emit methods will defer, but just in case...\n        Assert.that(!dispatching());\n\n        var snapshot = _head;\n        _head = DISPATCHING_SENTINEL;\n        return snapshot;\n    }\n\n    private function didEmit (head :SignalConnection)\n    {\n        _head = head;\n\n        var snapshot = _deferredTasks;\n        _deferredTasks = null;\n        while (snapshot != null) {\n            snapshot.fn();\n            snapshot = snapshot.next;\n        }\n    }\n\n    private function listAdd (conn :SignalConnection, prioritize :Bool)\n    {\n        if (prioritize) {\n            // Prepend it to the beginning of the list\n            conn._next = _head;\n            _head = conn;\n        } else {\n            // Append it to the end of the list\n            var tail = null, p = _head;\n            while (p != null) {\n                tail = p;\n                p = p._next;\n            }\n            if (tail != null) {\n                tail._next = conn;\n            } else {\n                _head = conn;\n            }\n        }\n    }\n\n    private function listRemove (conn :SignalConnection)\n    {\n        var prev :SignalConnection = null, p = _head;\n        while (p != null) {\n            if (p == conn) {\n                // Splice out p\n                var next = p._next;\n                if (prev == null) {\n                    _head = next;\n                } else {\n                    prev._next = next;\n                }\n                return;\n            }\n            prev = p;\n            p = p._next;\n        }\n    }\n\n    inline private function dispatching () :Bool\n    {\n        return _head == DISPATCHING_SENTINEL;\n    }\n\n    private static var DISPATCHING_SENTINEL = new SignalConnection(null, null);\n\n    private var _head :SignalConnection;\n    private var _deferredTasks :Task;\n}\n\nprivate class Task\n{\n    public var fn :Void->Void;\n    public var next :Task = null;\n\n    public function new (fn :Void->Void)\n    {\n        this.fn = fn;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * An alias for Signal2 listeners.\n */\ntypedef Listener2<A,B> = A -> B -> Void;\n\n/**\n * A two-argument signal. See Signal0 and Signal1 for different arities.\n */\nclass Signal2<A,B> extends SignalBase\n{\n    /**\n     * @param listener An optional listener to immediately connect to the signal.\n     */\n    public function new (?listener :Listener2<A,B>)\n    {\n        super(listener);\n    }\n\n    /**\n     * Connects a listener to this signal.\n     * @param prioritize True if this listener should fire before others.\n     * @returns A SignalConnection, that can be disposed to remove the listener.\n     */\n    public function connect (listener :Listener2<A,B>, prioritize :Bool = false) :SignalConnection\n    {\n        return connectImpl(listener, prioritize);\n    }\n\n    /**\n     * Emit the signal, notifying each connected listener.\n     */\n    public function emit (arg1 :A, arg2 :B)\n    {\n        if (dispatching()) {\n            defer(function () {\n                emitImpl(arg1, arg2);\n            });\n        } else {\n            emitImpl(arg1, arg2);\n        }\n    }\n\n    private function emitImpl (arg1 :A, arg2 :B)\n    {\n        var head = willEmit();\n        var p = head;\n        while (p != null) {\n            p._listener(arg1, arg2);\n            if (!p.stayInList) {\n                p.dispose();\n            }\n            p = p._next;\n        }\n        didEmit(head);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * An alias for Signal1 listeners.\n */\ntypedef Listener1<A> = A -> Void;\n\n/**\n * A one-argument signal. See Signal0 and Signal2 for different arities.\n */\nclass Signal1<A> extends SignalBase\n{\n    /**\n     * @param listener An optional listener to immediately connect to the signal.\n     */\n    public function new (?listener :Listener1<A>)\n    {\n        super(listener);\n    }\n\n    /**\n     * Connects a listener to this signal.\n     * @param prioritize True if this listener should fire before others.\n     * @returns A SignalConnection, that can be disposed to remove the listener.\n     */\n    public function connect (listener :Listener1<A>, prioritize :Bool = false) :SignalConnection\n    {\n        return connectImpl(listener, prioritize);\n    }\n\n    /**\n     * Emit the signal, notifying each connected listener.\n     */\n    public function emit (arg1 :A)\n    {\n        if (dispatching()) {\n            defer(function () {\n                emitImpl(arg1);\n            });\n        } else {\n            emitImpl(arg1);\n        }\n    }\n\n    private function emitImpl (arg1 :A)\n    {\n        var head = willEmit();\n        var p = head;\n        while (p != null) {\n            p._listener(arg1);\n            if (!p.stayInList) {\n                p.dispose();\n            }\n            p = p._next;\n        }\n        didEmit(head);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.animation;\n\nimport flambe.animation.Binding;\nimport flambe.animation.Ease;\nimport flambe.util.Signal2;\nimport flambe.util.Value;\n\n/**\n * A Float value that may be animated over time.\n */\nclass AnimatedFloat extends Value<Float>\n{\n    /**\n     * The behavior that is currently animating the value, or null if the value is not being\n     * animated.\n     */\n    public var behavior (get, set) :Behavior;\n\n    public function new (value :Float, ?listener :Listener2<Float,Float>)\n    {\n        super(value, listener);\n    }\n\n    override private function set__ (value :Float) :Float\n    {\n        _behavior = null;\n        return super.set__(value);\n    }\n\n    public function update (dt :Float)\n    {\n        if (_behavior != null) {\n            super.set__(_behavior.update(dt));\n            if (_behavior.isComplete()) {\n                _behavior = null;\n            }\n        }\n    }\n\n    /**\n     * Animates between the two given values.\n     *\n     * @param from The initial value.\n     * @param to The target value.\n     * @param seconds The animation duration, in seconds.\n     * @param easing The easing function to use, defaults to `Ease.linear`.\n     */\n    public function animate (from :Float, to :Float, seconds :Float, ?easing :EaseFunction)\n    {\n        set__(from);\n        animateTo(to, seconds, easing);\n    }\n\n    /**\n     * Animates between the current value and the given value.\n     *\n     * @param to The target value.\n     * @param seconds The animation duration, in seconds.\n     * @param easing The easing function to use, defaults to `Ease.linear`.\n     */\n    public function animateTo (to :Float, seconds :Float, ?easing :EaseFunction)\n    {\n        behavior = new Tween(_value, to, seconds, easing);\n    }\n\n    /**\n     * Animates the current value by the given delta.\n     *\n     * @param by The delta added to the current value to get the target value.\n     * @param seconds The animation duration, in seconds.\n     * @param easing The easing function to use, defaults to `Ease.linear`.\n     */\n    public function animateBy (by :Float, seconds :Float, ?easing :EaseFunction)\n    {\n        behavior = new Tween(_value, _value + by, seconds, easing);\n    }\n\n    inline public function bindTo (to :Value<Float>, ?fn :BindingFunction)\n    {\n        behavior = new Binding(to, fn);\n    }\n\n    private function set_behavior (behavior :Behavior) :Behavior\n    {\n        _behavior = behavior;\n        update(0);\n        return behavior;\n    }\n\n    inline private function get_behavior () :Behavior\n    {\n        return _behavior;\n    }\n\n    private var _behavior :Behavior = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\npackage flambe;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.asset.AssetPack;\nimport flambe.asset.Manifest;\nimport flambe.platform.Platform;\nimport flambe.subsystem.ExternalSystem; // IDEA doesn't support wildcard imports\nimport flambe.subsystem.KeyboardSystem;\nimport flambe.subsystem.MotionSystem;\nimport flambe.subsystem.MouseSystem;\nimport flambe.subsystem.PointerSystem;\nimport flambe.subsystem.RendererSystem;\nimport flambe.subsystem.StageSystem;\nimport flambe.subsystem.StorageSystem;\nimport flambe.subsystem.TouchSystem;\nimport flambe.subsystem.WebSystem;\nimport flambe.util.Assert;\nimport flambe.util.Logger;\nimport flambe.util.Promise;\nimport flambe.util.Signal1;\nimport flambe.util.Value;\n\n/**\n * Provides access to all the different subsystems implemented on each platform.\n */\n@:expose\nclass System {\n\t/**\n\t * The entity at the root of the hierarchy.\n\t */\n\tpublic static var root(default, null):Entity = new Entity();\n\n\t/**\n\t * The Stage subsystem, for controlling the display viewport.\n\t */\n\tpublic static var stage(get, null):StageSystem;\n\n\t/**\n\t * The Storage subsystem, for persisting values.\n\t */\n\tpublic static var storage(get, null):StorageSystem;\n\n\t/**\n\t * The Pointer subsystem, for unified mouse/touch events.\n\t */\n\tpublic static var pointer(get, null):PointerSystem;\n\n\t/**\n\t * The Mouse subsystem, for direct access to the mouse.\n\t */\n\tpublic static var mouse(get, null):MouseSystem;\n\n\t/**\n\t * The Touch subsystem, for direct access to the multi-touch.\n\t */\n\tpublic static var touch(get, null):TouchSystem;\n\n\t/**\n\t * The Keyboard subsystem, for keyboard events.\n\t */\n\tpublic static var keyboard(get, null):KeyboardSystem;\n\n\t/**\n\t * The Web subsystem, for using the device's web browser.\n\t */\n\tpublic static var web(get, null):WebSystem;\n\n\t/**\n\t * The External subsystem, for interaction with external code.\n\t */\n\tpublic static var external(get, null):ExternalSystem;\n\n\t/**\n\t * The Motion subsystem, for events from the device's motion sensors.\n\t */\n\tpublic static var motion(get, null):MotionSystem;\n\n\t/**\n\t * The Renderer subsystem, for creating textures and accessing the GPU.\n\t */\n\tpublic static var renderer(get, null):RendererSystem<\n\t\t#if flash\n\t\tflash.display.BitmapData\n\t\t#elseif js\n\t\tjs.html.Element\n\t\t#end\n\t\t>;\n\n\t// TODO(bruno): Subsystems for gamepads, haptic, geolocation, video, textInput\n\n\t/**\n\t * Gets the RFC 4646 language tag of the environment. For example, \"en-US\", \"pt\", or null if the\n\t * locale is unknown.\n\t */\n\tpublic static var locale(get, null):String;\n\n\t/**\n\t * Emitted when an uncaught exception occurs, if the platform supports it.\n\t */\n\tpublic static var uncaughtError(default, null):Signal1<String> = new Signal1<String>();\n\n\t/**\n\t * True when the app is not currently visible, such as when minimized or placed in a background\n\t * browser tab. While hidden, frame updates may be paused or throttled.\n\t */\n\tpublic static var hidden(default, null):Value<Bool> = new Value<Bool>(false);\n\n\t/**\n\t * Gets the current clock time, in <b>seconds</b> since January 1, 1970. Depending on the\n\t * platform, this may be slightly more efficient than Date.now().getTime().\n\t */\n\tpublic static var time(get, null):Float;\n\n\t/**\n\t * The global volume applied to all sounds, defaults to 1.\n\t */\n\tpublic static var volume(default, null):AnimatedFloat = new AnimatedFloat(1);\n\n\t/**\n\t * Starts up Flambe, this should usually be the first thing a game does.\n\t */\n\tpublic static function init() {\n\t\tif (!_calledInit) {\n\t\t\t_platform.init();\n\t\t\t_calledInit = true;\n\t\t}\n\t}\n\n\t/**\n\t * Request to load an asset pack described by the given manifest.\n\t */\n\tinline public static function loadAssetPack(manifest:Manifest):Promise<AssetPack> {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.loadAssetPack(manifest);\n\t}\n\n\t/**\n\t * Creates a Logger for printing debug messages. In Flash, this uses the native trace()\n\t * function. In JS, logging goes to the console object. Logging is stripped from non-debug\n\t * builds.\n\t */\n\tinline public static function createLogger(tag:String):Logger {\n\t\t// No need to assertCalledInit here, this should be callable from static initializers\n\t\treturn new Logger(_platform.createLogHandler(tag));\n\t}\n\n\tinline private static function get_time():Float {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getTime();\n\t}\n\n\tinline private static function get_stage():StageSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getStage();\n\t}\n\n\tinline private static function get_storage():StorageSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getStorage();\n\t}\n\n\tinline private static function get_pointer():PointerSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getPointer();\n\t}\n\n\tinline private static function get_mouse():MouseSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getMouse();\n\t}\n\n\tinline private static function get_touch():TouchSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getTouch();\n\t}\n\n\tinline private static function get_keyboard():KeyboardSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getKeyboard();\n\t}\n\n\tinline private static function get_web():WebSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getWeb();\n\t}\n\n\tinline private static function get_external():ExternalSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getExternal();\n\t}\n\n\tinline private static function get_locale():String {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getLocale();\n\t}\n\n\tinline static function get_motion():MotionSystem {\n\t\t#if debug assertCalledInit(); #end\n\t\treturn _platform.getMotion();\n\t}\n\n\tinline static function get_renderer() // inferred return type\n\t{\n\t\t#if debug assertCalledInit(); #end\n\t\treturn cast _platform.getRenderer();\n\t}\n\n\tprivate static function assertCalledInit() {\n\t\tAssert.that(_calledInit, \"You must call System.init() first\");\n\t}\n\n\tprivate static var _platform:Platform =\n\t\t#if flash\n\t\tflambe.platform.flash.FlashPlatform.instance;\n\t\t#elseif (html || firefox)\n\t\tflambe.platform.html.HtmlPlatform.instance;\n\t\t#else\n\t\tnull;\n\t\t#end\n\n\tprivate static var _calledInit = false;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nusing flambe.util.Strings;\n\n/**\n * Represents the severity of a log message.\n */\nenum LogLevel {\n    /** General helpful information. */\n    Info;\n\n    /** An unexpected but recoverable problem. */\n    Warn;\n\n    /** A fatal, unrecoverable problem. */\n    Error;\n}\n\ninterface LogHandler\n{\n    function log (level :LogLevel, message :String) :Void;\n}\n\n/**\n * A logging system, for printing formatted debug messages. Logging is stripped from release builds,\n * unless the `-D flambe_keep_logs` compiler flag is used.\n *\n * ```haxe\n * var log = System.createLogger(\"mygame\");\n * log.info(\"Player logged in\", [\"name\", \"Joe\", \"level\", 24]);\n * // Logs \"INFO mygame: Player logged in [name=Joe, level=24]\"\n * ```\n *\n * See `PackageLog` for a handy way to setup logging across a whole project.\n */\nclass Logger\n{\n    /**\n     * @param handler The handler that logs will be sent to for printing.\n     */\n    public function new (handler :LogHandler)\n    {\n        _handler = handler;\n    }\n\n#if (debug || flambe_keep_logs)\n    /**\n     * Logs a message at the `Info` severity level.\n     *\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function info (?text :String, ?fields :Array<Dynamic>)\n    {\n        log(Info, text, fields);\n    }\n\n    /**\n     * Logs a message at the `Warn` severity level.\n     *\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function warn (?text :String, ?fields :Array<Dynamic>)\n    {\n        log(Warn, text, fields);\n    }\n\n    /**\n     * Logs a message at the `Error` severity level.\n     *\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function error (?text :String, ?fields :Array<Dynamic>)\n    {\n        log(Error, text, fields);\n    }\n\n    /**\n     * Logs a message at the given severity level.\n     *\n     * @param level The severity of the log message.\n     * @param text The message to log.\n     * @param fields Extra information to be formatted with `Strings.withFields`.\n     */\n    public function log (level :LogLevel, ?text :String, ?fields :Array<Dynamic>)\n    {\n        if (_handler == null) {\n            return; // No handler, carry on quietly\n        }\n        if (text == null) {\n            text = \"\";\n        }\n        if (fields != null) {\n            text = text.withFields(fields);\n        }\n        _handler.log(level, text);\n    }\n\n#else\n    // In release builds, logging calls are stripped out\n    inline public function info (?text :String, ?fields :Array<Dynamic>) {}\n    inline public function warn (?text :String, ?fields :Array<Dynamic>) {}\n    inline public function error (?text :String, ?fields :Array<Dynamic>) {}\n    inline public function log (level :LogLevel, ?text :String, ?fields :Array<Dynamic>) {}\n#end\n\n    private var _handler :LogHandler;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.animation.AnimatedFloat;\n\n/**\n * Adjusts the update speed of an entity (and its components and children). Can be used for slow\n * motion and fast forward effects.\n */\nclass SpeedAdjuster extends Component\n{\n    /**\n     * The scale that time should pass for the owning entity and its children. Values lower than\n     * 1.0 will play slower than realtime, and values higher than 1.0 will play faster. When the\n     * scale is 0, the entity is basically paused.\n     */\n    public var scale (default, null) :AnimatedFloat;\n\n    public function new (scale :Float = 1)\n    {\n        this.scale = new AnimatedFloat(scale);\n    }\n\n    // Note that this may be called by MainLoop before onStarted!\n    override public function onUpdate (dt :Float)\n    {\n        // Ensure this component is immune to its own time scaling\n        if (_realDt > 0) {\n            dt = _realDt;\n            _realDt = 0;\n        }\n\n        scale.update(dt);\n    }\n\n    @:allow(flambe) var _realDt :Float = 0;\n}\n","package flambe.animation;\r\n\r\nimport flambe.animation.AnimatedFloat;\r\nimport flambe.animation.Behavior;\r\nimport flambe.math.FMath;\r\n\r\n/**\r\n * Controls an AnimatedFloat using a Sine wave, typically endlessly.\r\n * Useful for flashing a notification, or creating a throbbing animation effect without using a Script.\r\n * \r\n * @author Kipp Ashford\r\n */\r\nclass Sine\r\n    implements Behavior\r\n{\r\n\t/** The end value. */\r\n\tpublic var end(default, null):Float;\r\n\t/** The starting value. */\r\n\tpublic var start(default, null):Float;\r\n\t/** The number of times to animate between the starting value and the end value. */\r\n\tpublic var cycles(default, null):Float;\r\n\t/** The speed, in seconds, it takes to animate between the starting value and the ending value (or the other way around) */\r\n\tpublic var speed(default, null):AnimatedFloat;\r\n\t\r\n\t/**\r\n\t * @param start The starting value for the animated float.\r\n\t * @param end The last value for the animated float.\r\n\t * @param speed The speed (in seconds) it takes to go from the start value to the end value.\r\n\t * @param cycles The number of animation cycles to go through. A value of 0 will cycle forever,\r\n\t *   whereas a value of 1 will go from the start position, to the end position, and back to start.\r\n\t * @param offset The number of seconds to offset the animation. Useful for offseting the animation for a series of sine behaviors.\r\n\t */\r\n\tpublic function new(start:Float, end:Float, ?speed:Float = 1, ?cycles:Float = 0, ?offset:Float = 0) \r\n\t{\r\n\t\tthis.start = start;\r\n\t\tthis.end = end;\r\n\t\tthis.cycles = cycles;\r\n\t\tthis.speed = new AnimatedFloat(speed);\r\n\t\t\r\n\t\t_count = HALF_PI + offset * (FMath.PI / speed); // Start at the start value plus the seconds to offset.\r\n\t\t_distance = (start - end) * .5;\r\n\t\t_center = end + _distance;\r\n\t}\r\n\t\r\n\tpublic function update(dt :Float):Float {\r\n\t\tthis.speed.update(dt);\r\n\t\t_count += dt * (FMath.PI / speed._);\r\n\t\tif (isComplete()) {\r\n\t\t\treturn _center + FMath.PI * _distance;\r\n\t\t}\r\n\t\treturn _center + Math.sin(_count) * _distance;\r\n\t}\r\n\t\r\n\tpublic function isComplete() :Bool {\r\n\t\treturn cycles > 0 && ((_count - HALF_PI) / FMath.PI) * .5 >= cycles;\r\n\t}\r\n\t\r\n\t/** Stores the half value of PI for quicker calculations. */\r\n\tprivate static inline var HALF_PI:Float = { .5 * FMath.PI; };\r\n\t/** The number of times to animate. */\r\n\tprivate var _count :Float;\r\n\t/** The total distance between the start and end values */\r\n    private var _distance :Float;\r\n\t/** The middle of the start and end position, stored for quicker math. */\r\n\tprivate var _center :Float;\r\n}\r\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.asset;\n\nusing flambe.util.Strings;\n\n/** Specifies all supported asset formats across all Flambe platforms. */\nenum AssetFormat\n{\n    // Images\n    WEBP; JXR; PNG; JPG; GIF;\n\n    // Compressed textures\n    DDS; PVR; PKM;\n\n    // Audio\n    MP3; M4A; OPUS; OGG; WAV;\n\n    // Raw text/data\n    Data;\n}\n\n/**\n * Defines an asset that will be loaded.\n */\nclass AssetEntry\n{\n    /**\n     * The name of this asset.\n     */\n    public var name (default, null) :String;\n\n    /**\n     * The URL or file path this asset will be loaded from. Will be appended to `Manifest.localBase`\n     * or `Manifest.remoteBase` to get the actual URL to load from.\n     */\n    public var url (default, null) :String;\n\n    /**\n     * The format this asset will be loaded as.\n     */\n    public var format (default, null) :AssetFormat;\n\n    /**\n     * The size of this asset in bytes, or 0 if unknown.\n     */\n    public var bytes (default, null) :Int;\n\n    public function new (name :String, url :String, format :AssetFormat, bytes :Int)\n    {\n        this.name = name;\n        this.url = url;\n        this.format = format;\n        this.bytes = bytes;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.asset;\n\nimport haxe.rtti.Meta;\n\nimport flambe.asset.AssetEntry;\nimport flambe.util.Assert;\n\nusing StringTools;\nusing flambe.util.Strings;\n\n/**\n * An asset manifest contains all the information needed to load an asset pack. A manifest is\n * usually created with `Manifest.fromAssets(\"directory\")`, but manifests can also be assembled\n * programmatically.\n */\nclass Manifest\n{\n    /**\n     * A base path on the current domain to load this manifest's assets from, or null.\n     */\n    public var localBase (get, set) :String;\n\n    /**\n     * A base URL on another domain to load this manifest's assets from, or null. May be used to\n     * load assets from a CDN, in browsers that support cross-domain requests. If not supported or\n     * unset, will fallback to using localBase.\n     */\n    public var remoteBase (get, set) :String;\n\n    public function new ()\n    {\n        _entries = [];\n    }\n\n    /**\n     * Gets the manifest of a pack in the asset directory, that was processed at build-time.\n     * @param packName The folder name in your assets/ directory.\n     * @param required When true and this pack was not found, throw an error. Otherwise null is\n     *   returned.\n     */\n    public static function fromAssets (packName :String, required :Bool = true) :Manifest\n    {\n        var packData :Array<Dynamic> = Reflect.field(Meta.getType(Manifest).assets[0], packName);\n        if (packData == null) {\n            if (required) {\n                throw \"Missing asset pack\".withFields([\"name\", packName]);\n            }\n            return null;\n        }\n\n        var manifest = new Manifest();\n        manifest.localBase = \"assets\";\n\n        for (asset in packData) {\n            var name = asset.name;\n            var path = packName + \"/\" + name + \"?v=\" + asset.md5;\n\n            var format = inferFormat(name);\n            if (format != Data) {\n                // If this an asset that not all platforms may support, trim the extension from\n                // the name. We'll only load one of the assets if this creates a name collision.\n                name = name.removeFileExtension();\n            }\n\n            manifest.add(name, path, asset.bytes, format);\n        }\n\n        return manifest;\n    }\n\n    /**\n     * Tries to find a pack suffixed with the closest available variant of the locale. For example,\n     * fromAssetsLocalized(\"foo\", \"pt-BR\") will first try to load foo_pt-BR, then foo_pt, then just\n     * foo.\n     * @param packName The folder name in your assets/ directory.\n     * @param locale An RFC 4646 language tag, or null to use the system language.\n     * @param required When true and this pack was not found, throw an error. Otherwise null is\n     *   returned.\n     */\n    public static function fromAssetsLocalized (\n        packName :String, locale :String = null, required :Bool = true) :Manifest\n    {\n        if (locale == null) {\n            locale = System.locale;\n        }\n\n        if (locale != null) {\n            var parts = locale.split(\"-\");\n            while (parts.length > 0) {\n                var manifest = fromAssets(packName + \"_\" + parts.join(\"-\"), false);\n                if (manifest != null) {\n                    return manifest;\n                }\n                parts.pop();\n            }\n        }\n        return fromAssets(packName, required);\n    }\n\n    /**\n     * Returns true if the given named pack was included in the asset directory at build-time.\n     */\n    public static function exists (packName :String) :Bool\n    {\n        return Reflect.hasField(Meta.getType(Manifest).assets[0], packName);\n    }\n\n    /**\n     * Adds an asset entry to this manifest.\n     * @param name The name of the asset.\n     * @param url The URL this asset will be downloaded from.\n     * @param bytes The size in bytes.\n     * @param format Optionally specified content format, by default infer it from the URL.\n     */\n    public function add (name :String, url :String, bytes :Int = 0, ?format :AssetFormat) :AssetEntry\n    {\n        if (format == null) {\n            format = inferFormat(url);\n        }\n\n        var entry = new AssetEntry(name, url, format, bytes);\n        _entries.push(entry);\n        return entry;\n    }\n\n    /**\n     * Iterates over all the assets defined in this manifest.\n     */\n    inline public function iterator () :Iterator<AssetEntry>\n    {\n        return _entries.iterator();\n    }\n\n    /**\n     * Creates a copy of this manifest.\n     */\n    public function clone () :Manifest\n    {\n        var copy = new Manifest();\n        copy.localBase = localBase;\n        copy.remoteBase = remoteBase;\n        copy._entries = _entries.copy();\n        return copy;\n    }\n\n    /**\n     * Get the full URL to load an asset from. Will prepend localBase or remoteBase depending on\n     * cross-domain support.\n     */\n    public function getFullURL (entry :AssetEntry) :String\n    {\n        var basePath = (remoteBase != null && _supportsCrossOrigin) ? remoteBase : localBase;\n        return (basePath != null) ? basePath.joinPath(entry.url) : entry.url;\n    }\n\n    private function get_localBase () :String\n    {\n        return _localBase;\n    }\n\n    private function set_localBase (localBase :String) :String\n    {\n        if (localBase != null) {\n            Assert.that(!localBase.startsWith(\"http://\") && !localBase.startsWith(\"https://\"),\n                \"localBase must be a path on the same domain, NOT starting with http(s)://\");\n        }\n        return _localBase = localBase;\n    }\n\n    private function get_remoteBase () :String\n    {\n        return _remoteBase;\n    }\n\n    private function set_remoteBase (remoteBase :String) :String\n    {\n        if (remoteBase != null) {\n            Assert.that(remoteBase.startsWith(\"http://\") || remoteBase.startsWith(\"https://\"),\n                \"remoteBase must be on a remote domain, starting with http(s)://\");\n        }\n        return _remoteBase = remoteBase;\n    }\n\n    private static function inferFormat (url :String) :AssetFormat\n    {\n        var extension = url.getUrlExtension();\n        if (extension != null) {\n            switch (extension.toLowerCase()) {\n                case \"gif\": return GIF;\n                case \"jpg\", \"jpeg\": return JPG;\n                case \"jxr\", \"wdp\": return JXR;\n                case \"png\": return PNG;\n                case \"webp\": return WEBP;\n\n                case \"dds\": return DDS;\n                case \"pvr\": return PVR;\n                case \"pkm\": return PKM;\n\n                case \"m4a\": return M4A;\n                case \"mp3\": return MP3;\n                case \"ogg\": return OGG;\n                case \"opus\": return OPUS;\n                case \"wav\": return WAV;\n            }\n        } else {\n            Log.warn(\"No file extension for asset, it will be loaded as data\", [\"url\", url]);\n        }\n        return Data;\n    }\n\n    // Whether the environment fully supports loading assets from another domain\n    private static var _supportsCrossOrigin :Bool = (function () {\n        var detected =\n#if html\n        (function () {\n            // CORS in the stock Android browser is buggy. If your game is contained in an iframe, XHR\n            // will work the first time. If the response had an Expires header, on subsequent page loads\n            // instead of retrieving it from the cache, it will fail with error code 0.\n            // http://stackoverflow.com/questions/6090816/android-cors-requests-work-only-once\n            if (js.Browser.navigator.userAgent.indexOf(\"Linux; U; Android\") >= 0) {\n                return false;\n            }\n\n            var xhr :Dynamic = js.Syntax.construct(\"XMLHttpRequest\");\n            return (xhr.withCredentials != null);\n        })();\n#else\n            true; // Assumes you have a valid crossdomain.xml\n#end\n        if (!detected) {\n            Log.warn(\"This browser does not support cross-domain asset loading, any Manifest.remoteBase setting will be ignored.\");\n        }\n        return detected;\n    })();\n\n    private var _entries :Array<AssetEntry>;\n\n    private var _localBase :String = null;\n    private var _remoteBase :String = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * A 2D point or vector.\n */\nclass Point\n{\n    public var x :Float;\n    public var y :Float;\n\n    public function new (x :Float = 0, y :Float = 0)\n    {\n        this.x = x;\n        this.y = y;\n    }\n\n    /**\n     * Re-assign the coordinates of this point.\n     */\n    public function set (x :Float, y :Float)\n    {\n        this.x = x;\n        this.y = y;\n    }\n\n    /**\n     * Normalize this vector, so that its new magnitude is 1.\n     */\n    public function normalize ()\n    {\n        var m = magnitude();\n        x /= m;\n        y /= m;\n    }\n\n    /**\n     * The dot product of two vectors.\n     */\n    public function dot (x :Float, y :Float) :Float\n    {\n        return this.x*x + this.y*y;\n    }\n\n    /**\n     * Scales a vector's magnitude by a given value.\n     */\n    public function multiply (n :Float)\n    {\n        x *= n;\n        y *= n;\n    }\n\n    /**\n     * The magnitude (length) of this vector.\n     */\n    public function magnitude () :Float\n    {\n        return Math.sqrt(x*x + y*y);\n    }\n\n    /**\n     * The distance between this point and another point.\n     */\n    public function distanceTo (x :Float, y :Float) :Float\n    {\n        return Math.sqrt(distanceToSquared(x, y));\n    }\n\n    /**\n     * The squared distance between this point and another point. This is a faster operation than\n     * distanceTo.\n     */\n    public function distanceToSquared (x :Float, y :Float) :Float\n    {\n        var dx = this.x-x;\n        var dy = this.y-y;\n        return dx*dx + dy*dy;\n    }\n\n    /**\n     * Creates a copy of this point.\n     */\n    public function clone (?result :Point) :Point\n    {\n        if (result == null) {\n            return new Point(x, y);\n        }\n        result.set(x, y);\n        return result;\n    }\n\n    public function equals (other :Point) :Bool\n    {\n        return x == other.x && y == other.y;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return \"(\" + x + \",\" + y + \")\";\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.display;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.display.Sprite;\nimport flambe.input.PointerEvent;\nimport flambe.math.FMath;\nimport flambe.math.Matrix;\nimport flambe.math.Point;\nimport flambe.math.Rectangle;\nimport flambe.scene.Director;\nimport flambe.util.Signal1;\nimport flambe.util.SignalConnection;\nimport flambe.util.Value;\n\nusing flambe.util.BitSets;\n\nclass Sprite extends Component\n{\n    /**\n     * X position, in pixels.\n     */\n    public var x (default, null) :AnimatedFloat;\n\n    /**\n     * Y position, in pixels.\n     */\n    public var y (default, null) :AnimatedFloat;\n\n    /**\n     * Rotation angle, in degrees.\n     */\n    public var rotation (default, null) :AnimatedFloat;\n\n    /**\n     * Horizontal scale factor.\n     */\n    public var scaleX (default, null) :AnimatedFloat;\n\n    /**\n     * Vertical scale factor.\n     */\n    public var scaleY (default, null) :AnimatedFloat;\n\n    /**\n     * The X position of this sprite's anchor point. Local transformations are applied relative to\n     * this point.\n     */\n    public var anchorX (default, null) :AnimatedFloat;\n\n    /**\n     * The Y position of this sprite's anchor point. Local transformations are applied relative to\n     * this point.\n     */\n    public var anchorY (default, null) :AnimatedFloat;\n\n    /**\n     * The alpha (opacity) of this sprite, between 0 (invisible) and 1 (fully opaque).\n     */\n    public var alpha (default, null) :AnimatedFloat;\n\n    /**\n     * The blend mode used to draw this sprite, or null to use its parent's blend mode.\n     */\n    public var blendMode :BlendMode = null;\n\n    /**\n     * The scissor rectangle used for clipping/masking, in the local coordinate system. The scissor\n     * rectangle affects both rendering and hit testing, and applies to this sprite and all\n     * children. Rectangles with negative width or height are OK.\n     *\n     * __WARNING__: When using scissor testing, this sprite (and its parents) must not be rotated.\n     * The scissor rectangle must be axis-aligned when converted to screen coordinates.\n     */\n    public var scissor :Rectangle = null;\n\n    /**\n     * Whether this sprite should be drawn. Invisible sprites do not receive pointer events.\n     */\n    public var visible (get, set) :Bool;\n\n    /**\n     * Whether this sprite's position will be rounded to the nearest whole pixel when rendering, for\n     * crisper images. Defaults to true. This can be disabled for smoother animation, at the risk of\n     * fuzziness when an image lies on a subpixel.\n     */\n    public var pixelSnapping (get, set) :Bool;\n\n    /**\n     * Emitted when the pointer is pressed down over this sprite.\n     */\n    public var pointerDown (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is moved over this sprite.\n     */\n    public var pointerMove (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is raised over this sprite.\n     */\n    public var pointerUp (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is moved inside of this sprite.\n     */\n    public var pointerIn (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Emitted when the pointer is moved outside of this sprite. If the pointer is a touch, also\n     * emitted when the touch is lifted from this sprite.\n     */\n    public var pointerOut (get, null) :Signal1<PointerEvent>;\n\n    /**\n     * Whether this sprite or any children should receive pointer events. Defaults to true.\n     */\n    public var pointerEnabled (get, set) :Bool;\n\n    public function new ()\n    {\n        _flags = _flags.add(VISIBLE | POINTER_ENABLED | VIEW_MATRIX_DIRTY | PIXEL_SNAPPING | ROTATION_DIRTY);\n        _localMatrix = new Matrix();\n\n        var dirtyMatrix = function (_,_) {\n            _flags = _flags.add(LOCAL_MATRIX_DIRTY | VIEW_MATRIX_DIRTY);\n        };\n        x = new AnimatedFloat(0, dirtyMatrix);\n        y = new AnimatedFloat(0, dirtyMatrix);\n        rotation = new AnimatedFloat(0, function(_,_) {\n            _flags = _flags.add(LOCAL_MATRIX_DIRTY | VIEW_MATRIX_DIRTY | ROTATION_DIRTY);\n        });\n        scaleX = new AnimatedFloat(1, dirtyMatrix);\n        scaleY = new AnimatedFloat(1, dirtyMatrix);\n        anchorX = new AnimatedFloat(0, dirtyMatrix);\n        anchorY = new AnimatedFloat(0, dirtyMatrix);\n\n        alpha = new AnimatedFloat(1);\n\n        this.disablePixelSnapping();\n    }\n\n    /**\n     * Search for a sprite in the entity hierarchy lying under the given point, in local\n     * coordinates. Ignores sprites that are invisible or not pointerEnabled during traversal.\n     * Returns null if neither the entity or its children contain a sprite under the given point.\n     */\n    public static function hitTest (entity :Entity, x :Float, y :Float) :Sprite\n    {\n        var sprite = entity.get(Sprite);\n        if (sprite != null) {\n            if (!sprite._flags.containsAll(VISIBLE | POINTER_ENABLED)) {\n                return null; // Prune invisible or non-interactive subtrees\n            }\n            if (sprite.getLocalMatrix().inverseTransform(x, y, _scratchPoint)) {\n                x = _scratchPoint.x;\n                y = _scratchPoint.y;\n            }\n\n            var scissor = sprite.scissor;\n            if (scissor != null && !scissor.contains(x, y)) {\n                return null; // Prune if outside the scissor rectangle\n            }\n        }\n\n        // Hit test all children, front to back\n        var result = hitTestBackwards(entity.firstChild, x, y);\n        if (result != null) {\n            return result;\n        }\n\n        // Finally, if we got this far, hit test the actual sprite\n        return (sprite != null && sprite.containsLocal(x, y)) ? sprite : null;\n    }\n\n    /**\n     * Calculate the bounding box of an entity hierarchy. Returns the smallest rectangle in local\n     * coordinates that fully encloses all child sprites.\n     */\n    public static function getBounds (entity :Entity, ?result :Rectangle) :Rectangle\n    {\n        if (result == null) {\n            result = new Rectangle();\n        }\n\n        // The width and height of this rectangle are hijacked to store the bottom right corner\n        result.set(FMath.FLOAT_MAX, FMath.FLOAT_MAX, FMath.FLOAT_MIN, FMath.FLOAT_MIN);\n        getBoundsImpl(entity, null, result);\n\n        // Convert back to a true width and height\n        result.width -= result.x;\n        result.height -= result.y;\n        return result;\n    }\n\n    /**\n     * Renders an entity hierarchy to the given Graphics.\n     */\n    public static function render (entity :Entity, g :Graphics)\n    {\n        // Render this entity's sprite\n        var sprite = entity.get(Sprite);\n        if (sprite != null) {\n            var alpha = sprite.alpha._;\n            if (!sprite.visible || alpha <= 0) {\n                return; // Prune traversal, this sprite and all children are invisible\n            }\n\n            g.save();\n            if (alpha < 1) {\n                g.multiplyAlpha(alpha);\n            }\n            if (sprite.blendMode != null) {\n                g.setBlendMode(sprite.blendMode);\n            }\n            var matrix = sprite.getLocalMatrix();\n\n            var m02 = matrix.m02;\n            var m12 = matrix.m12;\n            if (sprite.pixelSnapping) {\n                // Snap the translation to the nearest whole pixel\n                m02 = Math.round(m02);\n                m12 = Math.round(m12);\n            }\n            g.transform(matrix.m00, matrix.m10, matrix.m01, matrix.m11, m02, m12);\n\n            var scissor = sprite.scissor;\n            if (scissor != null) {\n                g.applyScissor(scissor.x, scissor.y, scissor.width, scissor.height);\n            }\n\n            sprite.draw(g);\n        }\n\n        // Render any partially occluded director scenes\n        var director = entity.get(Director);\n        if (director != null) {\n            var scenes = director.occludedScenes;\n            for (scene in scenes) {\n                render(scene, g);\n            }\n        }\n\n        // Render all children\n        var p = entity.firstChild;\n        while (p != null) {\n            var next = p.next;\n            render(p, g);\n            p = next;\n        }\n\n        // If save() was called, unwind it\n        if (sprite != null) {\n            g.restore();\n        }\n    }\n\n    /**\n     * The \"natural\" width of this sprite, without any transformations being applied. Used for hit\n     * testing. This does not consider child sprites, use Sprite.getBounds for that.\n     */\n    public function getNaturalWidth () :Float\n    {\n        return 0;\n    }\n\n    /**\n     * The \"natural\" height of this sprite, without any transformations being applied. Used for hit\n     * testing. This does not consider child sprites, use Sprite.getBounds for that.\n     */\n    public function getNaturalHeight () :Float\n    {\n        return 0;\n    }\n\n    /**\n     * Returns true if the given point (in viewport/stage coordinates) lies inside this sprite.\n     */\n    public function contains (viewX :Float, viewY :Float) :Bool\n    {\n        return getViewMatrix().inverseTransform(viewX, viewY, _scratchPoint) &&\n            containsLocal(_scratchPoint.x, _scratchPoint.y);\n    }\n\n    /**\n     * Returns true if the given point (in local coordinates) lies inside this sprite.\n     */\n    public function containsLocal (localX :Float, localY :Float) :Bool\n    {\n        return localX >= 0 && localX < getNaturalWidth()\n            && localY >= 0 && localY < getNaturalHeight();\n    }\n\n    /**\n     * Returns the local transformation matrix, relative to the parent. This matrix may be modified\n     * to position the sprite, but any changes will be invalidated when the x, y, scaleX, scaleY,\n     * rotation, anchorX, or anchorY properties are updated.\n     */\n    public function getLocalMatrix () :Matrix\n    {\n        if (_flags.contains(LOCAL_MATRIX_DIRTY)) {\n            _flags = _flags.remove(LOCAL_MATRIX_DIRTY);\n\n            if(_flags.contains(ROTATION_DIRTY)) {\n                _flags = _flags.remove(ROTATION_DIRTY);\n                var rotation :Float = FMath.toRadians(this.rotation._);\n                _sinCache = Math.sin(rotation);\n                _cosCache = Math.cos(rotation);\n            }\n\n            var scaleX :Float = this.scaleX._;\n            var scaleY :Float = this.scaleY._;\n            _localMatrix.set(_cosCache*scaleX, _sinCache*scaleX, -_sinCache*scaleY, _cosCache*scaleY, x._, y._);\n            _localMatrix.translate(-anchorX._, -anchorY._);\n        }\n        return _localMatrix;\n    }\n\n    /**\n     * Returns the view transformation matrix, relative to the root. Do NOT modify this matrix.\n     */\n    public function getViewMatrix () :Matrix\n    {\n        if (isViewMatrixDirty()) {\n            var parentSprite = getParentSprite();\n            _viewMatrix = (parentSprite != null)\n                ? Matrix.multiply(parentSprite.getViewMatrix(), getLocalMatrix(), _viewMatrix)\n                : getLocalMatrix().clone(_viewMatrix);\n\n            _flags = _flags.remove(VIEW_MATRIX_DIRTY);\n            if (parentSprite != null) {\n                _parentViewMatrixUpdateCount = parentSprite._viewMatrixUpdateCount;\n            }\n            ++_viewMatrixUpdateCount;\n        }\n        return _viewMatrix;\n    }\n\n    /**\n     * Chainable convenience method to set the anchor position.\n     * @returns This instance, for chaining.\n     */\n    public function setAnchor (x :Float, y :Float) :Sprite\n    {\n        anchorX._ = x;\n        anchorY._ = y;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to center the anchor using the natural width and height.\n     * @returns This instance, for chaining.\n     */\n    public function centerAnchor () :Sprite\n    {\n        anchorX._ = getNaturalWidth()/2;\n        anchorY._ = getNaturalHeight()/2;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set the position.\n     * @returns This instance, for chaining.\n     */\n    public function setXY (x :Float, y :Float) :Sprite\n    {\n        this.x._ = x;\n        this.y._ = y;\n        return this;\n    }\n\t\n    /**\n     * Chainable convenience method to set the alpha.\n     * @returns This instance, for chaining.\n     */\n    public function setAlpha (alpha :Float) :Sprite\n    {\n        this.alpha._ = alpha;\n        return this;\n    }\n\t\n    /**\n     * Chainable convenience method to set the rotation.\n     * @returns This instance, for chaining.\n     */\n    public function setRotation (rotation :Float) :Sprite\n    {\n        this.rotation._ = rotation;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to uniformly set the scale.\n     * @returns This instance, for chaining.\n     */\n    public function setScale (scale :Float) :Sprite\n    {\n        scaleX._ = scale;\n        scaleY._ = scale;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set the scale.\n     * @returns This instance, for chaining.\n     */\n    public function setScaleXY (scaleX :Float, scaleY :Float) :Sprite\n    {\n        this.scaleX._ = scaleX;\n        this.scaleY._ = scaleY;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set the blendMode.\n     * @returns This instance, for chaining.\n     */\n    public function setBlendMode (blendMode :BlendMode) :Sprite\n    {\n        this.blendMode = blendMode;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set pointerEnabled to false.\n     * @returns This instance, for chaining.\n     */\n    public function disablePointer () :Sprite\n    {\n        pointerEnabled = false;\n        return this;\n    }\n\n    /**\n     * Chainable convenience method to set pixelSnapping to false.\n     * @returns This instance, for chaining.\n     */\n    public function disablePixelSnapping () :Sprite\n    {\n        pixelSnapping = false;\n        return this;\n    }\n\n    override public function onAdded ()\n    {\n        if (_flags.contains(HOVERING)) {\n            connectHover();\n        }\n    }\n\n    override public function onRemoved ()\n    {\n        if (_hoverConnection != null) {\n            _hoverConnection.dispose();\n            _hoverConnection = null;\n        }\n    }\n\n    override public function onUpdate (dt :Float)\n    {\n        x.update(dt);\n        y.update(dt);\n        rotation.update(dt);\n        scaleX.update(dt);\n        scaleY.update(dt);\n        alpha.update(dt);\n        anchorX.update(dt);\n        anchorY.update(dt);\n    }\n\n    /**\n     * Draws this sprite to the given Graphics.\n     */\n    public function draw (g :Graphics)\n    {\n        // See subclasses\n    }\n\n    private function isViewMatrixDirty () :Bool\n    {\n        if (_flags.contains(VIEW_MATRIX_DIRTY)) {\n            return true;\n        }\n        var parentSprite = getParentSprite();\n        if (parentSprite == null) {\n            return false;\n        }\n        return _parentViewMatrixUpdateCount != parentSprite._viewMatrixUpdateCount\n            || parentSprite.isViewMatrixDirty();\n    }\n\n    private function getParentSprite () :Sprite\n    {\n        if (owner == null) {\n            return null;\n        }\n        var entity = owner.parent;\n        while (entity != null) {\n            var sprite = entity.get(Sprite);\n            if (sprite != null) {\n                return sprite;\n            }\n            entity = entity.parent;\n        }\n        return null;\n    }\n\n    private function get_pointerDown () :Signal1<PointerEvent>\n    {\n        if (_pointerDown == null) {\n            _pointerDown = new Signal1();\n        }\n        return _pointerDown;\n    }\n\n    private function get_pointerMove () :Signal1<PointerEvent>\n    {\n        if (_pointerMove == null) {\n            _pointerMove = new Signal1();\n        }\n        return _pointerMove;\n    }\n\n    private function get_pointerUp () :Signal1<PointerEvent>\n    {\n        if (_pointerUp == null) {\n            _pointerUp = new Signal1();\n        }\n        return _pointerUp;\n    }\n\n    private function get_pointerIn () :Signal1<PointerEvent>\n    {\n        if (_pointerIn == null) {\n            _pointerIn = new Signal1();\n        }\n        return _pointerIn;\n    }\n\n    private function get_pointerOut () :Signal1<PointerEvent>\n    {\n        if (_pointerOut == null) {\n            _pointerOut = new Signal1();\n        }\n        return _pointerOut;\n    }\n\n    private function connectHover ()\n    {\n        if (_hoverConnection != null) {\n            return;\n        }\n        _hoverConnection = System.pointer.move.connect(function (event) {\n            // Return early if this sprite was in the event chain\n            var hit = event.hit;\n            while (hit != null) {\n                if (hit == this) {\n                    return;\n                }\n                hit = hit.getParentSprite();\n            }\n\n            // This sprite is not under the pointer\n            if (_pointerOut != null && _flags.contains(HOVERING)) {\n                _pointerOut.emit(event);\n            }\n            _flags = _flags.remove(HOVERING);\n            if (_hoverConnection != null) {            \n                _hoverConnection.dispose();\n                _hoverConnection = null;\n            }\n        });\n    }\n\n    inline private function get_visible () :Bool\n    {\n        return _flags.contains(VISIBLE);\n    }\n\n    private function set_visible (visible :Bool) :Bool\n    {\n        _flags = _flags.set(VISIBLE, visible);\n        return visible;\n    }\n\n    inline private function get_pointerEnabled () :Bool\n    {\n        return _flags.contains(POINTER_ENABLED);\n    }\n\n    private function set_pointerEnabled (pointerEnabled :Bool) :Bool\n    {\n        _flags = _flags.set(POINTER_ENABLED, pointerEnabled);\n        return pointerEnabled;\n    }\n\n    inline private function get_pixelSnapping () :Bool\n    {\n        return _flags.contains(PIXEL_SNAPPING);\n    }\n\n    private function set_pixelSnapping (pixelSnapping :Bool) :Bool\n    {\n        _flags = _flags.set(PIXEL_SNAPPING, pixelSnapping);\n        return pixelSnapping;\n    }\n\n    @:allow(flambe) function onPointerDown (event :PointerEvent)\n    {\n        onHover(event);\n        if (_pointerDown != null) {\n            _pointerDown.emit(event);\n        }\n    }\n\n    @:allow(flambe) function onPointerMove (event :PointerEvent)\n    {\n        onHover(event);\n        if (_pointerMove != null) {\n            _pointerMove.emit(event);\n        }\n    }\n\n    private function onHover (event :PointerEvent)\n    {\n        if (_flags.contains(HOVERING)) {\n            return; // Already hovering\n        }\n        _flags = _flags.add(HOVERING);\n\n        // Notify listeners and connect the hover-out listener\n        if ((_pointerIn != null || _pointerOut != null)) {\n            if (_pointerIn != null) {\n                _pointerIn.emit(event);\n            }\n            connectHover();\n        }\n    }\n\n    @:allow(flambe) function onPointerUp (event :PointerEvent)\n    {\n        switch (event.source) {\n        case Touch(point):\n            if (_pointerOut != null && _flags.contains(HOVERING)) {\n                _pointerOut.emit(event);\n            }\n            _flags = _flags.remove(HOVERING);\n            if (_hoverConnection != null) {\n                _hoverConnection.dispose();\n                _hoverConnection = null;\n            }\n        default:\n        }\n\n        if (_pointerUp != null) {\n            _pointerUp.emit(event);\n        }\n    }\n\n    private static function hitTestBackwards (entity :Entity, x :Float, y :Float) :Sprite\n    {\n        if (entity != null) {\n            var result = hitTestBackwards(entity.next, x, y);\n            return (result != null) ? result : hitTest(entity, x, y);\n        }\n        return null;\n    }\n\n    private static function getBoundsImpl (entity :Entity, matrix :Matrix, result :Rectangle)\n    {\n        var sprite = entity.get(Sprite);\n        if (sprite != null) {\n            matrix = (matrix != null)\n                ? Matrix.multiply(matrix, sprite.getLocalMatrix()) // Allocation!\n                : sprite.getLocalMatrix();\n\n            var x1 = 0.0, y1 = 0.0;\n            var x2 = sprite.getNaturalWidth(), y2 = sprite.getNaturalHeight();\n\n            // Intersecting scissor rectangles are too tricky for bounds calculation, ignore it for\n            // now...\n            // var scissor = sprite.scissor;\n            // if (scissor != null) {\n            //     x1 = FMath.max(x1, scissor.x);\n            //     y1 = FMath.max(y1, scissor.y);\n            //     x2 = FMath.min(x2, scissor.x + scissor.width);\n            //     y2 = FMath.min(y2, scissor.y + scissor.height);\n            // }\n\n            // Extend the rectangle out to fit this sprite\n            if (x2 > x1 && y2 > y1) {\n                extendRect(matrix, x1, y1, result);\n                extendRect(matrix, x2, y1, result);\n                extendRect(matrix, x2, y2, result);\n                extendRect(matrix, x1, y2, result);\n            }\n        }\n\n        // Recurse into partially occluded director scenes\n        var director = entity.get(Director);\n        if (director != null) {\n            var scenes = director.occludedScenes;\n            var ii = 0, ll = scenes.length;\n            while (ii < ll) {\n                getBoundsImpl(scenes[ii], matrix, result);\n                ++ii;\n            }\n        }\n\n        // Recurse into all children\n        var p = entity.firstChild;\n        while (p != null) {\n            var next = p.next;\n            getBoundsImpl(p, matrix, result);\n            p = next;\n        }\n    }\n\n    private static function extendRect (matrix :Matrix, x :Float, y :Float, rect :Rectangle)\n    {\n        var p = matrix.transform(x, y, _scratchPoint);\n        x = p.x;\n        y = p.y;\n\n        // The width and height of the rectangle are treated like the bottom right point, rather\n        // than a true width and height offset\n        if (x < rect.x) rect.x = x;\n        if (y < rect.y) rect.y = y;\n        if (x > rect.width) rect.width = x;\n        if (y > rect.height) rect.height = y;\n    }\n\n    private static var _scratchPoint = new Point();\n\n    // Component flags\n    private static inline var VISIBLE = Component.NEXT_FLAG << 0;\n    private static inline var POINTER_ENABLED = Component.NEXT_FLAG << 1;\n    private static inline var LOCAL_MATRIX_DIRTY = Component.NEXT_FLAG << 2;\n    private static inline var VIEW_MATRIX_DIRTY = Component.NEXT_FLAG << 3;\n    private static inline var PIXEL_SNAPPING = Component.NEXT_FLAG << 4;\n    private static inline var HOVERING = Component.NEXT_FLAG << 5;\n    private static inline var ROTATION_DIRTY = Component.NEXT_FLAG << 6;\n    private static inline var NEXT_FLAG = Component.NEXT_FLAG << 7; // Must be last!\n\n    private var _localMatrix :Matrix;\n\n    private var _viewMatrix :Matrix = null;\n    private var _viewMatrixUpdateCount :Int = 0;\n    private var _parentViewMatrixUpdateCount :Int = 0;\n    private var _sinCache :Float = 0;\n    private var _cosCache :Float = 0;\n    private var _pointerDown :Signal1<PointerEvent>;\n    private var _pointerMove :Signal1<PointerEvent>;\n    private var _pointerUp :Signal1<PointerEvent>;\n\n    private var _pointerIn :Signal1<PointerEvent>;\n    private var _pointerOut :Signal1<PointerEvent>;\n    private var _hoverConnection :SignalConnection;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.display;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.util.Value;\n\n/**\n * A sprite that displays a rectangle filled with a given color.\n */\nclass FillSprite extends Sprite\n{\n    public var color :Int;\n    public var width (default, null) :AnimatedFloat;\n    public var height (default, null) :AnimatedFloat;\n\n    public function new (color :Int, width :Float, height :Float)\n    {\n        super();\n        this.color = color;\n        this.width = new AnimatedFloat(width);\n        this.height = new AnimatedFloat(height);\n    }\n\n    override public function draw (g :Graphics)\n    {\n        g.fillRect(color, 0, 0, width._, height._);\n    }\n\n    override public function getNaturalWidth () :Float\n    {\n        return width._;\n    }\n\n    override public function getNaturalHeight () :Float\n    {\n        return height._;\n    }\n\n    /**\n     * Chainable convenience method to set the width and height.\n     * @returns This instance, for chaining.\n     */\n    public function setSize (width :Float, height :Float) :FillSprite\n    {\n        this.width._ = width;\n        this.height._ = height;\n        return this;\n    }\n\n    override public function onUpdate (dt :Float)\n    {\n        super.onUpdate(dt);\n        width.update(dt);\n        height.update(dt);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.display;\n\n/**\n * A fixed-size sprite that displays a single texture.\n */\nclass ImageSprite extends Sprite\n{\n    /**\n     * The texture being displayed, or null if none.\n     */\n    public var texture :Texture;\n\n    public function new (texture :Texture)\n    {\n        super();\n        this.texture = texture;\n    }\n\n    override public function draw (g :Graphics)\n    {\n        if (texture != null) {\n            g.drawTexture(texture, 0, 0);\n        }\n    }\n\n    override public function getNaturalWidth () :Float\n    {\n        return (texture != null) ? texture.width : 0;\n    }\n\n    override public function getNaturalHeight () :Float\n    {\n        return (texture != null) ? texture.height : 0;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\n/**\n * A 3D vector that represents the linear acceleration being applied to the device.\n *\n * <img src=\"https://aduros.com/flambe/images/Axes.png\">\n */\nclass Acceleration\n{\n    /** The acceleration on the X-axis, in m/s^2. */\n    public var x (default, null) :Float;\n\n    /** The acceleration on the Y-axis, in m/s^2. */\n    public var y (default, null) :Float;\n\n    /** The acceleration on the Z-axis, in m/s^2. */\n    public var z (default, null) :Float;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, 0, 0);\n    }\n\n    @:allow(flambe) function init (x :Float, y :Float, z :Float)\n    {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\n/**\n * Three angles that represent the device's attitude, one around each axis.\n *\n * <img src=\"https://aduros.com/flambe/images/Axes.png\">\n */\nclass Attitude\n{\n    /**\n     * The angle in degrees around the X-axis; that is, how far the device is pitched forward or\n     * backward.\n     *\n     * <img src=\"https://aduros.com/flambe/images/Axes-Pitch.png\">\n     */\n    public var pitch (default, null) :Float;\n\n    /**\n     * The angle in degrees around the Y-axis; that is, how far the device is rolled left or right.\n     *\n     * <img src=\"https://aduros.com/flambe/images/Axes-Roll.png\">\n     */\n    public var roll (default, null) :Float;\n\n    /**\n     * The angle in degrees around the Z-axis.\n     *\n     * <img src=\"https://aduros.com/flambe/images/Axes-Azimuth.png\">\n     */\n    public var azimuth (default, null) :Float;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, 0, 0);\n    }\n\n    @:allow(flambe) function init (pitch :Float, roll :Float, azimuth :Float)\n    {\n        this.pitch = pitch;\n        this.roll = roll;\n        this.azimuth = azimuth;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\n/**\n * Represents an event coming from a physical key press.\n *\n * _NOTE_: For performance reasons, KeyboardEvent instances are reused by Flambe. Use `clone()` to\n * retain a reference to an event.\n */\nclass KeyboardEvent\n{\n    /**\n     * The key that caused this event.\n     */\n    public var key (default, null) :Key;\n\n    /**\n     * An incrementing ID unique to every dispatched key event.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, null);\n    }\n\n    /**\n     * Creates a copy of this event.\n     */\n    public function clone () :KeyboardEvent\n    {\n        var event = new KeyboardEvent();\n        event.init(id, key);\n        return event;\n    }\n\n    @:allow(flambe) function init (id :Int, key :Key)\n    {\n        this.id = id;\n        this.key = key;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\n/**\n * Represents an event coming from a mouse.\n *\n * _NOTE_: For performance reasons, MouseEvent instances are reused by Flambe. Use `clone()` to\n * retain a reference to an event.\n */\nclass MouseEvent\n{\n    /**\n     * The X position of the mouse, in view (stage) coordinates.\n     */\n    public var viewX (default, null) :Float;\n\n    /**\n     * The Y position of the mouse, in view (stage) coordinates.\n     */\n    public var viewY (default, null) :Float;\n\n    /**\n     * The mouse button that caused this event, or null for movement events.\n     */\n    public var button (default, null) :MouseButton;\n\n    /**\n     * An incrementing ID unique to every dispatched mouse event.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, 0, 0, null);\n    }\n\n    /**\n     * Creates a copy of this event.\n     */\n    public function clone () :MouseEvent\n    {\n        var event = new MouseEvent();\n        event.init(id, viewX, viewY, button);\n        return event;\n    }\n\n    @:allow(flambe) function init (id :Int, viewX :Float, viewY :Float, button :MouseButton)\n    {\n        this.id = id;\n        this.viewX = viewX;\n        this.viewY = viewY;\n        this.button = button;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\nimport flambe.display.Sprite;\n\nenum EventSource\n{\n    Mouse (event :MouseEvent);\n    Touch (point :TouchPoint);\n}\n\n/**\n * Represents an event coming from a pointing device, such as a mouse or finger.\n *\n * _NOTE_: For performance reasons, PointerEvent instances are reused by Flambe. Use `clone()` to\n * retain a reference to an event.\n */\nclass PointerEvent\n{\n    /**\n     * The X position of the pointing device, in view (stage) coordinates.\n     */\n    public var viewX (default, null) :Float;\n\n    /**\n     * The Y position of the pointing device, in view (stage) coordinates.\n     */\n    public var viewY (default, null) :Float;\n\n    /**\n     * The deepest sprite lying under the pointer that caused the event, if any. The hit sprite does\n     * not necessarily have a pointer event listener connected to it. This event starts at the hit\n     * sprite, and propagates upwards to its parents.\n     */\n    public var hit (default, null) :Sprite;\n\n    /**\n     * The source that this event originated from. This can be used to determine if the event came\n     * from a mouse or a touch.\n     */\n    public var source (default, null) :EventSource;\n\n    /**\n     * An incrementing ID unique to every dispatched pointer event.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new ()\n    {\n        init(0, 0, 0, null, null);\n    }\n\n    /**\n     * Prevents this PointerEvent from propagating up to parent sprites and the top-level Pointer\n     * signal. Other listeners for this event on the current sprite will still fire.\n     */\n    inline public function stopPropagation ()\n    {\n        _stopped = true;\n    }\n\n    /**\n     * Creates a copy of this event.\n     */\n    public function clone () :PointerEvent\n    {\n        // Ensure the source gets deep copied too\n        var sourceCopy = null;\n        switch (source) {\n            case Mouse(event): sourceCopy = Mouse(event.clone());\n            default: sourceCopy = source;\n        }\n\n        var event = new PointerEvent();\n        event.init(id, viewX, viewY, hit, sourceCopy);\n        return event;\n    }\n\n    @:allow(flambe) function init (\n        id :Int, viewX :Float, viewY :Float, hit :Sprite, source :EventSource)\n    {\n        this.id = id;\n        this.viewX = viewX;\n        this.viewY = viewY;\n        this.hit = hit;\n        this.source = source;\n        _stopped = false;\n    }\n\n    @:allow(flambe) var _stopped :Bool;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.input;\n\nimport flambe.input.PointerEvent;\n\n/**\n * Represents a touch screen contact point, such as a finger. It is possible to retain a reference\n * to a TouchPoint, and track changes to it over time.\n */\nclass TouchPoint\n{\n    /**\n     * The X position of the touch, in view (stage) coordinates. This value is modified when the\n     * point moves.\n     */\n    public var viewX (default, null) :Float;\n\n    /**\n     * The Y position of the touch, in view (stage) coordinates. This value is modified when the\n     * point moves.\n     */\n    public var viewY (default, null) :Float;\n\n    /**\n     * An identifier unique to this touch.\n     */\n    public var id (default, null) :Int;\n\n    @:allow(flambe) function new (id :Int)\n    {\n        this.id = id;\n        _source = Touch(this);\n    }\n\n    @:allow(flambe) function init (viewX :Float, viewY :Float)\n    {\n        this.viewX = viewX;\n        this.viewY = viewY;\n    }\n\n    // Cached to avoid lots of allocation\n    @:allow(flambe) var _source :EventSource;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * Some handy math functions, and inlinable constants.\n */\nclass FMath\n{\n    public static inline var E = 2.718281828459045;\n    public static inline var LN2 = 0.6931471805599453;\n    public static inline var LN10 = 2.302585092994046;\n    public static inline var LOG2E = 1.4426950408889634;\n    public static inline var LOG10E = 0.43429448190325176;\n    public static inline var PI = 3.141592653589793;\n    public static inline var SQRT1_2 = 0.7071067811865476;\n    public static inline var SQRT2 = 1.4142135623730951;\n\n    // Haxe doesn't specify the size of an int or float, in practice it's 32 bits\n    /** The lowest integer value in Flash and JS. */\n    public static inline var INT_MIN :Int = -2147483648;\n\n    /** The highest integer value in Flash and JS. */\n    public static inline var INT_MAX :Int = 2147483647;\n\n    /** The lowest float value in Flash and JS. */\n    public static inline var FLOAT_MIN = -1.79769313486231e+308;\n\n    /** The highest float value in Flash and JS. */\n    public static inline var FLOAT_MAX = 1.79769313486231e+308;\n\n    /** Converts an angle in degrees to radians. */\n    inline public static function toRadians (degrees :Float) :Float\n    {\n        return degrees * PI/180;\n    }\n\n    /** Converts an angle in radians to degrees. */\n    inline public static function toDegrees (radians :Float) :Float\n    {\n        return radians * 180/PI;\n    }\n\n    #if !js @:generic #end\n    inline public static function max<T:Float> (a :T, b :T) :T\n    {\n        return (a > b) ? a : b;\n    }\n\n    #if !js @:generic #end\n    inline public static function min<T:Float> (a :T, b :T) :T\n    {\n        return (a < b) ? a : b;\n    }\n\n    #if !js @:generic #end\n    public static function clamp<T:Float> (value :T, min :T, max :T) :T\n    {\n        return if (value < min) min\n            else if (value > max) max\n            else value;\n    }\n\n    public static function sign (value :Float) :Int\n    {\n        return if (value < 0) -1\n            else if (value > 0) 1\n            else 0;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * A 2D transform matrix.\n *\n * ```\n * [ m00 m01 m02 ]\n * [ m10 m11 m12 ]\n * [  0   0   1  ]\n * ```\n */\nclass Matrix\n{\n    public var m00 :Float;\n    public var m10 :Float;\n    public var m01 :Float;\n    public var m11 :Float;\n    public var m02 :Float;\n    public var m12 :Float;\n\n    public function new ()\n    {\n        identity();\n    }\n\n    public function set (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        this.m00 = m00; this.m01 = m01; this.m02 = m02;\n        this.m10 = m10; this.m11 = m11; this.m12 = m12;\n    }\n\n    /**\n     * Sets this matrix to the identity matrix.\n     */\n    public function identity ()\n    {\n        set(1, 0, 0, 1, 0, 0);\n    }\n\n    /**\n     * Set this matrix to a translation, scale, and rotation, in that order.\n     */\n    public function compose (x :Float, y :Float, scaleX :Float, scaleY :Float, rotation :Float)\n    {\n        var sin = Math.sin(rotation);\n        var cos = Math.cos(rotation);\n        set(cos*scaleX, sin*scaleX, -sin*scaleY, cos*scaleY, x, y);\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        m02 += m00*x + m01*y;\n        m12 += m11*y + m10*x;\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        m00 *= x;\n        m10 *= x;\n        m01 *= y;\n        m11 *= y;\n    }\n\n    public function rotate (rotation :Float)\n    {\n        var sin = Math.sin(rotation);\n        var cos = Math.cos(rotation);\n\n        var t00 = m00*cos + m01*sin;\n        var t01 = -m00*sin + m01*cos;\n        m00 = t00;\n        m01 = t01;\n\n        var t10 = m11*sin + m10*cos;\n        var t11 = m11*cos - m10*sin;\n        m10 = t10;\n        m11 = t11;\n    }\n\n    /** @return Whether the matrix was inverted. */\n    public function invert () :Bool\n    {\n        var det = determinant();\n        if (det == 0) {\n            return false;\n        }\n        set(m11/det, -m01/det, -m10/det, m00/det,\n            (m01*m12 - m11*m02) / det,\n            (m10*m02 - m00*m12) / det);\n        return true;\n    }\n\n    public function transform (x :Float, y :Float, ?result :Point) :Point\n    {\n        if (result == null) {\n            result = new Point();\n        }\n        result.x = x*m00 + y*m01 + m02;\n        result.y = x*m10 + y*m11 + m12;\n        return result;\n    }\n\n    public function transformArray (points :ArrayAccess<Float>, length :Int,\n        result :ArrayAccess<Float>)\n    {\n        var ii = 0;\n        while (ii < length) {\n            var x = points[ii], y = points[ii+1];\n            result[ii++] = x*m00 + y*m01 + m02;\n            result[ii++] = x*m10 + y*m11 + m12;\n        }\n    }\n\n    /**\n     * Calculate the determinant of this matrix.\n     */\n    public function determinant () :Float\n    {\n        return m00*m11 - m01*m10;\n    }\n\n    /**\n     * Transforms a point by the inverse of this matrix, or return false if this matrix is not\n     * invertible.\n     */\n    public function inverseTransform (x :Float, y :Float, result :Point) :Bool\n    {\n        var det = determinant();\n        if (det == 0) {\n            return false;\n        }\n        x -= m02;\n        y -= m12;\n        result.x = (x*m11 - y*m01) / det;\n        result.y = (y*m00 - x*m10) / det;\n        return true;\n    }\n\n    /**\n     * Multiply two matrices and return the result.\n     */\n    public static function multiply (lhs :Matrix, rhs :Matrix, ?result :Matrix) :Matrix\n    {\n        if (result == null) {\n            result = new Matrix();\n        }\n\n        // First row\n        var a = lhs.m00*rhs.m00 + lhs.m01*rhs.m10;\n        var b = lhs.m00*rhs.m01 + lhs.m01*rhs.m11;\n        var c = lhs.m00*rhs.m02 + lhs.m01*rhs.m12 + lhs.m02;\n        result.m00 = a;\n        result.m01 = b;\n        result.m02 = c;\n\n        // Second row\n        a = lhs.m10*rhs.m00 + lhs.m11*rhs.m10;\n        b = lhs.m10*rhs.m01 + lhs.m11*rhs.m11;\n        c = lhs.m10*rhs.m02 + lhs.m11*rhs.m12 + lhs.m12;\n        result.m10 = a;\n        result.m11 = b;\n        result.m12 = c;\n\n        return result;\n    }\n\n    /**\n     * Creates a copy of this matrix.\n     */\n    public function clone (?result :Matrix) :Matrix\n    {\n        if (result == null) {\n            result = new Matrix();\n        }\n        result.set(m00, m10, m01, m11, m02, m12);\n        return result;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return m00 + \" \" + m01 + \" \" + m02 + \" \\\\ \" +\n            m10 + \" \" + m11 + \" \" + m12;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.math;\n\n/**\n * A 2D rectangle.\n */\nclass Rectangle\n{\n    public var x :Float;\n    public var y :Float;\n    public var width :Float;\n    public var height :Float;\n\n    /** The X-coordinate of the left side of the rectangle. */\n    public var left (get, null) :Float;\n\n    /** The X-coordinate of the right side of the rectangle. */\n    public var right (get, null) :Float;\n\n    /** The Y-coordinate of the top side of the rectangle. */\n    public var top (get, null) :Float;\n\n    /** The Y-coordinate of the bottom side of the rectangle. */\n    public var bottom (get, null) :Float;\n\n    /** The X-coordinate of the center of the rectangle. */\n    public var centerX (get, null) :Float;\n\n    /** The Y-coordinate of the center of the rectangle. */\n    public var centerY (get, null) :Float;\n\n    public function new (x :Float = 0, y :Float = 0, width :Float = 0, height :Float = 0)\n    {\n        set(x, y, width, height);\n    }\n\n    public function set (x :Float, y :Float, width :Float, height :Float)\n    {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n\n    /**\n     * Returns true if this rectangle contains the given point.\n     */\n    public function contains (x :Float, y :Float) :Bool\n    {\n        // A little more complicated than usual due to proper handling of negative widths/heights\n\n        x -= this.x;\n        if (width >= 0) {\n            if (x < 0 || x > width) {\n                return false;\n            }\n        } else if (x > 0 || x < width) {\n            return false;\n        }\n\n        y -= this.y;\n        if (height >= 0) {\n            if (y < 0 || y > height) {\n                return false;\n            }\n        } else if (y > 0 || y < height) {\n            return false;\n        }\n\n        return true;\n    }\n\n    /**\n     * Returns whether this rectangle intersects another rectangle.\n     *\n     * @param rect The other rectangle to check for intersection.\n     * @param result If supplied and the rectangles intersect, will be set to the calculated\n     *   intersection rectangle.\n     */\n    public function intersects (rect :Rectangle, ?result: Rectangle) :Bool\n    {\n        var left = FMath.max(this.left, rect.left);\n        var right = FMath.min(this.right, rect.right);\n        if (left > right) {\n            return false;\n        }\n\n        var top = FMath.max(this.top, rect.top);\n        var bottom = FMath.min(this.bottom, rect.bottom);\n        if (top > bottom) {\n            return false;\n        }\n\n        if (result != null) {\n            result.set(left, top, right-left, bottom-top);\n        }\n        return true;\n    }\n\n    /**\n     * Creates a copy of this rectangle.\n     */\n    public function clone (?result :Rectangle) :Rectangle\n    {\n        if (result == null) {\n            result = new Rectangle();\n        }\n        result.set(x, y, width, height);\n        return result;\n    }\n\n    public function equals (other :Rectangle) :Bool\n    {\n        return x == other.x && y == other.y && width == other.width && height == other.height;\n    }\n\n    #if debug @:keep #end public function toString () :String\n    {\n        return \"(\" + x + \",\" + y + \" \" + width + \"x\" + height + \")\";\n    }\n\n    inline private function get_left () :Float\n    {\n        return x;\n    }\n\n    inline private function get_top () :Float\n    {\n        return y;\n    }\n\n    private function get_right () :Float\n    {\n        return x + width;\n    }\n\n    private function get_bottom () :Float\n    {\n        return y + height;\n    }\n\n    private function get_centerX () :Float\n    {\n        return x + width/2;\n    }\n\n    private function get_centerY () :Float\n    {\n        return y + height/2;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.asset.Asset;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\nclass BasicAsset<A/*:BasicAsset<A>*/>\n    implements Asset\n{\n    public var reloadCount (get, null) :Value<Int>;\n\n    public function new ()\n    {\n    }\n\n    inline public function assertNotDisposed ()\n    {\n        Assert.that(!_disposed, \"Asset cannot be used after being disposed\");\n    }\n\n    @:final public function reload (asset :A)\n    {\n        dispose();\n        _disposed = false;\n        copyFrom(asset);\n        ++reloadCount._;\n    }\n\n    @:final public function dispose ()\n    {\n        if (!_disposed) {\n            _disposed = true;\n            onDisposed();\n        }\n    }\n\n    /** Fully copy the content from another asset type, for reloading. */\n    private function copyFrom (asset :A)\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    /** Handle disposing. */\n    private function onDisposed ()\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    // Overridden in subclasses!\n    private function get_reloadCount () :Value<Int>\n    {\n        if (_reloadCount == null) {\n            _reloadCount = new Value<Int>(0);\n        }\n        return _reloadCount;\n    }\n\n    private var _disposed :Bool = false;\n    private var _reloadCount :Value<Int> = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.asset.AssetEntry;\nimport flambe.asset.AssetPack;\nimport flambe.asset.File;\nimport flambe.asset.Manifest;\nimport flambe.display.Texture;\nimport flambe.sound.Sound;\nimport flambe.util.Assert;\nimport flambe.util.Promise;\n\nusing Lambda;\nusing flambe.util.Arrays;\nusing flambe.util.Strings;\n\nclass BasicAssetPackLoader\n{\n    public var promise (default, null) :Promise<AssetPack>;\n    public var manifest (default, null) :Manifest;\n\n    public function new (platform :Platform, manifest :Manifest)\n    {\n        this.manifest = manifest;\n        _platform = platform;\n        promise = new Promise();\n        _bytesLoaded = new Map();\n        _pack = new BasicAssetPack(manifest, this);\n\n        var entries = manifest.array();\n        if (entries.length == 0) {\n            // There's nothing to load, just send them an empty pack\n            handleSuccess();\n\n        } else {\n            var groups = new Map<String,Array<AssetEntry>>();\n\n            // Group assets by name\n            for (entry in entries) {\n                var group = groups.get(entry.name);\n                if (group == null) {\n                    group = [];\n                    groups.set(entry.name, group);\n                }\n                group.push(entry);\n            }\n\n            // Load the most suitable asset from each group\n            _assetsRemaining = groups.count();\n            for (group in groups) {\n                pickBestEntry(group, function (bestEntry :AssetEntry) {\n                    if (bestEntry != null) {\n                        var url = manifest.getFullURL(bestEntry);\n                        try {\n                            loadEntry(url, bestEntry);\n                        } catch (error :Dynamic) {\n                            handleError(bestEntry, \"Unexpected error: \" + error);\n                        }\n                        promise.total += bestEntry.bytes;\n\n                    } else {\n                        var badEntry = group[0];\n                        if (isAudio(badEntry.format)) {\n                            // Deal with missing audio files and bad browser support\n                            Log.warn(\"Could not find a supported audio format to load\", [\"name\", badEntry.name]);\n                            handleLoad(badEntry, DummySound.getInstance());\n                        } else {\n                            handleError(badEntry, \"Could not find a supported format to load\");\n                        }\n                    }\n                });\n            }\n        }\n\n#if debug\n        var catapult = _platform.getCatapultClient();\n        if (catapult != null) {\n            catapult.add(this);\n        }\n#end\n    }\n\n    /** Reload any asset that matches this URL (ignoring the ?v= query param). */\n    public function reload (url :String)\n    {\n        // Find the AssetEntry that matches this url\n        var baseUrl = removeUrlParams(url);\n        var foundEntry = null;\n        for (entry in manifest) {\n            if (baseUrl == removeUrlParams(entry.url)) {\n                foundEntry = entry;\n                break;\n            }\n        }\n\n        // If the entry was found in this manifest, and is a supported format\n        if (foundEntry != null) {\n            getAssetFormats(function (formats :Array<AssetFormat>) {\n                if (formats.indexOf(foundEntry.format) >= 0) {\n                    // Dummy up a new AssetEntry based on the previous one, and reload it\n                    var entry = new AssetEntry(foundEntry.name, url, foundEntry.format, 0);\n                    loadEntry(manifest.getFullURL(entry), entry);\n                }\n            });\n        }\n    }\n\n    /** Called when this loader's AssetPack is disposed. */\n    public function onDisposed ()\n    {\n#if debug\n        var catapult = _platform.getCatapultClient();\n        if (catapult != null) {\n            catapult.remove(this);\n        }\n#end\n    }\n\n    private static function removeUrlParams (url :String) :String\n    {\n        var query = url.indexOf(\"?\");\n        return (query > 0) ? url.substr(0, query) : url;\n    }\n\n    /**\n     * Out of a list of asset entries with the same name, select the one best supported by this\n     * environment, or null if none of them are supported.\n     */\n    private function pickBestEntry (entries :Array<AssetEntry>, fn :AssetEntry -> Void)\n    {\n        var onFormatsAvailable = function (formats :Array<AssetFormat>) {\n            for (format in formats) {\n                for (entry in entries) {\n                    if (entry.format == format) {\n                        fn(entry);\n                        return;\n                    }\n                }\n            }\n            fn(null); // This asset is not supported, we're boned\n        };\n\n        getAssetFormats(onFormatsAvailable);\n    }\n\n    private function loadEntry (url :String, entry :AssetEntry)\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    /** Gets the list of asset formats the environment supports, ordered by preference. */\n    private function getAssetFormats (fn :Array<AssetFormat> -> Void)\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    private function handleLoad<A/*:BasicAsset<A>*/> (entry :AssetEntry, asset :A)\n    {\n        if (_pack.disposed) {\n            return; // Pack was disposed earlier, forget about it\n        }\n\n        // Ensure this asset has been fully progressed\n        handleProgress(entry, entry.bytes);\n\n        var map :Map<String,Dynamic>;\n        switch (entry.format) {\n        case WEBP, JXR, PNG, JPG, GIF, DDS, PVR, PKM:\n            map = _pack.textures;\n        case MP3, M4A, OPUS, OGG, WAV:\n            map = _pack.sounds;\n        case Data:\n            map = _pack.files;\n        }\n\n#if debug // Allow some methods to get stripped in release builds, which don't allow reloading\n        var oldAsset :BasicAsset<A> = cast map.get(entry.name);\n        if (oldAsset != null) {\n            Log.info(\"Reloaded asset\", [\"url\", entry.url]);\n            oldAsset.reload(asset);\n\n        } else {\n#end\n            map.set(entry.name, asset);\n            _assetsRemaining -= 1;\n            if (_assetsRemaining == 0) {\n                handleSuccess();\n            }\n#if debug\n        }\n#end\n    }\n\n    private function handleProgress (entry :AssetEntry, bytesLoaded :Int)\n    {\n        _bytesLoaded.set(entry.name, bytesLoaded);\n\n        var bytesTotal = 0;\n        for (bytes in _bytesLoaded) {\n            bytesTotal += bytes;\n        }\n        promise.progress = bytesTotal;\n    }\n\n    private function handleSuccess ()\n    {\n        promise.result = _pack;\n    }\n\n    private function handleError (entry :AssetEntry, message :String)\n    {\n        Log.warn(\"Error loading asset pack\", [\"error\", message, \"url\", entry.url]);\n        promise.error.emit(message.withFields([\"url\", entry.url]));\n    }\n\n    private function handleTextureError (entry :AssetEntry)\n    {\n        handleError(entry, \"Failed to create texture. Is the GPU context unavailable?\");\n    }\n\n    private static function isAudio (format :AssetFormat) :Bool\n    {\n        switch (format) {\n            case MP3, M4A, OPUS, OGG, WAV: return true;\n            default: return false;\n        }\n    }\n\n    private var _platform :Platform;\n\n    // How many assets are still loading\n    private var _assetsRemaining :Int;\n\n    // How many bytes of each asset have been loaded\n    private var _bytesLoaded :Map<String,Int>;\n\n    private var _pack :BasicAssetPack;\n}\n\n// A simple AssetPack backed by a Map\nprivate class BasicAssetPack\n    implements AssetPack\n{\n    public var manifest (get, null) :Manifest;\n    public var loader (default, null) :BasicAssetPackLoader;\n\n    public var textures :Map<String,Texture>;\n    public var sounds :Map<String,Sound>;\n    public var files :Map<String,File>;\n\n    public var disposed :Bool = false;\n\n    public function new (manifest :Manifest, loader :BasicAssetPackLoader)\n    {\n        _manifest = manifest;\n        this.loader = loader;\n\n        textures = new Map();\n        sounds = new Map();\n        files = new Map();\n    }\n\n    public function getTexture (name :String, required :Bool = true) :Texture\n    {\n        assertNotDisposed();\n#if debug\n        warnOnExtension(name);\n#end\n        var texture = textures.get(name);\n        if (texture == null && required) {\n            throw \"Missing texture\".withFields([\"name\", name]);\n        }\n        return texture;\n    }\n\n    public function getSound (name :String, required :Bool = true) :Sound\n    {\n        assertNotDisposed();\n#if debug\n        warnOnExtension(name);\n#end\n        var sound = sounds.get(name);\n        if (sound == null && required) {\n            throw \"Missing sound\".withFields([\"name\", name]);\n        }\n        return sound;\n    }\n\n    public function getFile (name :String, required :Bool = true) :File\n    {\n        assertNotDisposed();\n\n        var file = files.get(name);\n        if (file == null && required) {\n            throw \"Missing file\".withFields([\"name\", name]);\n        }\n        return file;\n    }\n\n    // Dispose all assets contained in this pack\n    public function dispose ()\n    {\n        if (!disposed) {\n            disposed = true;\n\n            for (texture in textures) {\n                texture.dispose();\n            }\n            textures = null;\n\n            for (sound in sounds) {\n                sound.dispose();\n            }\n            sounds = null;\n\n            for (file in files) {\n                file.dispose();\n            }\n            files = null;\n\n            loader.onDisposed();\n        }\n    }\n\n    inline private function get_manifest () :Manifest\n    {\n        return _manifest;\n    }\n\n    inline private function assertNotDisposed ()\n    {\n        Assert.that(!disposed, \"AssetPack cannot be used after being disposed\");\n    }\n\n    private static function warnOnExtension (path :String)\n    {\n        var ext = path.getFileExtension();\n        if (ext != null && ext.length == 3) {\n            Log.warn(\"Requested asset \\\"\" + path + \"\\\" should not have a file extension,\" +\n                \" did you mean \\\"\" + path.removeFileExtension() + \"\\\"?\");\n        }\n    }\n\n    private var _manifest :Manifest;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.asset.File;\n\nclass BasicFile extends BasicAsset<BasicFile>\n    implements File\n{\n    public function new (content :String)\n    {\n        super();\n        _content = content;\n    }\n\n    public function toString ()\n    {\n        assertNotDisposed();\n\n        return _content;\n    }\n\n    override private function copyFrom (that :BasicFile)\n    {\n        this._content = that._content;\n    }\n\n    override private function onDisposed ()\n    {\n        _content = null;\n    }\n\n    private var _content :String;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.Key;\nimport flambe.input.KeyboardEvent;\nimport flambe.subsystem.KeyboardSystem;\nimport flambe.util.Signal0;\nimport flambe.util.Signal1;\n\nusing flambe.platform.KeyCodes;\n\nclass BasicKeyboard\n    implements KeyboardSystem\n{\n    public var supported (get, null) :Bool;\n\n    public var down (default, null) :Signal1<KeyboardEvent>;\n    public var up (default, null) :Signal1<KeyboardEvent>;\n    public var backButton (default, null) :Signal0;\n\n    public function new ()\n    {\n        down = new Signal1();\n        up = new Signal1();\n        backButton = new Signal0();\n        _keyStates = new Map();\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function isDown (key :Key) :Bool\n    {\n        return isCodeDown(key.toKeyCode());\n    }\n\n    inline private function isCodeDown (keyCode :Int) :Bool\n    {\n        return _keyStates.exists(keyCode);\n    }\n\n    /**\n     * Called by the platform to handle a down event.\n     * @return Whether default action should be prevented.\n     */\n    public function submitDown (keyCode :Int) :Bool\n    {\n        if (keyCode == KeyCodes.BACK) {\n            if (backButton.hasListeners()) {\n                backButton.emit();\n                return true;\n            }\n            return false; // No preventDefault\n        }\n\n        if (!isCodeDown(keyCode)) {\n            _keyStates.set(keyCode, true);\n            _sharedEvent.init(_sharedEvent.id+1, keyCode.toKey());\n            down.emit(_sharedEvent);\n        }\n        return true;\n    }\n\n    /**\n     * Called by the platform to handle an up event.\n     */\n    public function submitUp (keyCode :Int)\n    {\n        if (isCodeDown(keyCode)) {\n            _keyStates.remove(keyCode);\n            _sharedEvent.init(_sharedEvent.id+1, keyCode.toKey());\n            up.emit(_sharedEvent);\n        }\n    }\n\n    private static var _sharedEvent = new KeyboardEvent();\n\n    private var _keyStates :Map<Int,Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.MouseButton;\nimport flambe.input.MouseCursor;\nimport flambe.input.MouseEvent;\nimport flambe.input.PointerEvent;\nimport flambe.subsystem.MouseSystem;\nimport flambe.util.Signal1;\n\nusing flambe.platform.MouseCodes;\n\nclass BasicMouse\n    implements MouseSystem\n{\n    public var supported (get, null) :Bool;\n\n    public var down (default, null) :Signal1<MouseEvent>;\n    public var move (default, null) :Signal1<MouseEvent>;\n    public var up (default, null) :Signal1<MouseEvent>;\n    public var scroll (default, null) :Signal1<Float>;\n\n    public var x (get, null) :Float;\n    public var y (get, null) :Float;\n    public var cursor (get, set) :MouseCursor;\n\n    public function new (pointer :BasicPointer)\n    {\n        _pointer = pointer;\n        _source = Mouse(_sharedEvent);\n\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n        scroll = new Signal1();\n        _x = 0;\n        _y = 0;\n        _cursor = Default;\n        _buttonStates = new Map();\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function get_x () :Float\n    {\n        return _x;\n    }\n\n    public function get_y () :Float\n    {\n        return _y;\n    }\n\n    public function get_cursor () :MouseCursor\n    {\n        return _cursor;\n    }\n\n    public function set_cursor (cursor :MouseCursor) :MouseCursor\n    {\n        // See subclasses for implementation\n        return _cursor = cursor;\n    }\n\n    public function isDown (button :MouseButton) :Bool\n    {\n        return isCodeDown(button.toButtonCode());\n    }\n\n    public function submitDown (viewX :Float, viewY :Float, buttonCode :Int)\n    {\n        if (!isCodeDown(buttonCode)) {\n            _buttonStates.set(buttonCode, true);\n\n            // Init the MouseEvent, and let the Pointer system handle it before emitting our signal\n            prepare(viewX, viewY, buttonCode.toButton());\n            _pointer.submitDown(viewX, viewY, _source);\n            down.emit(_sharedEvent);\n        }\n    }\n\n    public function submitMove (viewX :Float, viewY :Float)\n    {\n        prepare(viewX, viewY, null);\n        _pointer.submitMove(viewX, viewY, _source);\n        move.emit(_sharedEvent);\n    }\n\n    public function submitUp (viewX :Float, viewY :Float, buttonCode :Int)\n    {\n        if (isCodeDown(buttonCode)) {\n            _buttonStates.remove(buttonCode);\n\n            prepare(viewX, viewY, buttonCode.toButton());\n            _pointer.submitUp(viewX, viewY, _source);\n            up.emit(_sharedEvent);\n        }\n    }\n\n    // Returns true if the scroll signal was handled\n    public function submitScroll (viewX :Float, viewY :Float, velocity :Float) :Bool\n    {\n        _x = viewX;\n        _y = viewY;\n        if (!scroll.hasListeners()) {\n            return false;\n        }\n        scroll.emit(velocity);\n        return true;\n    }\n\n    inline private function isCodeDown (buttonCode :Int) :Bool\n    {\n        return _buttonStates.exists(buttonCode);\n    }\n\n    private function prepare (viewX :Float, viewY :Float, button :MouseButton)\n    {\n        _x = viewX;\n        _y = viewY;\n        _sharedEvent.init(_sharedEvent.id+1, viewX, viewY, button);\n    }\n\n    private static var _sharedEvent = new MouseEvent();\n\n    private var _pointer :BasicPointer;\n    private var _source :EventSource;\n\n    private var _x :Float;\n    private var _y :Float;\n    private var _cursor :MouseCursor;\n    private var _buttonStates :Map<Int,Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.display.Sprite;\nimport flambe.input.PointerEvent;\nimport flambe.math.Point;\nimport flambe.scene.Director;\nimport flambe.subsystem.PointerSystem;\nimport flambe.util.Signal1;\n\nusing Lambda;\n\nclass BasicPointer\n    implements PointerSystem\n{\n    public var supported (get, null) :Bool;\n\n    public var down (default, null) :Signal1<PointerEvent>;\n    public var move (default, null) :Signal1<PointerEvent>;\n    public var up (default, null) :Signal1<PointerEvent>;\n\n    public var x (get, null) :Float;\n    public var y (get, null) :Float;\n\n    public function new (x :Float = 0, y :Float = 0, isDown :Bool = false)\n    {\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n        _x = x;\n        _y = y;\n        _isDown = isDown;\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function get_x () :Float\n    {\n        return _x;\n    }\n\n    public function get_y () :Float\n    {\n        return _y;\n    }\n\n    public function isDown () :Bool\n    {\n        return _isDown;\n    }\n\n    /**\n     * Called by the platform to handle a down event.\n     */\n    public function submitDown (viewX :Float, viewY :Float, source :EventSource)\n    {\n        if (_isDown) {\n            return; // Ignore repeat down events\n        }\n        // Ensure a move event is sent first\n        submitMove(viewX, viewY, source);\n        _isDown = true;\n\n        // Take a snapshot of the entire event bubbling chain\n        var chain = [];\n        var hit = Sprite.hitTest(System.root, viewX, viewY);\n        if (hit != null) {\n            var entity = hit.owner;\n            do {\n                var sprite = entity.get(Sprite);\n                if (sprite != null) {\n                    chain.push(sprite);\n                }\n                entity = entity.parent;\n            } while (entity != null);\n        }\n\n        // Finally, emit the event up the chain\n        prepare(viewX, viewY, hit, source);\n        for (sprite in chain) {\n            sprite.onPointerDown(_sharedEvent);\n            if (_sharedEvent._stopped) {\n                return;\n            }\n        }\n        down.emit(_sharedEvent);\n    }\n\n    /**\n     * Called by the platform to handle a move event.\n     */\n    public function submitMove (viewX :Float, viewY :Float, source :EventSource)\n    {\n        if (viewX == _x && viewY == _y) {\n            return; // Ignore repeated duplicate move events\n        }\n\n        // Take a snapshot of the entire event bubbling chain\n        var chain = [];\n        var hit = Sprite.hitTest(System.root, viewX, viewY);\n        if (hit != null) {\n            var entity = hit.owner;\n            do {\n                var sprite = entity.get(Sprite);\n                if (sprite != null) {\n                    chain.push(sprite);\n                }\n                entity = entity.parent;\n            } while (entity != null);\n        }\n\n        // Finally, emit the event up the chain\n        prepare(viewX, viewY, hit, source);\n        for (sprite in chain) {\n            sprite.onPointerMove(_sharedEvent);\n            if (_sharedEvent._stopped) {\n                return;\n            }\n        }\n        move.emit(_sharedEvent);\n    }\n\n    /**\n     * Called by the platform to handle an up event.\n     */\n    public function submitUp (viewX :Float, viewY :Float, source :EventSource)\n    {\n        if (!_isDown) {\n            return; // Ignore repeat up events\n        }\n        // Ensure a move event is sent first\n        submitMove(viewX, viewY, source);\n        _isDown = false;\n\n        // Take a snapshot of the entire event bubbling chain\n        var chain = [];\n        var hit = Sprite.hitTest(System.root, viewX, viewY);\n        if (hit != null) {\n            var entity = hit.owner;\n            do {\n                var sprite = entity.get(Sprite);\n                if (sprite != null) {\n                    chain.push(sprite);\n                }\n                entity = entity.parent;\n            } while (entity != null);\n        }\n\n        // Finally, emit the event up the chain\n        prepare(viewX, viewY, hit, source);\n        for (sprite in chain) {\n            sprite.onPointerUp(_sharedEvent);\n            if (_sharedEvent._stopped) {\n                return;\n            }\n        }\n        up.emit(_sharedEvent);\n    }\n\n    private function prepare (viewX :Float, viewY :Float, hit :Sprite, source :EventSource)\n    {\n        _x = viewX;\n        _y = viewY;\n        _sharedEvent.init(_sharedEvent.id+1, viewX, viewY, hit, source);\n    }\n\n    private static var _sharedEvent = new PointerEvent();\n    private static var _scratchPoint = new Point();\n\n    private var _x :Float;\n    private var _y :Float;\n    private var _isDown :Bool;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport haxe.io.Bytes;\n\nimport flambe.display.Graphics;\nimport flambe.display.SubTexture;\nimport flambe.display.Texture;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\n#if !js\n@:generic // for performance reasons\n#end\nclass BasicTexture<R:(TextureRoot & BasicAsset<R>)> extends BasicAsset<BasicTexture<R>>\n    implements SubTexture\n{\n    public var graphics (get, null) :Graphics;\n\n    public var parent (get, null) :Texture;\n\n    // The texture bounds\n    public var x (get, null) :Int;\n    public var y (get, null) :Int;\n    public var width (get, null) :Int;\n    public var height (get, null) :Int;\n\n    public var root (default, null) :R;\n\n    // The global position of this texture from the root\n    public var rootX (default, null) :Int = 0;\n    public var rootY (default, null) :Int = 0;\n\n    private function new (root :R, width :Int, height :Int)\n    {\n        super();\n        this.root = root;\n        _width = width;\n        _height = height;\n    }\n\n    public function readPixels (x :Int, y :Int, width :Int, height :Int) :Bytes\n    {\n        return root.readPixels(rootX+x, rootY+y, width, height);\n    }\n\n    public function writePixels (pixels :Bytes, x :Int, y :Int, sourceW :Int, sourceH :Int)\n    {\n        root.writePixels(pixels, rootX+x, rootY+y, sourceW, sourceH);\n    }\n\n    public function subTexture (x :Int, y :Int, width :Int, height :Int) :SubTexture\n    {\n        var sub :BasicTexture<R> = cast root.createTexture(width, height);\n        sub._parent = this;\n        sub._x = x;\n        sub._y = y;\n        sub.rootX = rootX + x;\n        sub.rootY = rootY + y;\n        return sub;\n    }\n\n    public function split (tilesWide :Int, tilesHigh :Int = 1) :Array<SubTexture>\n    {\n        var tiles = [];\n        var tileWidth = Std.int(_width / tilesWide);\n        var tileHeight = Std.int(_height / tilesHigh);\n        for (y in 0...tilesHigh) {\n            for (x in 0...tilesWide) {\n                tiles.push(subTexture(x*tileWidth, y*tileHeight, tileWidth, tileHeight));\n            }\n        }\n        return tiles;\n    }\n\n    // FIXME(bruno): Different textures that share the same root also share the same Graphics. This\n    // is an unfortunate limitation imposed by Canvas2D only allowing one context per canvas. We'll\n    // need to document this caveat somewhere, or change this API to workaround.\n    private function get_graphics () :Graphics\n    {\n        return root.getGraphics();\n    }\n\n    override private function copyFrom (that :BasicTexture<R>)\n    {\n        this.root._disposed = false;\n        this.root.copyFrom(that.root);\n\n        this._width = that._width;\n        this._height = that._height;\n\n        // We don't support mutability on the position, since it invalidates the rootX/Y of child\n        // subTextures. This assert should never fail with the asset reloader.\n        Assert.that(\n            this.rootX == that.rootX &&\n            this.rootY == that.rootY &&\n            this._x == that._x &&\n            this._y == that._y);\n    }\n\n    override private function onDisposed ()\n    {\n        // Since subtextures shouldn't be able to accidently dispose their parents and siblings,\n        // only dispose the root if this is the top-most subtexture.\n        if (_parent == null) {\n            root.dispose();\n        }\n    }\n\n    override private function get_reloadCount () :Value<Int>\n    {\n        // Delegate to the root, so that root reloads get propogated to all subtextures\n        return root.reloadCount;\n    }\n\n    inline private function get_parent () :Texture\n    {\n        return _parent;\n    }\n\n    inline private function get_x () :Int\n    {\n        return _x;\n    }\n\n    inline private function get_y () :Int\n    {\n        return _y;\n    }\n\n    inline private function get_width () :Int\n    {\n        return _width;\n    }\n\n    inline private function get_height () :Int\n    {\n        return _height;\n    }\n\n    private var _parent :BasicTexture<R> = null;\n\n    private var _x :Int = 0;\n    private var _y :Int = 0;\n    private var _width :Int;\n    private var _height :Int;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.TouchPoint;\nimport flambe.subsystem.TouchSystem;\nimport flambe.util.Signal1;\n\nclass BasicTouch\n    implements TouchSystem\n{\n    public var supported (get, null) :Bool;\n    public var maxPoints (get, null) :Int;\n    public var points (get, null) :Array<TouchPoint>;\n\n    public var down (default, null) :Signal1<TouchPoint>;\n    public var move (default, null) :Signal1<TouchPoint>;\n    public var up (default, null) :Signal1<TouchPoint>;\n\n    public function new (pointer :BasicPointer, maxPoints :Int = 4)\n    {\n        _pointer = pointer;\n        _maxPoints = maxPoints;\n        _pointMap = new Map();\n        _points = [];\n\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function get_maxPoints () :Int\n    {\n        return _maxPoints;\n    }\n\n    public function get_points () :Array<TouchPoint>\n    {\n        return _points.copy();\n    }\n\n    public function submitDown (id :Int, viewX :Float, viewY :Float)\n    {\n        if (!_pointMap.exists(id)) {\n            var point = new TouchPoint(id);\n            point.init(viewX, viewY);\n            _pointMap.set(id, point);\n            _points.push(point);\n\n            if (_pointerTouch == null) {\n                // Make this touch point the tracked pointer\n                _pointerTouch = point;\n                _pointer.submitDown(viewX, viewY, point._source);\n            }\n            down.emit(point);\n        }\n    }\n\n    public function submitMove (id :Int, viewX :Float, viewY :Float)\n    {\n        var point = _pointMap.get(id);\n        if (point != null) {\n            point.init(viewX, viewY);\n\n            if (_pointerTouch == point) {\n                _pointer.submitMove(viewX, viewY, point._source);\n            }\n            move.emit(point);\n        }\n    }\n\n    public function submitUp (id :Int, viewX :Float, viewY :Float)\n    {\n        var point = _pointMap.get(id);\n        if (point != null) {\n            point.init(viewX, viewY);\n            _pointMap.remove(id);\n            _points.remove(point);\n\n            if (_pointerTouch == point) {\n                _pointerTouch = null;\n                _pointer.submitUp(viewX, viewY, point._source);\n            }\n            up.emit(point);\n        }\n    }\n\n    private var _pointer :BasicPointer;\n    private var _pointerTouch :TouchPoint;\n\n    private var _maxPoints :Int;\n    private var _pointMap :Map<Int,TouchPoint>;\n    private var _points :Array<TouchPoint>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport haxe.Json;\n\nimport flambe.util.Assert;\n\nusing StringTools;\n\n/** Handles communication with the Catapult server run by `flambe serve`, for live reloading. */\nclass CatapultClient\n{\n    private function new ()\n    {\n        _loaders = [];\n    }\n\n    public function add (loader :BasicAssetPackLoader)\n    {\n#if !flambe_disable_reloading\n        // Only care about packs loaded from the assets directory\n        if (loader.manifest.localBase == \"assets\") {\n            _loaders.push(loader);\n        }\n#end\n    }\n\n    public function remove (loader :BasicAssetPackLoader)\n    {\n        _loaders.remove(loader);\n    }\n\n    private function onError (cause :String)\n    {\n        Log.warn(\"Unable to connect to Catapult\", [\"cause\", cause]);\n    }\n\n    private function onMessage (message :String)\n    {\n        var message = Json.parse(message);\n        switch (message.type) {\n        case \"file_changed\":\n            var url = message.name + \"?v=\" + message.md5;\n            url = url.replace(\"\\\\\", \"/\"); // Handle backslash paths in Windows\n            for (loader in _loaders) {\n                loader.reload(url);\n            }\n        case \"restart\":\n            onRestart();\n        }\n    }\n\n    private function onRestart ()\n    {\n        Assert.fail(); // See subclasses\n    }\n\n    private var _loaders :Array<BasicAssetPackLoader>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\n/**\n * Internal helper for shared debug logic across all platforms.\n */\nclass DebugLogic\n{\n    public function new (platform :Platform)\n    {\n        _platform = platform;\n\n        platform.getKeyboard().down.connect(function (event) {\n            if (event.key == O && platform.getKeyboard().isDown(Control)) {\n                if (toggleOverdrawGraphics()) {\n                    Log.info(\"Enabled overdraw visualizer, press Ctrl-O again to disable\");\n                }\n            }\n        });\n    }\n\n    /**\n     * Toggles the overdraw debug renderer.\n     * @return Whether the overdraw renderer was enabled.\n     */\n    public function toggleOverdrawGraphics () :Bool\n    {\n        var renderer = _platform.getRenderer();\n\n        if (_savedGraphics != null) {\n            renderer.graphics = _savedGraphics;\n            _savedGraphics = null;\n\n        } else if (renderer.graphics != null) {\n            _savedGraphics = renderer.graphics;\n            renderer.graphics = new OverdrawGraphics(_savedGraphics);\n            return true;\n        }\n\n        return false;\n    }\n\n    private var _platform :Platform;\n\n    /** The normal Graphics saved by toggleOverdrawGraphics so it can restored. */\n    private var _savedGraphics :InternalGraphics;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.sound.Playback;\nimport flambe.sound.Sound;\nimport flambe.util.Value;\n\n/**\n * An empty sound used in environments that don't support audio.\n */\nclass DummySound extends BasicAsset<DummySound>\n    implements Sound\n{\n    public var duration (get, null) :Float;\n\n    public function new ()\n    {\n        super();\n        _playback = new DummyPlayback(this);\n    }\n\n    public function play (volume :Float = 1.0) :Playback\n    {\n        return _playback;\n    }\n\n    public function loop (volume :Float = 1.0) :Playback\n    {\n        return _playback;\n    }\n\n    public function get_duration () :Float\n    {\n        return 0;\n    }\n\n    override private function copyFrom (asset :DummySound)\n    {\n        // Nothing at all\n    }\n\n    override private function onDisposed ()\n    {\n        // Nothing at all\n    }\n\n    public static function getInstance () :DummySound\n    {\n        if (_instance == null) {\n            _instance = new DummySound();\n        }\n        return _instance;\n    }\n\n    private static var _instance :DummySound;\n\n    private var _playback :DummyPlayback;\n}\n\n// This should be immutable too\nclass DummyPlayback\n    implements Playback\n{\n    public var volume (default, null) :AnimatedFloat;\n    public var paused (get, set) :Bool;\n    public var complete (get, null) :Value<Bool>;\n    public var position (get, null) :Float;\n    public var sound (get, null) :Sound;\n\n    public function new (sound :Sound)\n    {\n        _sound = sound;\n        this.volume = new AnimatedFloat(0); // A little quirky? All DummyPlaybacks share the same volume\n        _complete = new Value<Bool>(true);\n    }\n\n    public function get_sound () :Sound\n    {\n        return _sound;\n    }\n\n    public function get_paused () :Bool\n    {\n        return true;\n    }\n\n    public function set_paused (paused :Bool) :Bool\n    {\n        return true;\n    }\n\n    public function get_complete () :Value<Bool>\n    {\n        return _complete;\n    }\n\n    public function get_position () :Float\n    {\n        return 0;\n    }\n\n    public function dispose ()\n    {\n        // Nothing\n    }\n\n    private var _sound :Sound;\n\n    private var _complete :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.subsystem.StorageSystem;\n\nclass DummyStorage\n    implements StorageSystem\n{\n    public var supported (get, null) :Bool;\n\n    public function new ()\n    {\n        clear();\n    }\n\n    public function get_supported () :Bool\n    {\n        return false;\n    }\n\n    public function set (key :String, value :Dynamic) :Bool\n    {\n        _hash.set(key, value);\n        return true;\n    }\n\n    public function get<A> (key :String, defaultValue :A = null) :A\n    {\n        return _hash.exists(key) ? _hash.get(key) : defaultValue;\n    }\n\n    public function remove (key :String)\n    {\n        _hash.remove(key);\n    }\n\n    public function clear ()\n    {\n        _hash = new Map<String,Dynamic>();\n    }\n\n    private var _hash :Map<String,Dynamic>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.TouchPoint;\nimport flambe.subsystem.TouchSystem;\nimport flambe.util.Signal1;\n\nclass DummyTouch\n    implements TouchSystem\n{\n    public var supported (get, null) :Bool;\n    public var maxPoints (get, null) :Int;\n    public var points (get, null) :Array<TouchPoint>;\n\n    public var down (default, null) :Signal1<TouchPoint>;\n    public var move (default, null) :Signal1<TouchPoint>;\n    public var up (default, null) :Signal1<TouchPoint>;\n\n    public function new ()\n    {\n        down = new Signal1();\n        move = new Signal1();\n        up = new Signal1();\n    }\n\n    public function get_supported () :Bool\n    {\n        return false;\n    }\n\n    public function get_maxPoints () :Int\n    {\n        return 0;\n    }\n\n    public function get_points () :Array<TouchPoint>\n    {\n        return [];\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.util.Disposable;\n\n#if flash\nimport flash.events.IEventDispatcher;\nimport flash.events.Event;\n#else\nimport js.html.EventTarget in IEventDispatcher;\nimport js.html.Event;\n#end\n\nprivate typedef Listener = Dynamic -> Void;\n\n/**\n * Manages a group of event listeners. When the group is disposed, all listeners are removed.\n */\nclass EventGroup\n    implements Disposable\n{\n    public function new ()\n    {\n        _entries = [];\n    }\n\n    /** Register a listener with this group. */\n    public function addListener (dispatcher :IEventDispatcher, type :String, listener :Listener)\n    {\n        dispatcher.addEventListener(type, listener, false);\n        _entries.push(new Entry(dispatcher, type, listener));\n    }\n\n    /** Register a listener with this group, all listeners are removed when it's fired. */\n    public function addDisposingListener (\n        dispatcher :IEventDispatcher, type :String, listener :Listener)\n    {\n        addListener(dispatcher, type, function (event :Event) {\n            dispose();\n            listener(event);\n        });\n    }\n\n    /** Detach all listeners registered with this group. */\n    public function dispose ()\n    {\n        for (entry in _entries) {\n            entry.dispatcher.removeEventListener(entry.type, entry.listener, false);\n        }\n        _entries = [];\n    }\n\n    private var _entries :Array<Entry>;\n}\n\nprivate class Entry\n{\n    public var dispatcher :IEventDispatcher;\n    public var type :String;\n    public var listener :Listener;\n\n    public function new (dispatcher, type, listener)\n    {\n        this.dispatcher = dispatcher;\n        this.type = type;\n        this.listener = listener;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.util.Signal1;\nimport flambe.util.SignalConnection;\nimport flambe.util.Value;\n\n/** An internal Signal1 with extra frills. */\nclass HeavySignal1<A> extends Signal1<A>\n{\n    /**\n     * A watchable value, for detecting when the first listener was connected, or the last\n     * connection was disposed.\n     */\n    public var hasListenersValue (default, null) :Value<Bool>;\n\n    public function new (?listener :Listener1<A>)\n    {\n        super(listener);\n        hasListenersValue = new Value<Bool>(hasListeners());\n    }\n\n    override public function connect (listener :Listener1<A>, prioritize :Bool = false) :SignalConnection\n    {\n        var connection = super.connect(listener, prioritize);\n        hasListenersValue._ = hasListeners();\n        return connection;\n    }\n\n    override private function disconnect (conn :SignalConnection)\n    {\n        super.disconnect(conn);\n        hasListenersValue._ = hasListeners();\n    }\n\n    override private function didEmit (head :SignalConnection)\n    {\n        super.didEmit(head);\n        hasListenersValue._ = hasListeners();\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.Key;\n\n/**\n * Key codes emitted by Flash and JS.\n */\nclass KeyCodes\n{\n    public static inline var A = 65;\n    public static inline var B = 66;\n    public static inline var C = 67;\n    public static inline var D = 68;\n    public static inline var E = 69;\n    public static inline var F = 70;\n    public static inline var G = 71;\n    public static inline var H = 72;\n    public static inline var I = 73;\n    public static inline var J = 74;\n    public static inline var K = 75;\n    public static inline var L = 76;\n    public static inline var M = 77;\n    public static inline var N = 78;\n    public static inline var O = 79;\n    public static inline var P = 80;\n    public static inline var Q = 81;\n    public static inline var R = 82;\n    public static inline var S = 83;\n    public static inline var T = 84;\n    public static inline var U = 85;\n    public static inline var V = 86;\n    public static inline var W = 87;\n    public static inline var X = 88;\n    public static inline var Y = 89;\n    public static inline var Z = 90;\n\n    public static inline var NUMBER_0 = 48;\n    public static inline var NUMBER_1 = 49;\n    public static inline var NUMBER_2 = 50;\n    public static inline var NUMBER_3 = 51;\n    public static inline var NUMBER_4 = 52;\n    public static inline var NUMBER_5 = 53;\n    public static inline var NUMBER_6 = 54;\n    public static inline var NUMBER_7 = 55;\n    public static inline var NUMBER_8 = 56;\n    public static inline var NUMBER_9 = 57;\n\n    public static inline var NUMPAD_0 = 96;\n    public static inline var NUMPAD_1 = 97;\n    public static inline var NUMPAD_2 = 98;\n    public static inline var NUMPAD_3 = 99;\n    public static inline var NUMPAD_4 = 100;\n    public static inline var NUMPAD_5 = 101;\n    public static inline var NUMPAD_6 = 102;\n    public static inline var NUMPAD_7 = 103;\n    public static inline var NUMPAD_8 = 104;\n    public static inline var NUMPAD_9 = 105;\n\n    public static inline var NUMPAD_ADD = 107;\n    public static inline var NUMPAD_DECIMAL = 110;\n    public static inline var NUMPAD_DIVIDE = 111;\n    public static inline var NUMPAD_ENTER = 108;\n    public static inline var NUMPAD_MULTIPLY = 106;\n    public static inline var NUMPAD_SUBTRACT = 109;\n\n    public static inline var F1 = 112;\n    public static inline var F2 = 113;\n    public static inline var F3 = 114;\n    public static inline var F4 = 115;\n    public static inline var F5 = 116;\n    public static inline var F6 = 117;\n    public static inline var F7 = 118;\n    public static inline var F8 = 119;\n    public static inline var F9 = 120;\n    public static inline var F10 = 121;\n    public static inline var F11 = 122;\n    public static inline var F12 = 123;\n    public static inline var F13 = 124;\n    public static inline var F14 = 125;\n    public static inline var F15 = 126;\n\n    public static inline var LEFT = 37;\n    public static inline var UP = 38;\n    public static inline var RIGHT = 39;\n    public static inline var DOWN = 40;\n\n    public static inline var ALT = 18;\n    public static inline var BACKQUOTE = 192;\n    public static inline var BACKSLASH = 220;\n    public static inline var BACKSPACE = 8;\n    public static inline var CAPS_LOCK = 20;\n    public static inline var COMMA = 188;\n    public static inline var COMMAND = 15;\n    public static inline var CONTROL = 17;\n    public static inline var DELETE = 46;\n    public static inline var END = 35;\n    public static inline var ENTER = 13;\n    public static inline var EQUALS = 187;\n    public static inline var ESCAPE = 27;\n    public static inline var HOME = 36;\n    public static inline var INSERT = 45;\n    public static inline var LEFT_BRACKET = 219;\n    public static inline var MINUS = 189;\n    public static inline var PAGE_DOWN = 34;\n    public static inline var PAGE_UP = 33;\n    public static inline var PERIOD = 190;\n    public static inline var QUOTE = 222;\n    public static inline var RIGHT_BRACKET = 221;\n    public static inline var SEMICOLON = 186;\n    public static inline var SHIFT = 16;\n    public static inline var SLASH = 191;\n    public static inline var SPACE = 32;\n    public static inline var TAB = 9;\n\n    // Android keys (AIR only)\n    public static inline var BACK = 0x01000016;\n    public static inline var MENU = 0x01000012;\n    public static inline var SEARCH = 0x0100001f;\n\n    public static function toKey (keyCode :Int) :Key\n    {\n        switch (keyCode) {\n            case A: return Key.A;\n            case B: return Key.B;\n            case C: return Key.C;\n            case D: return Key.D;\n            case E: return Key.E;\n            case F: return Key.F;\n            case G: return Key.G;\n            case H: return Key.H;\n            case I: return Key.I;\n            case J: return Key.J;\n            case K: return Key.K;\n            case L: return Key.L;\n            case M: return Key.M;\n            case N: return Key.N;\n            case O: return Key.O;\n            case P: return Key.P;\n            case Q: return Key.Q;\n            case R: return Key.R;\n            case S: return Key.S;\n            case T: return Key.T;\n            case U: return Key.U;\n            case V: return Key.V;\n            case W: return Key.W;\n            case X: return Key.X;\n            case Y: return Key.Y;\n            case Z: return Key.Z;\n\n            case NUMBER_0: return Key.Number0;\n            case NUMBER_1: return Key.Number1;\n            case NUMBER_2: return Key.Number2;\n            case NUMBER_3: return Key.Number3;\n            case NUMBER_4: return Key.Number4;\n            case NUMBER_5: return Key.Number5;\n            case NUMBER_6: return Key.Number6;\n            case NUMBER_7: return Key.Number7;\n            case NUMBER_8: return Key.Number8;\n            case NUMBER_9: return Key.Number9;\n\n            case NUMPAD_0: return Key.Numpad0;\n            case NUMPAD_1: return Key.Numpad1;\n            case NUMPAD_2: return Key.Numpad2;\n            case NUMPAD_3: return Key.Numpad3;\n            case NUMPAD_4: return Key.Numpad4;\n            case NUMPAD_5: return Key.Numpad5;\n            case NUMPAD_6: return Key.Numpad6;\n            case NUMPAD_7: return Key.Numpad7;\n            case NUMPAD_8: return Key.Numpad8;\n            case NUMPAD_9: return Key.Numpad9;\n\n            case NUMPAD_ADD: return Key.NumpadAdd;\n            case NUMPAD_DECIMAL: return Key.NumpadDecimal;\n            case NUMPAD_DIVIDE: return Key.NumpadDivide;\n            case NUMPAD_ENTER: return Key.NumpadEnter;\n            case NUMPAD_MULTIPLY: return Key.NumpadMultiply;\n            case NUMPAD_SUBTRACT: return Key.NumpadSubtract;\n\n            case F1: return Key.F1;\n            case F2: return Key.F2;\n            case F3: return Key.F3;\n            case F4: return Key.F4;\n            case F5: return Key.F5;\n            case F6: return Key.F6;\n            case F7: return Key.F7;\n            case F8: return Key.F8;\n            case F9: return Key.F9;\n            case F10: return Key.F10;\n            case F11: return Key.F11;\n            case F12: return Key.F12;\n\n            case LEFT: return Key.Left;\n            case UP: return Key.Up;\n            case RIGHT: return Key.Right;\n            case DOWN: return Key.Down;\n\n            case ALT: return Key.Alt;\n            case BACKQUOTE: return Key.Backquote;\n            case BACKSLASH: return Key.Backslash;\n            case BACKSPACE: return Key.Backspace;\n            case CAPS_LOCK: return Key.CapsLock;\n            case COMMA: return Key.Comma;\n            case COMMAND: return Key.Command;\n            case CONTROL: return Key.Control;\n            case DELETE: return Key.Delete;\n            case END: return Key.End;\n            case ENTER: return Key.Enter;\n            case EQUALS: return Key.Equals;\n            case ESCAPE: return Key.Escape;\n            case HOME: return Key.Home;\n            case INSERT: return Key.Insert;\n            case LEFT_BRACKET: return Key.LeftBracket;\n            case MINUS: return Key.Minus;\n            case PAGE_DOWN: return Key.PageDown;\n            case PAGE_UP: return Key.PageUp;\n            case PERIOD: return Key.Period;\n            case QUOTE: return Key.Quote;\n            case RIGHT_BRACKET: return Key.RightBracket;\n            case SEMICOLON: return Key.Semicolon;\n            case SHIFT: return Key.Shift;\n            case SLASH: return Key.Slash;\n            case SPACE: return Key.Space;\n            case TAB: return Key.Tab;\n\n            case MENU: return Key.Menu;\n            case SEARCH: return Key.Search;\n        }\n\n        return Unknown(keyCode);\n    }\n\n    public static function toKeyCode (key :Key) :Int\n    {\n        switch (key) {\n            case Key.A: return A;\n            case Key.B: return B;\n            case Key.C: return C;\n            case Key.D: return D;\n            case Key.E: return E;\n            case Key.F: return F;\n            case Key.G: return G;\n            case Key.H: return H;\n            case Key.I: return I;\n            case Key.J: return J;\n            case Key.K: return K;\n            case Key.L: return L;\n            case Key.M: return M;\n            case Key.N: return N;\n            case Key.O: return O;\n            case Key.P: return P;\n            case Key.Q: return Q;\n            case Key.R: return R;\n            case Key.S: return S;\n            case Key.T: return T;\n            case Key.U: return U;\n            case Key.V: return V;\n            case Key.W: return W;\n            case Key.X: return X;\n            case Key.Y: return Y;\n            case Key.Z: return Z;\n\n            case Key.Number0: return NUMBER_0;\n            case Key.Number1: return NUMBER_1;\n            case Key.Number2: return NUMBER_2;\n            case Key.Number3: return NUMBER_3;\n            case Key.Number4: return NUMBER_4;\n            case Key.Number5: return NUMBER_5;\n            case Key.Number6: return NUMBER_6;\n            case Key.Number7: return NUMBER_7;\n            case Key.Number8: return NUMBER_8;\n            case Key.Number9: return NUMBER_9;\n\n            case Key.Numpad0: return NUMPAD_0;\n            case Key.Numpad1: return NUMPAD_1;\n            case Key.Numpad2: return NUMPAD_2;\n            case Key.Numpad3: return NUMPAD_3;\n            case Key.Numpad4: return NUMPAD_4;\n            case Key.Numpad5: return NUMPAD_5;\n            case Key.Numpad6: return NUMPAD_6;\n            case Key.Numpad7: return NUMPAD_7;\n            case Key.Numpad8: return NUMPAD_8;\n            case Key.Numpad9: return NUMPAD_9;\n\n            case Key.NumpadAdd: return NUMPAD_ADD;\n            case Key.NumpadDecimal: return NUMPAD_DECIMAL;\n            case Key.NumpadDivide: return NUMPAD_DIVIDE;\n            case Key.NumpadEnter: return NUMPAD_ENTER;\n            case Key.NumpadMultiply: return NUMPAD_MULTIPLY;\n            case Key.NumpadSubtract: return NUMPAD_SUBTRACT;\n\n            case Key.F1: return F1;\n            case Key.F2: return F2;\n            case Key.F3: return F3;\n            case Key.F4: return F4;\n            case Key.F5: return F5;\n            case Key.F6: return F6;\n            case Key.F7: return F7;\n            case Key.F8: return F8;\n            case Key.F9: return F9;\n            case Key.F10: return F10;\n            case Key.F11: return F11;\n            case Key.F12: return F12;\n            case Key.F13: return F13;\n            case Key.F14: return F14;\n            case Key.F15: return F15;\n\n            case Key.Left: return LEFT;\n            case Key.Up: return UP;\n            case Key.Right: return RIGHT;\n            case Key.Down: return DOWN;\n\n            case Key.Alt: return ALT;\n            case Key.Backquote: return BACKQUOTE;\n            case Key.Backslash: return BACKSLASH;\n            case Key.Backspace: return BACKSPACE;\n            case Key.CapsLock: return CAPS_LOCK;\n            case Key.Comma: return COMMA;\n            case Key.Command: return COMMAND;\n            case Key.Control: return CONTROL;\n            case Key.Delete: return DELETE;\n            case Key.End: return END;\n            case Key.Enter: return ENTER;\n            case Key.Equals: return EQUALS;\n            case Key.Escape: return ESCAPE;\n            case Key.Home: return HOME;\n            case Key.Insert: return INSERT;\n            case Key.LeftBracket: return LEFT_BRACKET;\n            case Key.Minus: return MINUS;\n            case Key.PageDown: return PAGE_DOWN;\n            case Key.PageUp: return PAGE_UP;\n            case Key.Period: return PERIOD;\n            case Key.Quote: return QUOTE;\n            case Key.RightBracket: return RIGHT_BRACKET;\n            case Key.Semicolon: return SEMICOLON;\n            case Key.Shift: return SHIFT;\n            case Key.Slash: return SLASH;\n            case Key.Space: return SPACE;\n            case Key.Tab: return TAB;\n\n            case Key.Menu: return MENU;\n            case Key.Search: return SEARCH;\n\n            case Key.Unknown(keyCode): return keyCode;\n        }\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.Component;\nimport flambe.Entity;\nimport flambe.System;\nimport flambe.display.Graphics;\nimport flambe.display.Sprite;\nimport flambe.scene.Director;\n\nusing Lambda;\nusing flambe.util.Arrays;\nusing flambe.util.BitSets;\n\n/**\n * Updates all components and renders.\n */\nclass MainLoop\n{\n    public function new ()\n    {\n        _tickables = [];\n    }\n\n    public function update (dt :Float)\n    {\n        if (dt <= 0) {\n            // This can happen on platforms that don't have monotonic timestamps and are prone to\n            // system clock adjustment\n            Log.warn(\"Zero or negative time elapsed since the last frame!\", [\"dt\", dt]);\n            return;\n        }\n        if (dt > 1) {\n            // Clamp deltaTime to a reasonable limit. Games tend not to cope well with huge\n            // deltaTimes. Platforms should skip the next frame after unpausing to prevent sending\n            // huge deltaTimes, but not all environments support detecting an unpause\n            dt = 1;\n        }\n\n        // First update any tickables, folding away nulls\n        var ii = 0;\n        while (ii < _tickables.length) {\n            var t = _tickables[ii];\n            if (t == null || t.update(dt)) {\n                _tickables.splice(ii, 1);\n            } else {\n                ++ii;\n            }\n        }\n\n        System.volume.update(dt);\n\n        updateEntity(System.root, dt);\n    }\n\n    public function render<A> (renderer :InternalRenderer<A>)\n    {\n        var graphics = renderer.graphics;\n        if (graphics != null) {\n            renderer.willRender();\n            Sprite.render(System.root, graphics);\n            renderer.didRender();\n        }\n    }\n\n    public function addTickable (t :Tickable)\n    {\n        _tickables.push(t);\n    }\n\n    public function removeTickable (t :Tickable)\n    {\n        var idx = _tickables.indexOf(t);\n        if (idx >= 0) {\n            // Actual removals only happen in update()\n            _tickables[idx] = null;\n        }\n    }\n\n    private static function updateEntity (entity :Entity, dt :Float)\n    {\n        // Handle update speed adjustment\n        var speed = entity.get(SpeedAdjuster);\n        if (speed != null) {\n            speed._realDt = dt;\n\n            dt *= speed.scale._;\n            if (dt <= 0) {\n                // This entity is paused, avoid descending into children. But do update the speed\n                // adjuster (so it can still be animated)\n                speed.onUpdate(dt);\n                return;\n            }\n        }\n\n        // Update components\n        var p = entity.firstComponent;\n        while (p != null) {\n            var next = p.next;\n            if (!p._flags.contains(Component.STARTED)) {\n                p._flags = p._flags.add(Component.STARTED);\n                p.onStart();\n            }\n            p.onUpdate(dt);\n            p = next;\n        }\n\n        // Update children\n        var p = entity.firstChild;\n        while (p != null) {\n            var next = p.next;\n            updateEntity(p, dt);\n            p = next;\n        }\n    }\n\n    private var _tickables :Array<Tickable>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nclass MathUtil\n{\n    /**\n     * Returns the smallest power of two >= n.\n     */\n    public static function nextPowerOfTwo (n :Int) :Int\n    {\n        var p = 1;\n        while (p < n) {\n            p <<= 1;\n        }\n        return p;\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.input.MouseButton;\n\n/**\n * Mouse button codes used internally.\n */\nclass MouseCodes\n{\n    public static inline var LEFT = 0;\n    public static inline var MIDDLE = 1;\n    public static inline var RIGHT = 2;\n\n    public static function toButton (buttonCode :Int) :MouseButton\n    {\n        switch (buttonCode) {\n            case LEFT: return Left;\n            case MIDDLE: return Middle;\n            case RIGHT: return Right;\n        }\n\n        return Unknown(buttonCode);\n    }\n\n    public static function toButtonCode (button :MouseButton) :Int\n    {\n        switch (button) {\n            case Left: return LEFT;\n            case Middle: return MIDDLE;\n            case Right: return RIGHT;\n\n            case Unknown(buttonCode): return buttonCode;\n        }\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport flambe.display.BlendMode;\nimport flambe.display.Texture;\n\nclass OverdrawGraphics\n    implements InternalGraphics\n{\n    public function new (impl :InternalGraphics)\n    {\n        _impl = impl;\n    }\n\n    public function save ()\n    {\n        _impl.save();\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        _impl.translate(x, y);\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        _impl.scale(x, y);\n    }\n\n    public function rotate (rotation :Float)\n    {\n        _impl.rotate(rotation);\n    }\n\n    public function transform (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        _impl.transform(m00, m10, m01, m11, m02, m12);\n    }\n\n    public function multiplyAlpha (factor :Float)\n    {\n        // Ignore\n    }\n\n    public function setAlpha (alpha :Float)\n    {\n        // Ignore\n    }\n\n    public function setBlendMode (blendMode :BlendMode)\n    {\n        // Ignore\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        _impl.applyScissor(x, y, width, height);\n    }\n\n    public function restore ()\n    {\n        _impl.restore();\n    }\n\n    public function drawTexture (texture :Texture, destX :Float, destY :Float)\n    {\n        drawRegion(destX, destY, texture.width, texture.height);\n    }\n\n    public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        drawRegion(destX, destY, sourceW, sourceH);\n    }\n\n    public function drawPattern (texture :Texture, destX :Float, destY :Float, width :Float, height :Float)\n    {\n        drawRegion(destX, destY, width, height);\n    }\n\n    public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        drawRegion(x, y, width, height);\n    }\n\n    public function willRender ()\n    {\n        _impl.willRender();\n        _impl.save();\n        _impl.setBlendMode(Add);\n    }\n\n    public function didRender ()\n    {\n        _impl.restore();\n        _impl.didRender();\n    }\n\n    public function onResize (width :Int, height :Int)\n    {\n        _impl.onResize(width, height);\n    }\n\n    /** Draws an overdraw region rectangle. */\n    private function drawRegion (x :Float, y :Float, width :Float, height :Float)\n    {\n        _impl.fillRect(0x101008, x, y, width, height);\n    }\n\n    private var _impl :InternalGraphics;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.display.BlendMode;\nimport flambe.display.Graphics;\nimport flambe.display.Texture;\nimport flambe.math.FMath;\n\n// TODO(bruno): Remove pixel snapping once most browsers get canvas acceleration.\nclass CanvasGraphics\n    implements InternalGraphics\n{\n    public function new (canvas :CanvasElement, alpha :Bool)\n    {\n        _canvasCtx = (untyped canvas).getContext(\"2d\", {alpha: alpha});\n    }\n\n    public function save ()\n    {\n        _canvasCtx.save();\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        _canvasCtx.translate(Std.int(x), Std.int(y));\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        _canvasCtx.scale(x, y);\n    }\n\n    public function rotate (rotation :Float)\n    {\n        _canvasCtx.rotate(FMath.toRadians(rotation));\n    }\n\n    public function transform (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        _canvasCtx.transform(m00, m10, m01, m11, m02, m12);\n    }\n\n    public function restore ()\n    {\n        _canvasCtx.restore();\n    }\n\n    public function drawTexture (texture :Texture, destX :Float, destY :Float)\n    {\n        drawSubTexture(texture, destX, destY, 0, 0, texture.width, texture.height);\n    }\n\n    public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        if (_firstDraw) {\n            _firstDraw = false;\n            _canvasCtx.globalCompositeOperation = \"copy\";\n            drawSubTexture(texture, destX, destY, sourceX, sourceY, sourceW, sourceH);\n            _canvasCtx.globalCompositeOperation = \"source-over\";\n            return;\n        }\n\n        var texture :CanvasTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        _canvasCtx.drawImage(root.image,\n            Std.int(texture.rootX+sourceX), Std.int(texture.rootY+sourceY),\n            Std.int(sourceW), Std.int(sourceH),\n            Std.int(destX), Std.int(destY), Std.int(sourceW), Std.int(sourceH));\n    }\n\n    public function drawPattern (texture :Texture, x :Float, y :Float, width :Float, height :Float)\n    {\n        if (_firstDraw) {\n            _firstDraw = false;\n            _canvasCtx.globalCompositeOperation = \"copy\";\n            drawPattern(texture, x, y, width, height);\n            _canvasCtx.globalCompositeOperation = \"source-over\";\n            return;\n        }\n\n        var texture :CanvasTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        _canvasCtx.fillStyle = texture.getPattern();\n        _canvasCtx.fillRect(Std.int(x), Std.int(y), Std.int(width), Std.int(height));\n    }\n\n    public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        if (_firstDraw) {\n            _firstDraw = false;\n            _canvasCtx.globalCompositeOperation = \"copy\";\n            fillRect(color, x, y, width, height);\n            _canvasCtx.globalCompositeOperation = \"source-over\";\n            return;\n        }\n\n        // Convert color into a hex string in the form of #RRGGBB\n        var hex = untyped (0xffffff & color).toString(16);\n        while (hex.length < 6) {\n            hex = \"0\"+hex;\n        }\n        _canvasCtx.fillStyle = \"#\"+hex;\n        _canvasCtx.fillRect(Std.int(x), Std.int(y), Std.int(width), Std.int(height));\n    }\n\n    public function multiplyAlpha (factor :Float)\n    {\n        _canvasCtx.globalAlpha *= factor;\n    }\n\n    public function setAlpha (alpha :Float)\n    {\n        _canvasCtx.globalAlpha = alpha;\n    }\n\n    public function setBlendMode (blendMode :BlendMode)\n    {\n        var op;\n        switch (blendMode) {\n            case Normal: op = \"source-over\";\n            case Add: op = \"lighter\";\n            case Multiply: op = \"multiply\";\n            case Screen: op = \"screen\";\n            case Mask: op = \"destination-in\";\n            case Copy: op = \"copy\";\n        };\n        _canvasCtx.globalCompositeOperation = op;\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        _canvasCtx.beginPath();\n        _canvasCtx.rect(Std.int(x), Std.int(y), Std.int(width), Std.int(height));\n        _canvasCtx.clip();\n    }\n\n    public function willRender ()\n    {\n        // Disable blending for the first draw call. This squeezes a bit of performance out of games\n        // that have a single large background sprite, especially on older devices\n        _firstDraw = true;\n    }\n\n    public function didRender ()\n    {\n        // Nothing at all\n    }\n\n    public function onResize (width :Int, height :Int)\n    {\n        // Nothing at all\n    }\n\n    private var _canvasCtx :CanvasRenderingContext2D;\n    private var _firstDraw :Bool = false;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport haxe.io.Bytes;\n\nimport flambe.asset.AssetEntry;\nimport flambe.subsystem.RendererSystem;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\nclass CanvasRenderer\n    implements InternalRenderer<Dynamic>\n{\n    public var type (get, null) :RendererType;\n    public var maxTextureSize (get, null) :Int;\n    public var hasGPU (get, null) :Value<Bool>;\n\n    public var graphics :InternalGraphics;\n\n    public function new (canvas :CanvasElement)\n    {\n        graphics = new CanvasGraphics(canvas, #if flambe_transparent true #else false #end);\n        _hasGPU = new Value<Bool>(true);\n    }\n\n    inline private function get_type () :RendererType\n    {\n        return Canvas;\n    }\n\n    private function get_maxTextureSize () :Int\n    {\n        // Canvases larger than 1024 prevent hardware acceleration in iOS\n        // TODO(bruno): Return 2048 on non-iOS browsers?\n        return 1024;\n    }\n\n    inline private function get_hasGPU () :Value<Bool>\n    {\n        return _hasGPU;\n    }\n\n    public function createTextureFromImage (image :Dynamic) :CanvasTexture\n    {\n        var root = new CanvasTextureRoot(CANVAS_TEXTURES ? HtmlUtil.createCanvas(image) : image);\n        return root.createTexture(root.width, root.height);\n    }\n\n    public function createTexture (width :Int, height :Int) :CanvasTexture\n    {\n        var root = new CanvasTextureRoot(HtmlUtil.createEmptyCanvas(width, height));\n        return root.createTexture(width, height);\n    }\n\n    public function getCompressedTextureFormats () :Array<AssetFormat>\n    {\n        return [];\n    }\n\n    public function createCompressedTexture (format :AssetFormat, data :Bytes) :CanvasTexture\n    {\n        Assert.fail(); // Unsupported\n        return null;\n    }\n\n    public function willRender ()\n    {\n        graphics.willRender();\n    }\n\n    public function didRender ()\n    {\n        graphics.didRender();\n    }\n\n    public function getName () :String\n    {\n        return \"Canvas\";\n    }\n\n    /** If true, blit loaded images to a canvas and use that as the texture. */\n    private static var CANVAS_TEXTURES :Bool = (function () {\n        // On iOS, canvas textures are way faster\n        // http://jsperf.com/drawimage-vs-canvaspattern/8\n        var pattern = ~/(iPhone|iPod|iPad)/;\n        return pattern.match(Browser.window.navigator.userAgent);\n    })();\n\n    private var _hasGPU :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.*;\n\nclass CanvasTexture extends BasicTexture<CanvasTextureRoot>\n{\n    public function new (root :CanvasTextureRoot, width :Int, height :Int)\n    {\n        super(root, width, height);\n    }\n\n    public function getPattern () :CanvasPattern\n    {\n        if (_rootUpdateCount != root.updateCount || _pattern == null) {\n            _rootUpdateCount = root.updateCount;\n            _pattern = root.createPattern(rootX, rootY, width, height);\n        }\n        return _pattern;\n    }\n\n    private var _pattern :CanvasPattern = null;\n    private var _rootUpdateCount :Int = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport haxe.io.Bytes;\nimport haxe.io.BytesData;\n\nimport flambe.display.Graphics;\nimport flambe.display.Texture;\n\nclass CanvasTextureRoot extends BasicAsset<CanvasTextureRoot>\n    implements TextureRoot\n{\n    public var width (default, null) :Int;\n    public var height (default, null) :Int;\n\n    // The Image (or sometimes Canvas) used for most draw calls\n    public var image (default, null) :Dynamic;\n\n    public var updateCount :Int = 0;\n\n    public function new (image :Dynamic)\n    {\n        super();\n        this.image = image;\n        width = image.width;\n        height = image.height;\n    }\n\n    public function createTexture (width :Int, height :Int) :CanvasTexture\n    {\n        return new CanvasTexture(this, width, height);\n    }\n\n    public function readPixels (x :Int, y :Int, width :Int, height :Int) :Bytes\n    {\n        assertNotDisposed();\n\n        return Bytes.ofData(cast getContext2d().getImageData(x, y, width, height).data);\n    }\n\n    public function writePixels (pixels :Bytes, x :Int, y :Int, sourceW :Int, sourceH :Int)\n    {\n        assertNotDisposed();\n\n        var ctx2d = getContext2d();\n        var imageData = ctx2d.createImageData(sourceW, sourceH);\n        var data :Dynamic = imageData.data;\n        if (data.set != null) {\n            // Data is a Uint8ClampedArray, copy it in one swoop\n            data.set(pixels.getData());\n        } else {\n            // Data is a normal array, copy it manually\n            var size = 4*sourceW*sourceH;\n            for (ii in 0...size) {\n                data[ii] = pixels.get(ii);\n            }\n        }\n\n        // Draw the pixels, and invalidate our contents\n        ctx2d.putImageData(imageData, x, y);\n        dirtyContents();\n    }\n\n    // Invalidates the cached patterns of all textures using this root\n    inline public function dirtyContents ()\n    {\n        ++updateCount;\n    }\n\n    public function getGraphics () :CanvasGraphics\n    {\n        assertNotDisposed();\n\n        if (_graphics == null) {\n            getContext2d(); // Force conversion\n            _graphics = new InternalGraphics(this);\n        }\n        return _graphics;\n    }\n\n    public function createPattern (x :Int, y :Int, width :Int, height :Int) :CanvasPattern\n    {\n        var ctx2d = getContext2d();\n        var source = image;\n        if (x != 0 || y != 0 || width != this.width || height != this.height) {\n            // Create a temporary canvas if the size doesn't match this root\n            source = HtmlUtil.createEmptyCanvas(width, height);\n            var crop = source.getContext2d();\n            crop.globalCompositeOperation = \"copy\";\n            crop.drawImage(image, -x, -y);\n        }\n        return ctx2d.createPattern(source, \"repeat\");\n    }\n\n    private function getContext2d () :CanvasRenderingContext2D\n    {\n        // Convert the image to a canvas when necessary. Why not have the image be a canvas to\n        // begin with, you ask? Some browsers (notably Android 4) render canvases a LOT slower\n        // than image elements, so we avoid using a canvas unless absolutely necessary. One day\n        // when Android's browser joins the modern age, this can be simplified.\n        // http://jsperf.com/canvas-drawimage\n        if (!Std.is(image, CanvasElement)) {\n            image = HtmlUtil.createCanvas(image);\n        }\n        var canvas :CanvasElement = cast image;\n        return canvas.getContext2d();\n    }\n\n    override private function copyFrom (that :CanvasTextureRoot)\n    {\n        this.image = that.image;\n        this._graphics = that._graphics;\n        dirtyContents();\n    }\n\n    override private function onDisposed ()\n    {\n        image = null;\n        _graphics = null;\n    }\n\n    private var _graphics :CanvasGraphics = null;\n}\n\n// A Graphics that invalidates its texture's cached pattern after every draw call\nprivate class InternalGraphics extends CanvasGraphics\n{\n    public function new (renderTarget :CanvasTextureRoot)\n    {\n        super(renderTarget.image, true);\n        _renderTarget = renderTarget;\n    }\n\n    override public function drawTexture (texture :Texture, x :Float, y :Float)\n    {\n        super.drawTexture(texture, x, y);\n        _renderTarget.dirtyContents();\n    }\n\n    override public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        super.drawSubTexture(texture, destX, destY, sourceX, sourceY, sourceW, sourceH);\n        _renderTarget.dirtyContents();\n    }\n\n    override public function drawPattern (texture :Texture, x :Float, y :Float,\n        width :Float, height :Float)\n    {\n        super.drawPattern(texture, x, y, width, height);\n        _renderTarget.dirtyContents();\n    }\n\n    override public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        super.fillRect(color, x, y, width, height);\n        _renderTarget.dirtyContents();\n    }\n\n    private var _renderTarget :CanvasTextureRoot;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.ProgressEvent;\nimport js.html.XMLHttpRequest;\nimport js.Browser;\nimport js.html.Blob;\nimport js.lib.ArrayBuffer;\nimport haxe.Http;\n\nimport flambe.asset.AssetEntry;\nimport flambe.asset.Manifest;\nimport flambe.util.Assert;\nimport flambe.util.Promise;\nimport flambe.util.Signal0;\nimport flambe.util.Signal1;\n\nclass HtmlAssetPackLoader extends BasicAssetPackLoader\n{\n    public function new (platform :HtmlPlatform, manifest :Manifest)\n    {\n        super(platform, manifest);\n    }\n\n    override private function loadEntry (url :String, entry :AssetEntry)\n    {\n        switch (entry.format) {\n        case WEBP, JXR, PNG, JPG, GIF:\n            var image = Browser.document.createImageElement();\n            var events = new EventGroup();\n\n            events.addDisposingListener(image, \"load\", function (_) {\n#if debug\n                if (image.width > 1024 || image.height > 1024) {\n                    Log.warn(\"Images larger than 1024px on a side will prevent GPU acceleration\" +\n                        \" on some platforms (iOS)\", [\"url\", url,\n                        \"width\", image.width, \"height\", image.height]);\n                }\n#end\n                if (supportsBlob()) {\n                    // Reclaim memory previously allocated by createObjectURL\n                    _URL.revokeObjectURL(image.src);\n                }\n\n                var texture = _platform.getRenderer().createTextureFromImage(image);\n                if (texture != null) {\n                    handleLoad(entry, texture);\n                } else {\n                    handleTextureError(entry);\n                }\n            });\n            events.addDisposingListener(image, \"error\", function (_) {\n                handleError(entry, \"Failed to load image\");\n            });\n\n            // If this browser supports Blob, load the image data over XHR to benefit from progress\n            // events, otherwise just set the src directly\n            if (supportsBlob()) {\n                downloadBlob(url, entry, function (blob) {\n                    image.src = _URL.createObjectURL(blob);\n                });\n            } else {\n                image.src = url;\n            }\n\n        case DDS, PVR, PKM:\n            downloadArrayBuffer(url, entry, function (buffer) {\n                // FIXME(bruno): Convert buffer to a Bytes and pass it along\n                var texture = _platform.getRenderer().createCompressedTexture(entry.format, null);\n                if (texture != null) {\n                    handleLoad(entry, texture);\n                } else {\n                    handleTextureError(entry);\n                }\n            });\n\n        case MP3, M4A, OPUS, OGG, WAV:\n            // If we made it this far, we definitely support audio and can play this asset\n            if (WebAudioSound.supported) {\n                downloadArrayBuffer(url, entry, function (buffer) {\n                    WebAudioSound.ctx.decodeAudioData(buffer, function (decoded) {\n                        handleLoad(entry, new WebAudioSound(decoded));\n                    }, function () {\n                        // Happens in iOS 6 beta for some sounds that should be able to play. It\n                        // seems that monochannel audio will always fail, try converting to stereo.\n                        // Since this happens unpredictably, continue with a DummySound rather than\n                        // rejecting the entire asset pack.\n                        Log.warn(\"Couldn't decode Web Audio, ignoring this asset\", [\"url\", url]);\n                        handleLoad(entry, DummySound.getInstance());\n                    });\n                });\n\n            } else {\n                var audio = Browser.document.createAudioElement();\n                audio.preload = \"auto\"; // Hint that we want to preload the entire file\n\n                // Maintain a hard reference to the audio during loading to prevent GC on some\n                // browsers\n                var ref = ++_mediaRefCount;\n                if (_mediaElements == null) {\n                    _mediaElements = new Map<Int,Dynamic>();\n                }\n                _mediaElements.set(ref, audio);\n\n                var events = new EventGroup();\n                events.addDisposingListener(audio, \"canplaythrough\", function (_) {\n                    _mediaElements.remove(ref);\n                    handleLoad(entry, new HtmlSound(audio));\n                });\n                events.addDisposingListener(audio, \"error\", function (_) {\n                    _mediaElements.remove(ref);\n                    var code = audio.error.code;\n                    if (code == 3 || code == 4) {\n                        // If the song successfully downloaded but this browser can't play it for\n                        // some reason (MEDIA_ERR_DECODE or MEDIA_ERR_SRC_NOT_SUPPORTED), warn and\n                        // press on with an empty sound.\n                        Log.warn(\"Couldn't decode HTML5 audio, ignoring this asset\",\n                            [\"url\", url, \"code\", code]);\n                        handleLoad(entry, DummySound.getInstance());\n                    } else {\n                        handleError(entry, \"Failed to load audio: \" + audio.error.code);\n                    }\n                });\n                events.addListener(audio, \"progress\", function (_) {\n                    if (audio.buffered.length > 0 && audio.duration > 0) {\n                        // Estimate the bytes downloaded based on the available time range\n                        var progress = audio.buffered.end(0) / audio.duration;\n                        handleProgress(entry, Std.int(progress*entry.bytes));\n                    }\n                });\n\n                audio.src = url;\n                audio.load();\n            }\n\n        case Data:\n            downloadText(url, entry, function (text) {\n                handleLoad(entry, new BasicFile(text));\n            });\n        }\n    }\n\n    override private function getAssetFormats (fn :Array<AssetFormat> -> Void)\n    {\n        if (_supportedFormats == null) {\n            _supportedFormats = new Promise();\n            detectImageFormats(function (imageFormats) {\n                _supportedFormats.result = _platform.getRenderer().getCompressedTextureFormats()\n                    .concat(imageFormats).concat(detectAudioFormats()).concat([Data]);\n            });\n        }\n        _supportedFormats.get(fn);\n    }\n\n    inline private function downloadArrayBuffer (url :String, entry :AssetEntry, onLoad :ArrayBuffer -> Void)\n    {\n        download(url, entry, \"arraybuffer\", onLoad);\n    }\n\n    inline private function downloadBlob (url :String, entry :AssetEntry, onLoad :Blob -> Void)\n    {\n        download(url, entry, \"blob\", onLoad);\n    }\n\n    inline private function downloadText (url :String, entry :AssetEntry, onLoad :String -> Void)\n    {\n        download(url, entry, \"text\", onLoad);\n    }\n\n    private function download (url :String, entry :AssetEntry, responseType :String, onLoad :Dynamic -> Void)\n    {\n        var xhr :XMLHttpRequest = null;\n        var start = null;\n\n        var intervalId = 0;\n        var hasInterval = false;\n        var clearRetryInterval = function () {\n            if (hasInterval) {\n                hasInterval = false;\n                Browser.window.clearInterval(intervalId);\n            }\n        };\n\n        var retries = XHR_RETRIES;\n        var maybeRetry = function () {\n            // Returns true if the download was retried\n            --retries;\n            if (retries >= 0) {\n                Log.warn(\"Retrying asset download\", [\"url\", entry.url]);\n                start();\n                return true;\n            }\n            return false;\n        };\n\n        start = function () {\n            clearRetryInterval();\n\n            if (xhr != null) {\n                xhr.abort();\n            }\n            xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", url, true);\n            untyped xhr.responseType = responseType;\n\n            var lastProgress = 0.0;\n            xhr.onprogress = function (event :ProgressEvent) {\n                // When the first progress event comes in, start detecting stalled downloads\n                if (!hasInterval) {\n                    hasInterval = true;\n                    intervalId = Browser.window.setInterval(function () {\n                        // If the download isn't finished, and enough time has passed since the last\n                        // progress event, consider it stalled and attempt to retry\n                        if (xhr.readyState != XMLHttpRequest.DONE && HtmlUtil.now() - lastProgress > XHR_TIMEOUT) {\n                            if (!maybeRetry()) {\n                                clearRetryInterval();\n                                handleError(entry, \"Download stalled\");\n                            }\n                        }\n                    }, 1000);\n                }\n\n                lastProgress = HtmlUtil.now();\n                handleProgress(entry, event.loaded);\n            };\n\n            xhr.onerror = function (_) {\n                if (xhr.status != 0 || !maybeRetry()) {\n                    clearRetryInterval();\n                    handleError(entry, \"HTTP error \" + xhr.status);\n                }\n            };\n\n            xhr.onload = function (_) {\n                var response :Dynamic = xhr.response;\n                if (response == null) {\n                    // Hack for IE9, which doesn't have xhr.response, only responseText\n                    response = xhr.responseText;\n                }\n                clearRetryInterval();\n                onLoad(response);\n            };\n\n            xhr.send();\n        };\n\n        start();\n    }\n\n    private static function detectImageFormats (fn :Array<AssetFormat> -> Void)\n    {\n        var formats = [PNG, JPG, GIF];\n\n        var formatTests = 2;\n        var checkRemaining = function () {\n            // Called when an image test completes\n            --formatTests;\n            if (formatTests == 0) {\n                fn(formats);\n            }\n        };\n\n        // Detect WebP-lossless support (and assume that lossy works where lossless does)\n        // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/img/webp-lossless.js\n        var webp = Browser.document.createImageElement();\n        webp.onload = webp.onerror = function (_) {\n            if (webp.width == 1) {\n                formats.unshift(WEBP);\n            }\n            checkRemaining();\n        };\n        webp.src = \"data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==\";\n\n        // Detect JPEG XR support\n        var jxr = Browser.document.createImageElement();\n        jxr.onload = jxr.onerror = function (_) {\n            if (jxr.width == 1) {\n                formats.unshift(JXR);\n            }\n            checkRemaining();\n        };\n        // The smallest JXR I could generate (where pixel.tif is a 1x1 black image)\n        // ./jpegxr pixel.tif -c -o pixel.jxr -f YOnly -q 255 -b DCONLY -a 0 -w\n        jxr.src = \"data:image/vnd.ms-photo;base64,SUm8AQgAAAAFAAG8AQAQAAAASgAAAIC8BAABAAAAAQAAAIG8BAABAAAAAQAAAMC8BAABAAAAWgAAAMG8BAABAAAAHwAAAAAAAAAkw91vA07+S7GFPXd2jckNV01QSE9UTwAZAYBxAAAAABP/gAAEb/8AAQAAAQAAAA==\";\n    }\n\n    private static function detectAudioFormats () :Array<AssetFormat>\n    {\n        // Detect basic support for HTML5 audio\n        var audio = Browser.document.createAudioElement();\n        if (audio == null || audio.canPlayType == null) {\n            Log.warn(\"Audio is not supported at all in this browser!\");\n            return [];\n        }\n\n        // Reject browsers that claim to support audio, but are too buggy or incomplete\n#if flambe_html_audio_fix\n        var blacklist = ~/\\b(iPhone|iPod|iPad|Windows Phone)\\b/;\n#else\n        var blacklist = ~/\\b(iPhone|iPod|iPad|Android|Windows Phone)\\b/;\n#end\n        var userAgent = Browser.navigator.userAgent;\n        if (!WebAudioSound.supported && blacklist.match(userAgent)) {\n            Log.warn(\"HTML5 audio is blacklisted for this browser\", [\"userAgent\", userAgent]);\n            return [];\n        }\n\n        // Select what formats the browser supports\n        var types = [\n            { format: M4A,  mimeType: \"audio/mp4; codecs=mp4a\" },\n            { format: MP3,  mimeType: \"audio/mpeg\" },\n            { format: OPUS, mimeType: \"audio/ogg; codecs=opus\" },\n            { format: OGG,  mimeType: \"audio/ogg; codecs=vorbis\" },\n            { format: WAV,  mimeType: \"audio/wav\" },\n        ];\n#if flambe_disable_firefox_mp3\n        // Temporary hack to disable Firefox MP3 loading. This will no longer be necessary after\n        // Firefox 28: https://bugzilla.mozilla.org/show_bug.cgi?id=967007\n        if (userAgent.indexOf(\"Gecko/\") >= 0) {\n            types.splice(1, 1);\n        }\n#end\n        var result = [];\n        for (type in types) {\n            // IE9's canPlayType() will throw an error in some rare cases:\n            // https://github.com/Modernizr/Modernizr/issues/224\n            var canPlayType = \"\";\n            try canPlayType = audio.canPlayType(type.mimeType)\n            catch (_ :Dynamic) {}\n\n            if (canPlayType != \"\") {\n                result.push(type.format);\n            }\n        }\n        return result;\n    }\n\n    private static function supportsBlob () :Bool\n    {\n        // Checks for XHR Blob responseType support\n        // http://html5test.com/compare/feature/communication-xmlhttprequest2.response-blob/communication-websocket.binary.html\n        if (_detectBlobSupport) {\n            _detectBlobSupport = false;\n\n            // Blobs on Amazon Silk are buggy: https://github.com/aduros/flambe/issues/194\n            if (~/\\bSilk\\b/.match(Browser.navigator.userAgent)) {\n                return false;\n            }\n\n            if ((untyped Browser.window).Blob == null) {\n                return false; // No Blob constructor\n            }\n\n            var xhr = new XMLHttpRequest();\n            // Hack for IE, which throws an InvalidStateError upon setting the responseType when\n            // in the UNSENT state, despite the spec being clear about only throwing in LOADING\n            // or DONE: http://www.w3.org/TR/XMLHttpRequest2/#dom-xmlhttprequest-responsetype\n            //\n            // Forcing it into the OPENED state does the trick, and doesn't actually send the\n            // request so it's all good.\n            xhr.open(\"GET\", \".\", true);\n\n            if (untyped xhr.responseType != \"\") {\n                return false; // No responseType supported at all\n            }\n\n            untyped xhr.responseType = \"blob\"; // Using untyped to prevent problems going between haxe 3.1 to haxe 3.2\n            if (untyped xhr.responseType != \"blob\") {\n                return false; // Blob responseType not supported\n            }\n\n            _URL = HtmlUtil.loadExtension(\"URL\").value;\n        }\n        return _URL != null && _URL.createObjectURL != null;\n    }\n\n    private static inline var XHR_TIMEOUT = 5000;\n    private static inline var XHR_RETRIES = 3;\n\n    private static var _supportedFormats :Promise<Array<AssetFormat>> = null;\n\n    /**\n     * Media elements get GCed during loading in Chrome and IE9. The spec is clear that elements\n     * shouldn't be GCed while playing, but vague about GCing while loading. So, maintain a hard\n     * reference to all media elements being loaded to prevent GC.\n     */\n    private static var _mediaElements :Map<Int,Dynamic>;\n    private static var _mediaRefCount = 0;\n\n    private static var _detectBlobSupport = true;\n    private static var _URL :Dynamic = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nclass HtmlCatapultClient extends CatapultClient\n{\n    public static function canUse () :Bool\n    {\n        return Reflect.hasField(Browser.window, \"WebSocket\");\n    }\n\n    public function new ()\n    {\n        super();\n\n        _socket = new WebSocket(\"ws://\" + Browser.location.host);\n        _socket.onerror = function (event) {\n            onError(\"unknown\");\n        };\n        _socket.onopen = function (event) {\n            Log.info(\"Catapult connected\");\n        };\n        _socket.onmessage = function (event :MessageEvent) {\n            onMessage(event.data);\n        };\n    }\n\n    override private function onRestart ()\n    {\n        Browser.window.top.location.reload();\n    }\n\n    private var _socket :WebSocket;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\n\nimport flambe.subsystem.ExternalSystem;\n\nclass HtmlExternal\n    implements ExternalSystem\n{\n    public var supported (get, null) :Bool;\n\n    public function new ()\n    {\n    }\n\n    public function get_supported ()\n    {\n        return true;\n    }\n\n    public function call (name :String, ?params :Array<Dynamic>) :Dynamic\n    {\n        if (params == null) {\n            params = [];\n        }\n\n        var object = Browser.window;\n        var method :Dynamic = object;\n        for (fieldName in name.split(\".\")) {\n            object = method;\n            method = Reflect.field(object, fieldName);\n        }\n        return Reflect.callMethod(object, method, params);\n    }\n\n    public function bind (name :String, fn :Dynamic)\n    {\n        Reflect.setField(Browser.window, name, fn);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport flambe.util.Logger;\n\nclass HtmlLogHandler\n    implements LogHandler\n{\n    public static function isSupported () :Bool\n    {\n        return js.Syntax.plainCode(\"typeof console\") == \"object\" && js.Syntax.plainCode(\"console\").info != null;\n    }\n\n    public function new (tag :String)\n    {\n        _tagPrefix = tag + \": \";\n    }\n\n    public function log (level :LogLevel, message :String)\n    {\n        message = _tagPrefix + message;\n\n        switch (level) {\n        case Info:\n            (js.Syntax.plainCode(\"console\")).info(message);\n        case Warn:\n            (js.Syntax.plainCode(\"console\")).warn(message);\n        case Error:\n            (js.Syntax.plainCode(\"console\")).error(message);\n        }\n    }\n\n    private var _tagPrefix :String;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.input.Acceleration;\nimport flambe.input.Attitude;\nimport flambe.subsystem.MotionSystem;\nimport flambe.util.Signal1;\n\nclass HtmlMotion\n    implements MotionSystem\n{\n    public var accelerationSupported (get, null) :Bool;\n    public var acceleration (default, null) :Signal1<Acceleration>;\n    public var accelerationIncludingGravity (default, null) :Signal1<Acceleration>;\n\n    public var attitudeSupported (get, null) :Bool;\n    public var attitude (default, null) :Signal1<Attitude>;\n\n    public function new ()\n    {\n        var acceleration = new HeavySignal1();\n        this.acceleration = acceleration;\n\n        var accelerationIncludingGravity = new HeavySignal1();\n        this.accelerationIncludingGravity = accelerationIncludingGravity;\n\n        var attitude = new HeavySignal1();\n        this.attitude = attitude;\n\n        if (accelerationSupported) {\n            _sharedAcceleration = new Acceleration();\n            _sharedAccelerationIncludingGravity = new Acceleration();\n\n            var motionEvents :EventGroup = null;\n            var onListenersChanged = function (_,_) {\n                if (acceleration.hasListeners() || accelerationIncludingGravity.hasListeners()) {\n                    if (motionEvents == null) {\n                        // Connected the first listener, add the native event listener\n                        motionEvents = new EventGroup();\n                        motionEvents.addListener(Browser.window, \"devicemotion\", onDeviceMotion);\n                    }\n                } else {\n                    if (motionEvents != null) {\n                        // Disconnected the last listener, remove the native event listener\n                        motionEvents.dispose();\n                        motionEvents = null;\n                    }\n                }\n            };\n            acceleration.hasListenersValue.changed.connect(onListenersChanged);\n            accelerationIncludingGravity.hasListenersValue.changed.connect(onListenersChanged);\n        }\n\n        if (attitudeSupported) {\n            _sharedAttitude = new Attitude();\n\n            var orientationEvents :EventGroup = null;\n            attitude.hasListenersValue.changed.connect(function (hasListeners,_) {\n                if (hasListeners) {\n                    orientationEvents = new EventGroup();\n                    orientationEvents.addListener(Browser.window, \"deviceorientation\", onDeviceOrientation);\n                } else {\n                    orientationEvents.dispose();\n                    orientationEvents = null;\n                }\n            });\n        }\n    }\n\n    private function get_accelerationSupported () :Bool\n    {\n        return (untyped Browser.window).DeviceMotionEvent != null;\n    }\n\n    // http://dev.w3.org/geo/api/spec-source-orientation.html#devicemotion\n    private function onDeviceMotion (event :DeviceMotionEvent)\n    {\n        if (event.acceleration != null) {\n            initAcceleration(_sharedAcceleration, event.acceleration);\n            acceleration.emit(_sharedAcceleration);\n        }\n\n        if (event.accelerationIncludingGravity != null) {\n            initAcceleration(_sharedAccelerationIncludingGravity,\n                event.accelerationIncludingGravity);\n            accelerationIncludingGravity.emit(_sharedAccelerationIncludingGravity);\n        }\n    }\n\n    private function get_attitudeSupported () :Bool\n    {\n        return (untyped Browser.window).DeviceOrientationEvent != null;\n    }\n\n    // http://dev.w3.org/geo/api/spec-source-orientation.html#deviceorientation\n    private function onDeviceOrientation (event :DeviceOrientationEvent)\n    {\n        switch ((untyped Browser.window).orientation) {\n        case -90:\n            _sharedAttitude.init( event.gamma, -event.beta , event.alpha);\n        case 0:\n            _sharedAttitude.init( event.beta ,  event.gamma, event.alpha);\n        case 90:\n            _sharedAttitude.init(-event.gamma,  event.beta , event.alpha);\n        case 180:\n            _sharedAttitude.init(-event.beta , -event.gamma, event.alpha);\n        }\n\n        attitude.emit(_sharedAttitude);\n    }\n\n    private static function initAcceleration (acceleration :Acceleration, input :DeviceAcceleration)\n    {\n        switch ((untyped Browser.window).orientation) {\n        case -90:\n            acceleration.init( input.y, -input.x, input.z);\n        case 0:\n            acceleration.init( input.x,  input.y, input.z);\n        case 90:\n            acceleration.init(-input.y,  input.x, input.z);\n        case 180:\n            acceleration.init(-input.x, -input.y, input.z);\n        }\n    }\n\n    private var _sharedAcceleration :Acceleration;\n    private var _sharedAccelerationIncludingGravity :Acceleration;\n    private var _sharedAttitude :Attitude;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport flambe.input.MouseCursor;\n\nclass HtmlMouse extends BasicMouse\n{\n    public function new (pointer :BasicPointer, canvas :Dynamic)\n    {\n        super(pointer);\n        _canvas = canvas;\n    }\n\n    override public function set_cursor (cursor :MouseCursor) :MouseCursor\n    {\n        var name;\n        switch (cursor) {\n            case Default: name = \"\"; // inherit\n            case Button: name = \"pointer\";\n            case None: name = \"none\";\n        }\n        _canvas.style.cursor = name;\n\n        return super.set_cursor(cursor);\n    }\n\n    private var _canvas :Dynamic;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.platform.Tickable;\nimport flambe.sound.Playback;\nimport flambe.sound.Sound;\nimport flambe.util.Disposable;\nimport flambe.util.Value;\n\nclass HtmlSound extends BasicAsset<HtmlSound>\n    implements Sound\n{\n    public var duration (get, null) :Float;\n    public var audioElement :Dynamic; // TODO(bruno): Use typed audio element extern\n\n    public function new (audioElement :Dynamic)\n    {\n        super();\n        this.audioElement = audioElement;\n    }\n\n    public function play (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new HtmlPlayback(this, volume, false);\n    }\n\n    public function loop (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new HtmlPlayback(this, volume, true);\n    }\n\n    public function get_duration () :Float\n    {\n        assertNotDisposed();\n\n        return audioElement.duration;\n    }\n\n    override private function copyFrom (that :HtmlSound)\n    {\n        this.audioElement = that.audioElement;\n    }\n\n    override private function onDisposed ()\n    {\n        audioElement = null;\n    }\n}\n\nprivate class HtmlPlayback\n    implements Playback\n    implements Tickable\n{\n    public var volume (default, null) :AnimatedFloat;\n    public var paused (get, set) :Bool;\n    public var complete (get, null) :Value<Bool>;\n    public var position (get, null) :Float;\n    public var sound (get, null) :Sound;\n\n    public function new (sound :HtmlSound, volume :Float, loop :Bool)\n    {\n        _sound = sound;\n        _tickableAdded = false;\n\n        // Create a copy of the original sound's element. Note that cloneNode() doesn't work in IE\n        _clonedElement = Browser.document.createAudioElement();\n        _clonedElement.loop = loop;\n        _clonedElement.src = sound.audioElement.src;\n\n        this.volume = new AnimatedFloat(volume, function (_,_) updateVolume());\n        updateVolume();\n        _complete = new Value<Bool>(false);\n\n        playAudio();\n\n        // Don't start playing until visible\n        if (System.hidden._) {\n            paused = true;\n        }\n    }\n\n    public function get_sound () :Sound\n    {\n        return _sound;\n    }\n\n    inline public function get_paused () :Bool\n    {\n        return _clonedElement.paused;\n    }\n\n    public function set_paused (paused :Bool) :Bool\n    {\n        if (_clonedElement.paused != paused) {\n            if (paused) {\n                _clonedElement.pause();\n            } else {\n                playAudio();\n            }\n        }\n        return paused;\n    }\n\n    public function get_complete () :Value<Bool>\n    {\n        return _complete;\n    }\n\n    public function get_position () :Float\n    {\n        return _clonedElement.currentTime;\n    }\n\n    public function update (dt :Float) :Bool\n    {\n        volume.update(dt);\n        _complete._ = _clonedElement.ended;\n\n        if (_complete._ || paused) {\n            // Allow complete or paused sounds to be garbage collected\n            _tickableAdded = false;\n\n            // Release System references\n            _volumeBinding.dispose();\n            _hideBinding.dispose();\n\n            return true;\n        }\n        return false;\n    }\n\n    public function dispose ()\n    {\n        paused = true;\n        _complete._ = true;\n    }\n\n    private function playAudio ()\n    {\n        #if flambe_html_audio_fix\n        // Only allow looping audio to play\n        // Assumes background music loops\n        if (!_clonedElement.loop) {\n            return;\n        }\n\n        // Only allow one background music\n        if (HtmlPlatform.instance.musicPlaying) {\n            return;\n        }\n        HtmlPlatform.instance.musicPlaying = true;\n        #end\n\n        _clonedElement.play();\n\n        if (!_tickableAdded) {\n            HtmlPlatform.instance.mainLoop.addTickable(this);\n            _tickableAdded = true;\n\n            // Claim System references\n            _volumeBinding = System.volume.changed.connect(function(_,_) updateVolume());\n            _hideBinding = System.hidden.changed.connect(function(hidden,_) {\n                if (hidden) {\n                    _wasPaused = get_paused();\n                    this.paused = true;\n                } else {\n                    this.paused = _wasPaused;\n                }\n            });\n        }\n    }\n\n    private function updateVolume ()\n    {\n        _clonedElement.volume = System.volume._ * volume._;\n    }\n\n    private var _sound :HtmlSound;\n    private var _clonedElement :Dynamic;\n    private var _volumeBinding :Disposable;\n    private var _tickableAdded :Bool;\n    private var _hideBinding :Disposable;\n    private var _wasPaused :Bool;\n\n    private var _complete :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\n\nimport flambe.display.Orientation;\nimport flambe.subsystem.StageSystem;\nimport flambe.util.Signal0;\nimport flambe.util.Value;\n\nclass HtmlStage\n    implements StageSystem\n{\n    public var width (get, null) :Int;\n    public var height (get, null) :Int;\n    public var orientation (default, null) :Value<Orientation>;\n    public var fullscreen (default, null) :Value<Bool>;\n    public var fullscreenSupported (get, null) :Bool;\n\n    public var resize (default, null) :Signal0;\n\n    public var scaleFactor (default, null) :Float;\n\n    public function new (canvas :CanvasElement)\n    {\n        _canvas = canvas;\n        resize = new Signal0();\n\n#if flambe_disable_html_retina\n        scaleFactor = 1;\n#else\n        // If the DPI is being scaled by the browser, reverse it so that one canvas pixel equals\n        // one screen pixel\n        scaleFactor = computeScaleFactor();\n        if (scaleFactor != 1) {\n            Log.info(\"Reversing device DPI scaling\", [\"scaleFactor\", scaleFactor]);\n            HtmlUtil.setVendorStyle(_canvas, \"transform-origin\", \"top left\");\n            HtmlUtil.setVendorStyle(_canvas, \"transform\", \"scale(\" + (1/scaleFactor) + \")\");\n        }\n#end\n\n#if !flambe_disable_autoresize\n        if (HtmlUtil.SHOULD_HIDE_MOBILE_BROWSER) {\n            Browser.window.addEventListener(\"orientationchange\", function (_) {\n                // Wait for the orientation change to finish... sigh\n                HtmlUtil.callLater(hideMobileBrowser, 200);\n            }, false);\n            hideMobileBrowser();\n        }\n\n        Browser.window.addEventListener(\"resize\", onWindowResize, false);\n        onWindowResize(null);\n#end\n\n        orientation = new Value<Orientation>(null);\n        if ((untyped Browser.window).orientation != null) {\n            Browser.window.addEventListener(\"orientationchange\", onOrientationChange, false);\n            onOrientationChange(null);\n        }\n\n        fullscreen = new Value<Bool>(false);\n        HtmlUtil.addVendorListener(Browser.document, \"fullscreenchange\", function (_) {\n            updateFullscreen();\n        }, false);\n#if debug\n        HtmlUtil.addVendorListener(Browser.document, \"fullscreenerror\", function (_) {\n            // No useful error message since the event provides no reason. See the error conditions\n            // at http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html#dom-element-requestfullscreen\n            Log.warn(\"Error when requesting fullscreen\");\n        }, false);\n#end\n        updateFullscreen();\n    }\n\n    public function get_width () :Int\n    {\n        return _canvas.width;\n    }\n\n    public function get_height () :Int\n    {\n        return _canvas.height;\n    }\n\n    public function get_fullscreenSupported () :Bool\n    {\n        return HtmlUtil.loadFirstExtension(\n            [\"fullscreenEnabled\", \"fullScreenEnabled\"], Browser.document).value == true;\n    }\n\n    public function lockOrientation (orient :Orientation)\n    {\n        var lockOrientation = HtmlUtil.loadExtension(\"lockOrientation\", Browser.window.screen).value;\n        if (lockOrientation != null) {\n            var htmlOrient = switch (orient) {\n                case Portrait: \"portrait\";\n                case Landscape: \"landscape\";\n            };\n            var allowed = Reflect.callMethod(Browser.window.screen, lockOrientation, [htmlOrient]);\n            if (!allowed) {\n                Log.warn(\"The request to lockOrientation() was refused by the browser\");\n            }\n        }\n    }\n\n    public function unlockOrientation ()\n    {\n        var unlockOrientation = HtmlUtil.loadExtension(\"unlockOrientation\", Browser.window.screen).value;\n        if (unlockOrientation != null) {\n            Reflect.callMethod(Browser.window.screen, unlockOrientation, []);\n        }\n    }\n\n    public function requestResize (width :Int, height :Int)\n    {\n        if (resizeCanvas(width, height)) {\n            // Fit the container to the requested canvas size\n            var container = _canvas.parentElement;\n            container.style.width = width + \"px\";\n            container.style.height = height + \"px\";\n        }\n    }\n\n    public function requestFullscreen (enable :Bool = true)\n    {\n        if (enable) {\n            var documentElement = Browser.document.documentElement;\n            var requestFullscreen = HtmlUtil.loadFirstExtension(\n               [\"requestFullscreen\", \"requestFullScreen\"], documentElement).value;\n            if (requestFullscreen != null) {\n                Reflect.callMethod(documentElement, requestFullscreen, []);\n            }\n\n        } else {\n            var cancelFullscreen = HtmlUtil.loadFirstExtension(\n                [\"cancelFullscreen\", \"cancelFullScreen\"], Browser.document).value;\n            if (cancelFullscreen != null) {\n                Reflect.callMethod(Browser.document, cancelFullscreen, []);\n            }\n        }\n    }\n\n    private function onWindowResize (_)\n    {\n        // Resize the canvas to match its container's bounds\n        var container = _canvas.parentElement;\n        var rect = container.getBoundingClientRect();\n        resizeCanvas(rect.width, rect.height);\n    }\n\n    private function resizeCanvas (width :Float, height :Float) :Bool\n    {\n        // Take device scaling into account...\n        var scaledWidth = scaleFactor*width;\n        var scaledHeight = scaleFactor*height;\n\n        if (_canvas.width == scaledWidth && _canvas.height == scaledHeight) {\n            return false;\n        }\n\n        _canvas.width = Std.int(scaledWidth);\n        _canvas.height = Std.int(scaledHeight);\n        resize.emit();\n        return true;\n    }\n\n    // Voodoo hacks required to move the address bar out of the way on Android and iOS\n    private function hideMobileBrowser ()\n    {\n        // The maximum size of the part of the browser that can be scrolled away\n        var mobileAddressBar = 100;\n\n        var htmlStyle = Browser.document.documentElement.style;\n\n        // Force the page to be tall enough to scroll\n        htmlStyle.height = (Browser.window.innerHeight + mobileAddressBar) + \"px\";\n        htmlStyle.width = Browser.window.innerWidth + \"px\";\n        htmlStyle.overflow = \"visible\"; // Need to have overflow to scroll...\n\n        HtmlUtil.callLater(function () {\n            // Scroll the address bar away\n            HtmlUtil.hideMobileBrowser();\n\n            HtmlUtil.callLater(function () {\n                // Fit the page to the new screen size\n                htmlStyle.height = Browser.window.innerHeight + \"px\";\n\n                onWindowResize(null);\n            }, 100);\n        });\n    }\n\n    private function onOrientationChange (_)\n    {\n        var value = HtmlUtil.orientation((untyped Browser.window).orientation);\n        orientation._ = value;\n    }\n\n    private function updateFullscreen ()\n    {\n        var state :Dynamic = HtmlUtil.loadFirstExtension(\n            [\"fullscreen\", \"fullScreen\", \"isFullScreen\"], Browser.document).value;\n        fullscreen._ = (state == true); // state will be null if fullscreen not supported\n    }\n\n    private static function computeScaleFactor () :Float\n    {\n        // Based on \"Delivering Web Content on High Resolution Displays\"\n        // https://developer.apple.com/videos/wwdc/2012/?id=602\n\n        var devicePixelRatio = Browser.window.devicePixelRatio;\n        if (devicePixelRatio == null) {\n            devicePixelRatio = 1;\n        }\n\n        // Take into account any behind-the-scenes scaling of canvas elements\n        var canvas = Browser.document.createCanvasElement();\n        var ctx = canvas.getContext2d();\n        var backingStorePixelRatio = HtmlUtil.loadExtension(\"backingStorePixelRatio\", ctx).value;\n        if (backingStorePixelRatio == null) {\n            backingStorePixelRatio = 1;\n        }\n\n        // Calculate the scale, but bail early if this would cause the canvas to be larger than some\n        // magic threshold. This was added to disable the retina display on the iPad 3, as\n        // performance plummets there when scaling such a huge canvas\n        var scale = devicePixelRatio / backingStorePixelRatio;\n        var screenWidth = Browser.window.screen.width;\n        var screenHeight = Browser.window.screen.height;\n        if (scale*screenWidth > 1136 || scale*screenHeight > 1136) {\n            return 1;\n        }\n        return scale;\n    }\n\n    private var _canvas :CanvasElement;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport haxe.Serializer;\nimport haxe.Unserializer;\n\nimport flambe.subsystem.StorageSystem;\n\nclass HtmlStorage\n    implements StorageSystem\n{\n    public var supported (get, null) :Bool;\n\n    public function new (storage :Dynamic)\n    {\n        _storage = storage;\n    }\n\n    public function get_supported () :Bool\n    {\n        return true;\n    }\n\n    public function set (key :String, value :Dynamic) :Bool\n    {\n        var encoded :String;\n        try {\n            var serializer = new Serializer();\n            serializer.useCache = true; // Allow circular references\n            serializer.useEnumIndex = false; // Ensure persistence-friendly enums\n            serializer.serialize(value);\n            encoded = serializer.toString();\n        } catch (error :Dynamic) {\n            Log.warn(\"Storage serialization failed\", [\"message\", error]);\n            return false;\n        }\n\n        try {\n            _storage.setItem(PREFIX + key, encoded);\n        } catch (error :Dynamic) {\n            // setItem may throw a QuotaExceededError:\n            // http://dev.w3.org/html5/webstorage/#dom-localstorage\n            Log.warn(\"localStorage.setItem failed\", [\"message\", error.message]);\n            return false;\n        }\n        return true;\n    }\n\n    public function get<A> (key :String, defaultValue :A = null) :A\n    {\n        var encoded :String = null;\n        try {\n            encoded = _storage.getItem(PREFIX + key);\n        } catch (error :Dynamic) {\n            // This should never happen, but it sometimes does in Firefox and IE\n            Log.warn(\"localStorage.getItem failed\", [\"message\", error.message]);\n        }\n\n        if (encoded != null) {\n            try {\n                return Unserializer.run(encoded);\n            } catch (error :Dynamic) {\n                Log.warn(\"Storage unserialization failed\", [\"message\", error]);\n            }\n        }\n        return defaultValue;\n    }\n\n    public function remove (key :String)\n    {\n        try {\n            _storage.removeItem(PREFIX + key);\n        } catch (error :Dynamic) {\n            // This should never happen, but it sometimes does in Firefox and IE\n            Log.warn(\"localStorage.removeItem failed\", [\"message\", error.message]);\n        }\n    }\n\n    public function clear ()\n    {\n        try {\n            _storage.clear();\n        } catch (error :Dynamic) {\n            // This should never happen, but it sometimes does in Firefox and IE\n            Log.warn(\"localStorage.clear failed\", [\"message\", error.message]);\n        }\n    }\n\n    // Prefix localStorage keys to prevent collisions with other JS on the page\n    private static inline var PREFIX = \"flambe:\";\n\n    private var _storage :Dynamic;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.Browser;\nimport js.html.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.display.Orientation;\n\nclass HtmlUtil\n{\n    public static var VENDOR_PREFIXES = [\"webkit\", \"moz\", \"ms\", \"o\", \"khtml\"];\n\n    /**\n     * Whether the annoying scrolling address bar in some iOS and Android browsers may be hidden.\n     */\n    public static var SHOULD_HIDE_MOBILE_BROWSER =\n#if !flambe_disable_hide_mobile_browser\n        Browser.window.top == Browser.window &&\n        ~/Mobile(\\/.*)? Safari/.match(Browser.navigator.userAgent);\n#else\n        false;\n#end\n\n    public static function callLater (func :Void -> Void, delay :Int = 0)\n    {\n        Browser.window.setTimeout(func, delay);\n    }\n\n    public static function hideMobileBrowser ()\n    {\n        Browser.window.scrollTo(1, 0);\n    }\n\n    // Load a prefixed vendor extension\n    public static function loadExtension (\n        name :String, ?obj :Dynamic) :{ prefix :String, field :String, value :Dynamic }\n    {\n        if (obj == null) {\n            obj = Browser.window;\n        }\n\n        // Try to load it as is\n        var extension = Reflect.field(obj, name);\n        if (extension != null) {\n            return {prefix: \"\", field: name, value: extension};\n        }\n\n        // Look through common vendor prefixes\n        var capitalized = name.charAt(0).toUpperCase() + name.substr(1);\n        for (prefix in VENDOR_PREFIXES) {\n            var field = prefix + capitalized;\n            var extension = Reflect.field(obj, field);\n            if (extension != null) {\n                return {prefix: prefix, field: field, value: extension};\n            }\n        }\n\n        // Not found\n        return {prefix: null, field: null, value: null};\n    }\n\n    public static function loadFirstExtension (\n        names :Array<String>, ?obj :Dynamic) :{ prefix :String, field :String, value :Dynamic }\n    {\n        for (name in names) {\n            var extension = loadExtension(name, obj);\n            if (extension.field != null) {\n                return extension;\n            }\n        }\n\n        // Not found\n        return {prefix: null, field: null, value: null};\n    }\n\n    // Loads a vendor extension and jams it into the supplied object\n    public static function polyfill (name :String, ?obj :Dynamic) :Bool\n    {\n        if (obj == null) {\n            obj = Browser.window;\n        }\n\n        var value = loadExtension(name, obj).value;\n        if (value == null) {\n            return false;\n        }\n        Reflect.setField(obj, name, value);\n        return true;\n    }\n\n    public static function setVendorStyle (element :Dynamic, name :String, value :String)\n    {\n        var style = element.style;\n        for (prefix in VENDOR_PREFIXES) {\n            style.setProperty(\"-\" + prefix + \"-\" + name, value);\n        }\n        style.setProperty(name, value);\n    }\n\n    public static function addVendorListener (dispatcher :EventTarget, type :String,\n        listener :Dynamic -> Void, useCapture :Bool)\n    {\n        for (prefix in VENDOR_PREFIXES) {\n            dispatcher.addEventListener(prefix + type, listener, useCapture);\n        }\n        dispatcher.addEventListener(type, listener, useCapture);\n    }\n\n    /**\n     * Get a Flambe orientation from a window.orientation angle.\n     */\n    public static function orientation (angle :Int) :Orientation\n    {\n        switch (angle) {\n            case -90, 90: return Landscape;\n            default: return Portrait;\n        }\n    }\n\n    /** Gets the current time in milliseconds since the Unix epoch. */\n    inline public static function now () :Float\n    {\n        // Same thing as Date.now().getTime(), but avoids creating a Date object\n        return (untyped Date).now();\n    }\n\n    public static function createEmptyCanvas (width :Int, height :Int) :CanvasElement\n    {\n        var canvas = Browser.document.createCanvasElement();\n        canvas.width = width;\n        canvas.height = height;\n        return canvas;\n    }\n\n    public static function createCanvas (source :CanvasElement) :CanvasElement\n    {\n        var canvas = createEmptyCanvas(source.width, source.height);\n\n        var ctx = canvas.getContext2d();\n        ctx.save();\n        ctx.globalCompositeOperation = \"copy\";\n        ctx.drawImage(source, 0, 0);\n        ctx.restore();\n\n        return canvas;\n    }\n\n    public static function detectSlowDriver (gl :RenderingContext) :Bool\n    {\n        // Try to detect SwiftShader. There will be some false positives here, but falling back to\n        // canvas in those cases is better than using WebGL on a software driver.\n        // http://stackoverflow.com/questions/10456491/detect-swiftshader-webgl-renderer-in-chrome-18\n        //\n        // TODO(bruno): Use http://www.khronos.org/registry/webgl/extensions/WEBGL_debug_renderer_info/\n\n        var windows = (Browser.navigator.platform.indexOf(\"Win\") >= 0);\n        if (windows) {\n            var chrome = ((untyped Browser.window).chrome != null);\n            if (chrome) {\n                for (ext in gl.getSupportedExtensions()) {\n                    if (ext.indexOf(\"WEBGL_compressed_texture\") >= 0) {\n                        return false;\n                    }\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n\n    public static function fixAndroidMath ()\n    {\n        // Some versions of V8 on ARM (like the one in the stock Android 4 browser) are affected by\n        // this nasty bug: https://code.google.com/p/v8/issues/detail?id=2234\n        //\n        // So, hack around it. This doesn't affect Android 2. Hopefully 5 will use an updated V8\n        // with the real fix.\n\n        if (Browser.navigator.userAgent.indexOf(\"Linux; U; Android 4\") >= 0) {\n            Log.warn(\"Monkey patching around Android sin/cos bug\");\n            var sin = Math.sin, cos = Math.cos;\n            (untyped Math).sin = function (x) {\n                return (x == 0) ? 0 : sin(x);\n            };\n            (untyped Math).cos = function (x) {\n                return (x == 0) ? 1 : cos(x);\n            }\n        }\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\npackage flambe.platform.html;\n\nimport flambe.subsystem.WebSystem;\nimport flambe.web.WebView;\n\nclass HtmlWeb implements WebSystem {\n\t@:expose public var stack(default, null):Array<WebView>;\n\n\tpublic function new() {\n\t\tthis.stack = [];\n\t}\n\n\tpublic function addView(comp:VueComponent, methods:Dynamic, props:Dynamic):WebView {\n\t\tvar def = js.Syntax.code(\"{extends: {0}, methods: {1}}\", comp.def, methods);\n\t\tvar view = new VueWebView(def, props, this.stack);\n\t\tthis.stack.push(view);\n\t\treturn view;\n\t}\n}\n\nclass VueWebView implements WebView {\n\tpublic var def(default, null):VueComponent;\n\tpublic var props(default, null):Dynamic;\n\n\tpublic function new(def:VueComponent, props:Dynamic, stack:Array<WebView>) {\n\t\tthis.def = def;\n\t\tthis.props = props;\n\t\tthis._stack = stack;\n\t}\n\n\tpublic function dispose() {\n\t\tthis._stack.remove(this);\n\t}\n\n\tprivate var _stack:Array<WebView>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport flambe.animation.AnimatedFloat;\nimport flambe.platform.Tickable;\nimport flambe.sound.Playback;\nimport flambe.sound.Sound;\nimport flambe.util.Disposable;\nimport flambe.util.Value;\n\nclass WebAudioSound extends BasicAsset<WebAudioSound>\n    implements Sound\n{\n    public static var supported (get, null) :Bool;\n\n    /**\n     * The shared AudioContext.\n     */\n    public static var ctx :Dynamic = null;\n\n    /**\n     * The shared gain node for global system volume.\n     */\n    public static var gain :Dynamic;\n\n    public var duration (get, null) :Float;\n\n    public var buffer :Dynamic;\n\n    public function new (buffer :Dynamic)\n    {\n        super();\n        this.buffer = buffer;\n    }\n\n    public function play (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new WebAudioPlayback(this, volume, false);\n    }\n\n    public function loop (volume :Float = 1.0) :Playback\n    {\n        assertNotDisposed();\n\n        return new WebAudioPlayback(this, volume, true);\n    }\n\n    public function get_duration () :Float\n    {\n        assertNotDisposed();\n\n        return buffer.duration;\n    }\n\n    override private function copyFrom (that :WebAudioSound)\n    {\n        this.buffer = that.buffer;\n    }\n\n    override private function onDisposed ()\n    {\n        buffer = null;\n    }\n\n    private static function get_supported () :Bool\n    {\n        if (_detectSupport) {\n            _detectSupport = false;\n\n            var AudioContext = HtmlUtil.loadExtension(\"AudioContext\").value;\n            if (AudioContext != null) {\n                ctx = js.Syntax.construct(AudioContext);\n                gain = createGain();\n                gain.connect(ctx.destination);\n\n                System.volume.watch(function(volume, _) {\n                    gain.gain.value = volume;\n                });\n            }\n        }\n\n        return ctx != null;\n    }\n\n    public static function createGain () :Dynamic\n    {\n        // Fall back to createGainNode used in iOS Safari\n        // https://developer.mozilla.org/en-US/docs/Web_Audio_API/Porting_webkitAudioContext_code_to_standards_based_AudioContext\n        return (ctx.createGain != null) ? ctx.createGain() : ctx.createGainNode();\n    }\n\n    public static function start (node :Dynamic, time :Float)\n    {\n        // Fall back to noteOn used in iOS Safari\n        if (node.start != null) {\n            node.start(time);\n        } else {\n            node.noteOn(time);\n        }\n    }\n\n    private static var _detectSupport = true;\n}\n\nprivate class WebAudioPlayback\n    implements Playback\n    implements Tickable\n{\n    public var volume (default, null) :AnimatedFloat;\n    public var paused (get, set) :Bool;\n    public var complete (get, null) :Value<Bool>;\n    public var position (get, null) :Float;\n    public var sound (get, null) :Sound;\n\n    public function new (sound :WebAudioSound, volume :Float, loop :Bool)\n    {\n        _sound = sound;\n        _head = WebAudioSound.gain;\n        _complete = new Value<Bool>(false);\n\n        _sourceNode = WebAudioSound.ctx.createBufferSource();\n        _sourceNode.buffer = sound.buffer;\n        _sourceNode.loop = loop;\n        _sourceNode.onended = function () _complete._ = true; // Not supported on iOS!\n        WebAudioSound.start(_sourceNode, 0);\n        playAudio();\n\n        this.volume = new AnimatedFloat(volume, function (v, _) {\n            setVolume(v);\n        });\n        if (volume != 1) {\n            setVolume(volume);\n        }\n\n        // Don't start playing until visible\n        if (System.hidden._) {\n            paused = true;\n        }\n    }\n\n    public function get_sound () :Sound\n    {\n        return _sound;\n    }\n\n    inline public function get_paused () :Bool\n    {\n        return _pausedAt >= 0;\n    }\n\n    public function set_paused (paused :Bool) :Bool\n    {\n        if (paused != get_paused()) {\n            if (paused) {\n                _sourceNode.disconnect();\n                _pausedAt = position;\n            } else {\n                playAudio();\n            }\n        }\n        return paused;\n    }\n\n    inline public function get_complete () :Value<Bool>\n    {\n        return _complete;\n    }\n\n    public function get_position () :Float\n    {\n        // Web Audio sure doesn't make this simple...\n        if (_complete._) {\n            return _sound.duration;\n\n        } else if (paused) {\n            return _pausedAt;\n\n        } else {\n            var elapsed = WebAudioSound.ctx.currentTime - _startedAt;\n            return elapsed % _sound.duration;\n        }\n    }\n\n    public function update (dt :Float) :Bool\n    {\n        volume.update(dt);\n\n        // playbackState is used in old browsers that don't support onended (iOS)\n        if (_sourceNode.playbackState == 3 /* FINISHED_STATE */) {\n            _complete._ = true;\n        }\n\n        if (_complete._ || paused) {\n            // Allow complete or paused sounds to be garbage collected\n            _tickableAdded = false;\n\n            // Release System references\n            _hideBinding.dispose();\n\n            return true;\n        }\n        return false;\n    }\n\n    public function dispose ()\n    {\n        paused = true;\n        _complete._ = true;\n    }\n\n    private function setVolume (volume :Float)\n    {\n        if (_gainNode == null) {\n            _gainNode = WebAudioSound.createGain();\n            insertNode(_gainNode);\n        }\n        _gainNode.gain.value = volume;\n    }\n\n    private function insertNode (head :Dynamic)\n    {\n        if (!paused) {\n            _sourceNode.disconnect();\n            _sourceNode.connect(head);\n        }\n        head.connect(_head);\n        _head = head;\n    }\n\n    private function playAudio ()\n    {\n        _sourceNode.connect(_head);\n        _startedAt = WebAudioSound.ctx.currentTime;\n        _pausedAt = -1;\n\n        if (!_tickableAdded) {\n            HtmlPlatform.instance.mainLoop.addTickable(this);\n            _tickableAdded = true;\n\n            // Claim System references\n            _hideBinding = System.hidden.changed.connect(function(hidden,_) {\n                if (hidden) {\n                    _wasPaused = get_paused();\n                    this.paused = true;\n                } else {\n                    this.paused = _wasPaused;\n                }\n            });\n        }\n    }\n\n    private var _sound :WebAudioSound;\n\n    private var _pausedAt :Float;\n    private var _startedAt :Float;\n    private var _wasPaused :Bool;\n\n    private var _sourceNode :Dynamic;\n    private var _gainNode :Dynamic;\n\n    // The first node of the output chain, not including the source node\n    private var _head :Dynamic;\n\n    private var _hideBinding :Disposable;\n    private var _tickableAdded :Bool;\n\n    private var _complete :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.lib.Uint16Array;\nimport js.html.webgl.GL;\nimport js.html.webgl.Buffer;\nimport js.html.webgl.Texture;\nimport js.lib.Float32Array;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.display.BlendMode;\nimport flambe.math.Rectangle;\nimport flambe.platform.shader.DrawPatternGL;\nimport flambe.platform.shader.DrawTextureGL;\nimport flambe.platform.shader.FillRectGL;\nimport flambe.platform.shader.ShaderGL;\n\n/**\n * Batches up geometry to glDrawElements and avoids redundant state changes. All GL state changes\n * MUST go through the batcher.\n */\nclass WebGLBatcher\n{\n    public var data (default, null) :Float32Array;\n\n    public function new (gl :RenderingContext)\n    {\n        _gl = gl;\n\n        gl.clearColor(0, 0, 0, 0);\n        gl.enable(GL.BLEND);\n        gl.pixelStorei(GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);\n\n        _vertexBuffer = gl.createBuffer();\n        gl.bindBuffer(GL.ARRAY_BUFFER, _vertexBuffer);\n\n        _quadIndexBuffer = gl.createBuffer();\n        gl.bindBuffer(GL.ELEMENT_ARRAY_BUFFER, _quadIndexBuffer);\n\n        _drawTextureShader = new DrawTextureGL(gl);\n        _drawPatternShader = new DrawPatternGL(gl);\n        _fillRectShader = new FillRectGL(gl);\n\n        resize(16);\n    }\n\n    public function resizeBackbuffer (width :Int, height :Int)\n    {\n        _gl.viewport(0, 0, width, height);\n        _backbufferWidth = width;\n        _backbufferHeight = height;\n    }\n\n    public function willRender ()\n    {\n#if flambe_transparent\n        _gl.clear(GL.COLOR_BUFFER_BIT);\n#end\n    }\n\n    public function didRender ()\n    {\n        flush();\n    }\n\n    /** Safely bind a texture. */\n    public function bindTexture (texture :Texture)\n    {\n        flush();\n        _lastTexture = null;\n        _currentTexture = null;\n\n        _gl.bindTexture(GL.TEXTURE_2D, texture);\n    }\n\n    /** Safely delete a texture. */\n    public function deleteTexture (texture :WebGLTextureRoot)\n    {\n        // If we have unflushed quads that use this texture, flush them now\n        if (_lastTexture != null && _lastTexture.root == texture) {\n            flush();\n            _lastTexture = null;\n            _currentTexture = null;\n        }\n\n        _gl.deleteTexture(texture.nativeTexture);\n    }\n\n    /** Safely bind a framebuffer. */\n    public function bindFramebuffer (texture :WebGLTextureRoot)\n    {\n        if (texture != _lastRenderTarget) {\n            flush();\n            bindRenderTarget(texture);\n        }\n    }\n\n    /** Safely delete a framebuffer. */\n    public function deleteFramebuffer (texture :WebGLTextureRoot)\n    {\n        // If we have unflushed quads that render to this texture, flush them now\n        if (texture == _lastRenderTarget) {\n            flush();\n            _lastRenderTarget = null;\n            _currentRenderTarget = null;\n        }\n\n        _gl.deleteFramebuffer(texture.framebuffer);\n    }\n\n    public function prepareDrawTexture (renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle, texture :WebGLTexture) :Int\n    {\n        if (texture != _lastTexture) {\n            flush();\n            _lastTexture = texture;\n        }\n        return prepareQuad(5, renderTarget, blendMode, scissor, _drawTextureShader);\n    }\n\n    public function prepareDrawPattern (renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle, texture :WebGLTexture) :Int\n    {\n        if (texture != _lastTexture) {\n            flush();\n            _lastTexture = texture;\n        }\n        return prepareQuad(5, renderTarget, blendMode, scissor, _drawPatternShader);\n    }\n\n    public function prepareFillRect (renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle) :Int\n    {\n        return prepareQuad(6, renderTarget, blendMode, scissor, _fillRectShader);\n    }\n\n    private function prepareQuad (elementsPerVertex :Int, renderTarget :WebGLTextureRoot,\n        blendMode :BlendMode, scissor :Rectangle, shader :ShaderGL) :Int\n    {\n        if (renderTarget != _lastRenderTarget) {\n            flush();\n            _lastRenderTarget = renderTarget;\n        }\n        if (blendMode != _lastBlendMode) {\n            flush();\n            _lastBlendMode = blendMode;\n        }\n        if (shader != _lastShader) {\n            flush();\n            _lastShader = shader;\n        }\n\n        // Handle changes to the scissor rectangle\n        if (scissor != null || _lastScissor != null) {\n            if (scissor == null || _lastScissor == null || !_lastScissor.equals(scissor)) {\n                flush();\n                _lastScissor = (scissor != null) ? scissor.clone(_lastScissor) : null;\n                _pendingSetScissor = true;\n            }\n        }\n\n        if (_quads >= _maxQuads) {\n            resize(2*_maxQuads);\n        }\n        ++_quads;\n\n        var offset = _dataOffset;\n        _dataOffset += 4*elementsPerVertex;\n        return offset;\n    }\n\n    private function flush ()\n    {\n        if (_quads < 1) {\n            return;\n        }\n\n        if (_lastRenderTarget != _currentRenderTarget) {\n            bindRenderTarget(_lastRenderTarget);\n        }\n\n        if (_lastBlendMode != _currentBlendMode) {\n            switch (_lastBlendMode) {\n                case Normal: _gl.blendFunc(GL.ONE, GL.ONE_MINUS_SRC_ALPHA);\n                case Add: _gl.blendFunc(GL.ONE, GL.ONE);\n                case Multiply: _gl.blendFunc(GL.DST_COLOR, GL.ONE_MINUS_SRC_ALPHA);\n                case Screen: _gl.blendFunc(GL.ONE, GL.ONE_MINUS_SRC_COLOR);\n                case Mask: _gl.blendFunc(GL.ZERO, GL.SRC_ALPHA);\n                case Copy: _gl.blendFunc(GL.ONE, GL.ZERO); // TODO(bruno): Disable blending entirely?\n            }\n            _currentBlendMode = _lastBlendMode;\n        }\n\n        if (_pendingSetScissor) {\n            if (_lastScissor != null) {\n                _gl.enable(GL.SCISSOR_TEST);\n                _gl.scissor(Std.int(_lastScissor.x), Std.int(_lastScissor.y),\n                    Std.int(_lastScissor.width), Std.int(_lastScissor.height));\n            } else {\n                _gl.disable(GL.SCISSOR_TEST);\n            }\n            _pendingSetScissor = false;\n        }\n\n        if (_lastTexture != _currentTexture) {\n            _gl.bindTexture(GL.TEXTURE_2D, _lastTexture.root.nativeTexture);\n            _currentTexture = _lastTexture;\n        }\n\n        if (_lastShader != _currentShader) {\n            _lastShader.useProgram();\n            _lastShader.prepare();\n            _currentShader = _lastShader;\n        }\n\n        if (_lastShader == _drawPatternShader) {\n            var texture = _lastTexture;\n            var root = texture.root;\n            _drawPatternShader.setRegion(\n                texture.rootX / root.width,\n                texture.rootY / root.height,\n                texture.width / root.width,\n                texture.height / root.height);\n        }\n\n        // _gl.bufferSubData(GL.ARRAY_BUFFER, 0, data.subarray(0, _dataOffset));\n        _gl.bufferData(GL.ARRAY_BUFFER, data.subarray(0, _dataOffset), GL.STREAM_DRAW);\n        _gl.drawElements(GL.TRIANGLES, 6*_quads, GL.UNSIGNED_SHORT, 0);\n\n        _quads = 0;\n        _dataOffset = 0;\n    }\n\n    private function resize (maxQuads :Int)\n    {\n        flush();\n        if (maxQuads > MAX_BATCH_QUADS) {\n            return; // That's big enough, return right after the flush\n        }\n\n        _maxQuads = maxQuads;\n\n        // Set the new vertex buffer size\n        data = new Float32Array(maxQuads*4*MAX_ELEMENTS_PER_VERTEX);\n        _gl.bufferData(GL.ARRAY_BUFFER,\n            data.length*Float32Array.BYTES_PER_ELEMENT, GL.STREAM_DRAW);\n\n        var indices = new Uint16Array(6*maxQuads);\n        for (ii in 0...maxQuads) {\n            indices[ii*6 + 0] = ii*4 + 0;\n            indices[ii*6 + 1] = ii*4 + 1;\n            indices[ii*6 + 2] = ii*4 + 2;\n            indices[ii*6 + 3] = ii*4 + 2;\n            indices[ii*6 + 4] = ii*4 + 3;\n            indices[ii*6 + 5] = ii*4 + 0;\n        }\n        _gl.bufferData(GL.ELEMENT_ARRAY_BUFFER, indices, GL.STATIC_DRAW);\n    }\n\n    private function bindRenderTarget (texture :WebGLTextureRoot)\n    {\n        // Bind the texture framebuffer, or the original backbuffer\n        if (texture != null) {\n            _gl.bindFramebuffer(GL.FRAMEBUFFER, texture.framebuffer);\n            _gl.viewport(0, 0, texture.width, texture.height);\n        } else {\n            _gl.bindFramebuffer(GL.FRAMEBUFFER, null);\n            _gl.viewport(0, 0, _backbufferWidth, _backbufferHeight);\n        }\n        _currentRenderTarget = texture;\n        _lastRenderTarget = texture;\n    }\n\n    private static inline var MAX_ELEMENTS_PER_VERTEX = 6;\n    private static inline var MAX_BATCH_QUADS = 1024;\n\n    private var _gl :RenderingContext;\n\n    // Used to keep track of context changes requiring a flush\n    private var _lastBlendMode :BlendMode = null;\n    private var _lastRenderTarget :WebGLTextureRoot = null;\n    private var _lastShader :ShaderGL = null;\n    private var _lastTexture :WebGLTexture = null;\n    private var _lastScissor :Rectangle = null;\n\n    // Used to avoid redundant GL calls\n    private var _currentBlendMode :BlendMode = null;\n    private var _currentShader :ShaderGL = null;\n    private var _currentTexture :WebGLTexture = null;\n    private var _currentRenderTarget :WebGLTextureRoot = null;\n    private var _pendingSetScissor :Bool = false;\n\n    private var _vertexBuffer :Buffer;\n    private var _quadIndexBuffer :Buffer;\n\n    private var _drawTextureShader :DrawTextureGL;\n    private var _drawPatternShader :DrawPatternGL;\n    private var _fillRectShader :FillRectGL;\n\n    private var _quads :Int = 0;\n    private var _maxQuads :Int = 0;\n    private var _dataOffset :Int = 0;\n\n    private var _backbufferWidth :Int = 0;\n    private var _backbufferHeight :Int = 0;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.lib.Float32Array;\nimport flambe.display.BlendMode;\nimport flambe.display.Graphics;\nimport flambe.display.Texture;\nimport flambe.math.FMath;\nimport flambe.math.Matrix;\nimport flambe.math.Rectangle;\nimport flambe.util.Assert;\n\nclass WebGLGraphics\n    implements InternalGraphics\n{\n    public function new (batcher :WebGLBatcher, renderTarget :WebGLTextureRoot)\n    {\n        // Initialize this here to prevent blowing up during static init on browsers without typed\n        // array support\n        if (_scratchQuadArray == null) {\n            _scratchQuadArray = new Float32Array(8);\n        }\n\n        _batcher = batcher;\n        _renderTarget = renderTarget;\n    }\n\n    public function save ()\n    {\n        var current = _stateList;\n        var state = _stateList.next;\n\n        if (state == null) {\n            // Grow the list\n            state = new DrawingState();\n            state.prev = current;\n            current.next = state;\n        }\n\n        current.matrix.clone(state.matrix);\n        state.alpha = current.alpha;\n        state.blendMode = current.blendMode;\n        state.scissor = (current.scissor != null) ? current.scissor.clone(state.scissor) : null;\n        _stateList = state;\n    }\n\n    public function translate (x :Float, y :Float)\n    {\n        var matrix = getTopState().matrix;\n        matrix.m02 += matrix.m00*x + matrix.m01*y;\n        matrix.m12 += matrix.m10*x + matrix.m11*y;\n    }\n\n    public function scale (x :Float, y :Float)\n    {\n        var matrix = getTopState().matrix;\n        matrix.m00 *= x;\n        matrix.m10 *= x;\n        matrix.m01 *= y;\n        matrix.m11 *= y;\n    }\n\n    public function rotate (rotation :Float)\n    {\n        var matrix = getTopState().matrix;\n        rotation = FMath.toRadians(rotation);\n        var sin = Math.sin(rotation);\n        var cos = Math.cos(rotation);\n        var m00 = matrix.m00;\n        var m10 = matrix.m10;\n        var m01 = matrix.m01;\n        var m11 = matrix.m11;\n\n        matrix.m00 = m00*cos + m01*sin;\n        matrix.m10 = m10*cos + m11*sin;\n        matrix.m01 = m01*cos - m00*sin;\n        matrix.m11 = m11*cos - m10*sin;\n    }\n\n    public function transform (m00 :Float, m10 :Float, m01 :Float, m11 :Float, m02 :Float, m12 :Float)\n    {\n        var state = getTopState();\n        _scratchMatrix.set(m00, m10, m01, m11, m02, m12);\n        Matrix.multiply(state.matrix, _scratchMatrix, state.matrix);\n    }\n\n    public function restore ()\n    {\n        Assert.that(_stateList.prev != null, \"Can't restore without a previous save\");\n        _stateList = _stateList.prev;\n    }\n\n    public function drawTexture (texture :Texture, x :Float, y :Float)\n    {\n        drawSubTexture(texture, x, y, 0, 0, texture.width, texture.height);\n    }\n\n    public function drawSubTexture (texture :Texture, destX :Float, destY :Float,\n        sourceX :Float, sourceY :Float, sourceW :Float, sourceH :Float)\n    {\n        var state = getTopState();\n        var texture :WebGLTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        var pos = transformQuad(destX, destY, sourceW, sourceH);\n        var rootWidth = root.width;\n        var rootHeight = root.height;\n        var u1 = (texture.rootX+sourceX) / rootWidth;\n        var v1 = (texture.rootY+sourceY) / rootHeight;\n        var u2 = u1 + sourceW/rootWidth;\n        var v2 = v1 + sourceH/rootHeight;\n        var alpha = state.alpha;\n\n        var offset = _batcher.prepareDrawTexture(_renderTarget, state.blendMode, state.scissor, texture);\n        var data = _batcher.data;\n\n        data[  offset] = pos[0];\n        data[++offset] = pos[1];\n        data[++offset] = u1;\n        data[++offset] = v1;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[2];\n        data[++offset] = pos[3];\n        data[++offset] = u2;\n        data[++offset] = v1;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[4];\n        data[++offset] = pos[5];\n        data[++offset] = u2;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[6];\n        data[++offset] = pos[7];\n        data[++offset] = u1;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n    }\n\n    public function drawPattern (texture :Texture, x :Float, y :Float, width :Float, height :Float)\n    {\n        var state = getTopState();\n        var texture :WebGLTexture = cast texture;\n        var root = texture.root;\n        root.assertNotDisposed();\n\n        var pos = transformQuad(x, y, width, height);\n        var u2 = width / root.width;\n        var v2 = height / root.height;\n        var alpha = state.alpha;\n\n        var offset = _batcher.prepareDrawPattern(_renderTarget, state.blendMode, state.scissor, texture);\n        var data = _batcher.data;\n\n        data[  offset] = pos[0];\n        data[++offset] = pos[1];\n        data[++offset] = 0;\n        data[++offset] = 0;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[2];\n        data[++offset] = pos[3];\n        data[++offset] = u2;\n        data[++offset] = 0;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[4];\n        data[++offset] = pos[5];\n        data[++offset] = u2;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n\n        data[++offset] = pos[6];\n        data[++offset] = pos[7];\n        data[++offset] = 0;\n        data[++offset] = v2;\n        data[++offset] = alpha;\n    }\n\n    public function fillRect (color :Int, x :Float, y :Float, width :Float, height :Float)\n    {\n        var state = getTopState();\n\n        var pos = transformQuad(x, y, width, height);\n        var r = (color & 0xff0000) / 0xff0000;\n        var g = (color & 0x00ff00) / 0x00ff00;\n        var b = (color & 0x0000ff) / 0x0000ff;\n        var a = state.alpha;\n\n        var offset = _batcher.prepareFillRect(_renderTarget, state.blendMode, state.scissor);\n        var data = _batcher.data;\n\n        data[  offset] = pos[0];\n        data[++offset] = pos[1];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n\n        data[++offset] = pos[2];\n        data[++offset] = pos[3];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n\n        data[++offset] = pos[4];\n        data[++offset] = pos[5];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n\n        data[++offset] = pos[6];\n        data[++offset] = pos[7];\n        data[++offset] = r;\n        data[++offset] = g;\n        data[++offset] = b;\n        data[++offset] = a;\n    }\n\n    public function multiplyAlpha (factor :Float)\n    {\n        getTopState().alpha *= factor;\n    }\n\n    public function setAlpha (alpha :Float)\n    {\n        getTopState().alpha = alpha;\n    }\n\n    public function setBlendMode (blendMode :BlendMode)\n    {\n        getTopState().blendMode = blendMode;\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        var state = getTopState();\n        var rect = _scratchQuadArray;\n        rect[0] = x;\n        rect[1] = y;\n        rect[2] = x + width;\n        rect[3] = y + height;\n\n        state.matrix.transformArray(cast rect, 4, cast rect);\n        _inverseProjection.transformArray(cast rect, 4, cast rect);\n\n        x = rect[0];\n        y = rect[1];\n        width = rect[2] - x;\n        height = rect[3] - y;\n\n        // Handle negative rectangles\n        if (width < 0) {\n            x += width;\n            width = -width;\n        }\n        if (height < 0) {\n            y += height;\n            height = -height;\n        }\n\n        state.applyScissor(x, y, width, height);\n    }\n\n    public function willRender ()\n    {\n        _batcher.willRender();\n    }\n\n    public function didRender ()\n    {\n        _batcher.didRender();\n    }\n\n    public function onResize (width :Int, height :Int)\n    {\n        _stateList = new DrawingState();\n\n        // Framebuffers need to be vertically flipped\n        var flip = (_renderTarget != null) ? -1 : 1;\n        _stateList.matrix.set(2/width, 0, 0, flip * -2/height, -1, flip);\n\n        // May be used to transform back into screen coordinates\n        _inverseProjection = new Matrix();\n        _inverseProjection.set(2/width, 0, 0, 2/height, -1, -1);\n        _inverseProjection.invert();\n    }\n\n    inline private function getTopState () :DrawingState\n    {\n        return _stateList;\n    }\n\n    private function transformQuad (x :Float, y :Float, width :Float, height :Float) :Float32Array\n    {\n        var x2 = x + width;\n        var y2 = y + height;\n        var pos = _scratchQuadArray;\n\n        pos[0] = x;\n        pos[1] = y;\n\n        pos[2] = x2;\n        pos[3] = y;\n\n        pos[4] = x2;\n        pos[5] = y2;\n\n        pos[6] = x;\n        pos[7] = y2;\n\n        getTopState().matrix.transformArray(cast pos, 8, cast pos);\n        return pos;\n    }\n\n    private static var _scratchMatrix = new Matrix();\n    private static var _scratchQuadArray :Float32Array = null;\n\n    private var _batcher :WebGLBatcher;\n    private var _renderTarget :WebGLTextureRoot;\n\n    private var _inverseProjection :Matrix = null;\n    private var _stateList :DrawingState = null;\n}\n\nprivate class DrawingState\n{\n    public var matrix :Matrix;\n    public var alpha :Float;\n    public var blendMode :BlendMode;\n    public var scissor :Rectangle = null;\n\n    public var prev :DrawingState = null;\n    public var next :DrawingState = null;\n\n    public function new ()\n    {\n        matrix = new Matrix();\n        alpha = 1;\n        blendMode = Normal;\n    }\n\n    public function applyScissor (x :Float, y :Float, width :Float, height :Float)\n    {\n        if (scissor != null) {\n            // Intersection with the previous scissor rectangle\n            var x1 = FMath.max(scissor.x, x);\n            var y1 = FMath.max(scissor.y, y);\n            var x2 = FMath.min(scissor.x + scissor.width, x + width);\n            var y2 = FMath.min(scissor.y + scissor.height, y + height);\n            x = x1;\n            y = y1;\n            width = x2 - x1;\n            height = y2 - y1;\n        } else {\n            scissor = new Rectangle();\n        }\n        scissor.set(Math.round(x), Math.round(y), Math.round(width), Math.round(height));\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.html.webgl.*;\n\nimport haxe.io.Bytes;\n\nimport flambe.asset.AssetEntry;\nimport flambe.subsystem.RendererSystem;\nimport flambe.util.Assert;\nimport flambe.util.Value;\n\nclass WebGLRenderer\n    implements InternalRenderer<Dynamic>\n{\n    public var type (get, null) :RendererType;\n    public var maxTextureSize (get, null) :Int;\n    public var hasGPU (get, null) :Value<Bool>;\n\n    public var graphics :InternalGraphics;\n\n    public var gl (default, null) :RenderingContext;\n    public var batcher (default, null) :WebGLBatcher;\n\n    public function new (stage :HtmlStage, gl :RenderingContext)\n    {\n        _hasGPU = new Value<Bool>(true);\n        this.gl = gl;\n\n        // Handle GL context loss\n        gl.canvas.addEventListener(\"webglcontextlost\", function (event) {\n            event.preventDefault();\n            Log.warn(\"WebGL context lost\");\n            _hasGPU._ = false;\n        }, false);\n        gl.canvas.addEventListener(\"webglcontextrestore\", function (event) {\n            Log.warn(\"WebGL context restored\");\n            init();\n            _hasGPU._ = true;\n        }, false);\n\n        stage.resize.connect(onResize);\n        init();\n    }\n\n    inline private function get_type () :RendererType\n    {\n        return WebGL;\n    }\n\n    private function get_maxTextureSize () :Int\n    {\n        return gl.getParameter(GL.MAX_TEXTURE_SIZE);\n    }\n\n    inline private function get_hasGPU () :Value<Bool>\n    {\n        return _hasGPU;\n    }\n\n    public function createTextureFromImage (image :Dynamic) :WebGLTexture\n    {\n        if (gl.isContextLost()) {\n            return null;\n        }\n        var root = new WebGLTextureRoot(this, image.width, image.height);\n        root.uploadImageData(image);\n        return root.createTexture(image.width, image.height);\n    }\n\n    public function createTexture (width :Int, height :Int) :WebGLTexture\n    {\n        if (gl.isContextLost()) {\n            return null;\n        }\n        var root = new WebGLTextureRoot(this, width, height);\n        root.clear();\n        return root.createTexture(width, height);\n    }\n\n    public function getCompressedTextureFormats () :Array<AssetFormat>\n    {\n        // TODO(bruno): Detect supported texture extensions\n        return [];\n    }\n\n    public function createCompressedTexture (format :AssetFormat, data :Bytes) :WebGLTexture\n    {\n        if (gl.isContextLost()) {\n            return null;\n        }\n        Assert.fail(); // Unsupported\n        return null;\n    }\n\n    public function willRender ()\n    {\n        graphics.willRender();\n    }\n\n    public function didRender ()\n    {\n        graphics.didRender();\n    }\n\n    private function onResize ()\n    {\n        var width = gl.canvas.width, height = gl.canvas.height;\n        batcher.resizeBackbuffer(width, height);\n        graphics.onResize(width, height);\n    }\n\n    private function init ()\n    {\n        batcher = new WebGLBatcher(gl);\n        graphics = new WebGLGraphics(batcher, null);\n        onResize();\n    }\n\n    private var _hasGPU :Value<Bool>;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nclass WebGLTexture extends BasicTexture<WebGLTextureRoot>\n{\n    public function new (root :WebGLTextureRoot, width :Int, height :Int)\n    {\n        super(root, width, height);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.html;\n\nimport js.lib.Uint8Array;\nimport js.html.webgl.GL;\nimport js.html.CanvasElement;\nimport js.html.webgl.Framebuffer;\nimport haxe.io.Bytes;\n\nimport flambe.math.FMath;\nimport flambe.platform.MathUtil;\n\nclass WebGLTextureRoot extends BasicAsset<WebGLTextureRoot>\n    implements TextureRoot\n{\n    // The power of two dimensions of the texture\n    public var width (default, null) :Int;\n    public var height (default, null) :Int;\n\n    public var nativeTexture (default, null) :js.html.webgl.Texture;\n    public var framebuffer :Framebuffer = null;\n\n    public function new (renderer :WebGLRenderer, width :Int, height :Int)\n    {\n        super();\n        _renderer = renderer;\n        // 1 px textures cause weird DrawPattern sampling on some drivers\n        this.width = FMath.max(2, MathUtil.nextPowerOfTwo(width));\n        this.height = FMath.max(2, MathUtil.nextPowerOfTwo(height));\n\n        var gl = renderer.gl;\n        nativeTexture = gl.createTexture();\n        renderer.batcher.bindTexture(nativeTexture);\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_WRAP_S, GL.CLAMP_TO_EDGE);\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_WRAP_T, GL.CLAMP_TO_EDGE);\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MAG_FILTER, GL.LINEAR);\n    #if flambe_webgl_enable_mipmapping\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.LINEAR_MIPMAP_NEAREST);\n    #elseif flambe_webgl_enable_linear\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.LINEAR);\n    #else\n        gl.texParameteri(GL.TEXTURE_2D, GL.TEXTURE_MIN_FILTER, GL.NEAREST);\n    #end\n    }\n\n    public function createTexture (width :Int, height :Int) :WebGLTexture\n    {\n        return new WebGLTexture(this, width, height);\n    }\n\n    public function uploadImageData (image :Dynamic)\n    {\n        assertNotDisposed();\n\n        if (width != image.width || height != image.height) {\n            // Resize up to the next power of two, padding with transparent black\n            var resized = HtmlUtil.createEmptyCanvas(width, height);\n            resized.getContext2d().drawImage(image, 0, 0);\n            drawBorder(resized, image.width, image.height);\n            image = resized;\n        }\n\n        _renderer.batcher.bindTexture(nativeTexture);\n        var gl = _renderer.gl;\n        gl.texImage2D(GL.TEXTURE_2D, 0, GL.RGBA, GL.RGBA, GL.UNSIGNED_BYTE, image);\n    #if flambe_webgl_enable_mipmapping\n        gl.generateMipmap(GL.TEXTURE_2D);\n    #end\n    }\n\n    public function clear ()\n    {\n        assertNotDisposed();\n\n        _renderer.batcher.bindTexture(nativeTexture);\n        var gl = _renderer.gl;\n        gl.texImage2D(GL.TEXTURE_2D, 0, GL.RGBA, width, height, 0, GL.RGBA, GL.UNSIGNED_BYTE, null);\n    #if flambe_webgl_enable_mipmapping\n        gl.generateMipmap(GL.TEXTURE_2D);\n    #end\n    }\n\n    public function readPixels (x :Int, y :Int, width :Int, height :Int) :Bytes\n    {\n        assertNotDisposed();\n\n        getGraphics(); // Ensure we have a framebuffer\n        _renderer.batcher.bindFramebuffer(this);\n\n        var pixels = new Uint8Array(4*width*height);\n        var gl = _renderer.gl;\n        gl.readPixels(x, y, width, height, GL.RGBA, GL.UNSIGNED_BYTE, pixels);\n\n        // Undo alpha premultiplication. This is lossy!\n        var ii = 0, ll = pixels.length;\n        while (ii < ll) {\n            var invAlpha = 255 / pixels[ii+3];\n            pixels[ii] = cast pixels[ii] * invAlpha;\n            ++ii;\n            pixels[ii] = cast pixels[ii] * invAlpha;\n            ++ii;\n            pixels[ii] = cast pixels[ii] * invAlpha;\n            ii += 2; // Advance to next pixel\n        }\n\n        return Bytes.ofData(cast pixels);\n    }\n\n    public function writePixels (pixels :Bytes, x :Int, y :Int, sourceW :Int, sourceH :Int)\n    {\n        assertNotDisposed();\n\n        _renderer.batcher.bindTexture(nativeTexture);\n\n        // Can't update a texture used by a bound framebuffer apparently\n        _renderer.batcher.bindFramebuffer(null);\n\n        var gl = _renderer.gl;\n        // TODO(bruno): Avoid the redundant Uint8Array copy\n        gl.texSubImage2D(GL.TEXTURE_2D, 0, x, y, sourceW, sourceH,\n            GL.RGBA, GL.UNSIGNED_BYTE, new Uint8Array(pixels.getData()));\n    }\n\n    public function getGraphics () :WebGLGraphics\n    {\n        assertNotDisposed();\n\n        if (_graphics == null) {\n            _graphics = new WebGLGraphics(_renderer.batcher, this);\n            _graphics.onResize(width, height);\n\n            var gl = _renderer.gl;\n            framebuffer = gl.createFramebuffer();\n            _renderer.batcher.bindFramebuffer(this);\n            gl.framebufferTexture2D(GL.FRAMEBUFFER, GL.COLOR_ATTACHMENT0,\n                GL.TEXTURE_2D, nativeTexture, 0);\n        }\n        return _graphics;\n    }\n\n    override private function copyFrom (that :WebGLTextureRoot)\n    {\n        this.nativeTexture = that.nativeTexture;\n        this.framebuffer = that.framebuffer;\n        this.width = that.width;\n        this.height = that.height;\n        this._graphics = that._graphics;\n    }\n\n    override private function onDisposed ()\n    {\n        var batcher = _renderer.batcher;\n        batcher.deleteTexture(this);\n        if (framebuffer != null) {\n            batcher.deleteFramebuffer(this);\n        }\n\n        nativeTexture = null;\n        framebuffer = null;\n        _graphics = null;\n    }\n\n    /**\n     * Extends the right and bottom edge pixels of a bitmap. This is to prevent artifacts caused by\n     * sampling the outer transparency when the edge pixels are sampled.\n     */\n    private static function drawBorder (canvas :CanvasElement, width :Int, height :Int)\n    {\n        var ctx = canvas.getContext2d();\n\n        // Right edge\n        ctx.drawImage(canvas, width-1, 0, 1, height, width, 0, 1, height);\n\n        // Bottom edge\n        ctx.drawImage(canvas, 0, height-1, width, 1, 0, height, width, 1);\n\n        // Is a one pixel border enough?\n    }\n\n    private var _renderer :WebGLRenderer;\n    private var _graphics :WebGLGraphics = null;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.*;\nimport js.html.webgl.*;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.util.Assert;\n\n/**\n * Since there's no HxSL GLSL compiler (yet?), all GL shaders extend this.\n */\nclass ShaderGL\n{\n    public function new (gl :RenderingContext, vertSource :String, fragSource :String)\n    {\n        // Prepend the required precision rigamarole\n        fragSource = [\n            \"#ifdef GL_ES\",\n                \"precision mediump float;\",\n            \"#endif\",\n        ].join(\"\\n\") + \"\\n\" + fragSource;\n\n        _gl = gl;\n        _program = gl.createProgram();\n        gl.attachShader(_program, createShader(gl, GL.VERTEX_SHADER, vertSource));\n        gl.attachShader(_program, createShader(gl, GL.FRAGMENT_SHADER, fragSource));\n        gl.linkProgram(_program);\n        gl.useProgram(_program);\n\n#if debug\n        if (!gl.getProgramParameter(_program, GL.LINK_STATUS)) {\n            Log.error(\"Error linking shader program\", [\"log\", gl.getProgramInfoLog(_program)]);\n        }\n#end\n    }\n\n    public function useProgram ()\n    {\n        _gl.useProgram(_program);\n    }\n\n    public function prepare ()\n    {\n        Assert.fail(\"abstract\");\n    }\n\n    private function getAttribLocation (name :String) :Int\n    {\n        var loc = _gl.getAttribLocation(_program, name);\n        Assert.that(loc >= 0, \"Missing attribute\", [\"name\", name]);\n        return loc;\n    }\n\n    private function getUniformLocation (name :String) :UniformLocation\n    {\n        var loc = _gl.getUniformLocation(_program, name);\n        Assert.that(loc != null, \"Missing uniform\", [\"name\", name]);\n        return loc;\n    }\n\n    private static function createShader (gl :RenderingContext, type :Int, source :String) :Shader\n    {\n        var shader = gl.createShader(type);\n        gl.shaderSource(shader, source);\n        gl.compileShader(shader);\n\n#if debug\n        if (!gl.getShaderParameter(shader, GL.COMPILE_STATUS)) {\n            var typeName = (type == GL.VERTEX_SHADER) ? \"vertex\" : \"fragment\";\n            Log.error(\"Error compiling \" + typeName + \" shader\", [\n                \"log\", gl.getShaderInfoLog(shader)]);\n        }\n#end\n        return shader;\n    }\n\n    private var _gl :RenderingContext;\n    private var _program :Program;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.webgl.GL;\nimport js.lib.Float32Array;\nimport js.html.webgl.UniformLocation;\nimport js.html.webgl.RenderingContext;\nimport flambe.platform.html.WebGLTexture;\n\nclass DrawPatternGL extends ShaderGL\n{\n    public function new (gl :RenderingContext)\n    {\n        super(gl,\n        [ // Vertex shader\n            \"attribute highp vec2 a_pos;\",\n            \"attribute mediump vec2 a_uv;\",\n            \"attribute lowp float a_alpha;\",\n\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"void main (void) {\",\n                \"v_uv = a_uv;\",\n                \"v_alpha = a_alpha;\",\n                \"gl_Position = vec4(a_pos, 0, 1);\",\n            \"}\",\n        ].join(\"\\n\"),\n\n        [ // Fragment shader\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"uniform lowp sampler2D u_texture;\",\n            \"uniform mediump vec4 u_region;\",\n\n            \"void main (void) {\",\n                \"gl_FragColor = texture2D(u_texture, u_region.xy + mod(v_uv, u_region.zw)) * v_alpha;\",\n            \"}\",\n        ].join(\"\\n\"));\n\n        a_pos = getAttribLocation(\"a_pos\");\n        a_uv = getAttribLocation(\"a_uv\");\n        a_alpha = getAttribLocation(\"a_alpha\");\n\n        u_texture = getUniformLocation(\"u_texture\");\n        u_region = getUniformLocation(\"u_region\");\n        setTexture(0);\n    }\n\n    public function setTexture (unit :Int)\n    {\n        _gl.uniform1i(u_texture, unit);\n    }\n\n    public function setRegion (x :Float, y :Float, width :Float, height :Float)\n    {\n        _gl.uniform4f(u_region, x, y, width, height);\n    }\n\n    override public function prepare ()\n    {\n        _gl.enableVertexAttribArray(a_pos);\n        _gl.enableVertexAttribArray(a_uv);\n        _gl.enableVertexAttribArray(a_alpha);\n\n        var bytesPerFloat = Float32Array.BYTES_PER_ELEMENT;\n        var stride = 5*bytesPerFloat;\n        _gl.vertexAttribPointer(a_pos, 2, GL.FLOAT, false, stride, 0*bytesPerFloat);\n        _gl.vertexAttribPointer(a_uv, 2, GL.FLOAT, false, stride, 2*bytesPerFloat);\n        _gl.vertexAttribPointer(a_alpha, 1, GL.FLOAT, false, stride, 4*bytesPerFloat);\n    }\n\n    private var a_pos :Int;\n    private var a_uv :Int;\n    private var a_alpha :Int;\n\n    private var u_texture :UniformLocation;\n    private var u_region :UniformLocation;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.webgl.GL;\nimport js.lib.Float32Array;\nimport js.html.webgl.UniformLocation;\nimport js.html.webgl.RenderingContext;\n\nimport flambe.platform.html.WebGLTexture;\n\nclass DrawTextureGL extends ShaderGL\n{\n    public function new (gl :RenderingContext)\n    {\n        super(gl,\n        [ // Vertex shader\n            \"attribute highp vec2 a_pos;\",\n            \"attribute mediump vec2 a_uv;\",\n            \"attribute lowp float a_alpha;\",\n\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"void main (void) {\",\n                \"v_uv = a_uv;\",\n                \"v_alpha = a_alpha;\",\n                \"gl_Position = vec4(a_pos, 0, 1);\",\n            \"}\",\n        ].join(\"\\n\"),\n\n        [ // Fragment shader\n            \"varying mediump vec2 v_uv;\",\n            \"varying lowp float v_alpha;\",\n\n            \"uniform lowp sampler2D u_texture;\",\n\n            \"void main (void) {\",\n                \"gl_FragColor = texture2D(u_texture, v_uv) * v_alpha;\",\n            \"}\",\n        ].join(\"\\n\"));\n\n        a_pos = getAttribLocation(\"a_pos\");\n        a_uv = getAttribLocation(\"a_uv\");\n        a_alpha = getAttribLocation(\"a_alpha\");\n\n        u_texture = getUniformLocation(\"u_texture\");\n        setTexture(0);\n    }\n\n    public function setTexture (unit :Int)\n    {\n        _gl.uniform1i(u_texture, unit);\n    }\n\n    override public function prepare ()\n    {\n        _gl.enableVertexAttribArray(a_pos);\n        _gl.enableVertexAttribArray(a_uv);\n        _gl.enableVertexAttribArray(a_alpha);\n\n        var bytesPerFloat = Float32Array.BYTES_PER_ELEMENT;\n        var stride = 5*bytesPerFloat;\n        _gl.vertexAttribPointer(a_pos, 2, GL.FLOAT, false, stride, 0*bytesPerFloat);\n        _gl.vertexAttribPointer(a_uv, 2, GL.FLOAT, false, stride, 2*bytesPerFloat);\n        _gl.vertexAttribPointer(a_alpha, 1, GL.FLOAT, false, stride, 4*bytesPerFloat);\n    }\n\n    private var a_pos :Int;\n    private var a_uv :Int;\n    private var a_alpha :Int;\n\n    private var u_texture :UniformLocation;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform.shader;\n\nimport js.html.webgl.GL;\nimport js.lib.Float32Array;\nimport js.html.webgl.RenderingContext;\n\nclass FillRectGL extends ShaderGL\n{\n    public function new (gl :RenderingContext)\n    {\n        super(gl,\n        [ // Vertex shader\n            \"attribute highp vec2 a_pos;\",\n            \"attribute lowp vec3 a_rgb;\",\n            \"attribute lowp float a_alpha;\",\n\n            \"varying lowp vec4 v_color;\",\n\n            \"void main (void) {\",\n                \"v_color = vec4(a_rgb*a_alpha, a_alpha);\",\n                \"gl_Position = vec4(a_pos, 0, 1);\",\n            \"}\",\n        ].join(\"\\n\"),\n\n        [ // Fragment shader\n            \"varying lowp vec4 v_color;\",\n\n            \"void main (void) {\",\n                \"gl_FragColor = v_color;\",\n            \"}\",\n        ].join(\"\\n\"));\n\n        a_pos = getAttribLocation(\"a_pos\");\n        a_rgb = getAttribLocation(\"a_rgb\");\n        a_alpha = getAttribLocation(\"a_alpha\");\n    }\n\n    override public function prepare ()\n    {\n        _gl.enableVertexAttribArray(a_pos);\n        _gl.enableVertexAttribArray(a_rgb);\n        _gl.enableVertexAttribArray(a_alpha);\n\n        var bytesPerFloat = Float32Array.BYTES_PER_ELEMENT;\n        var stride = 6*bytesPerFloat;\n        _gl.vertexAttribPointer(a_pos, 2, GL.FLOAT, false, stride, 0*bytesPerFloat);\n        _gl.vertexAttribPointer(a_rgb, 3, GL.FLOAT, false, stride, 2*bytesPerFloat);\n        _gl.vertexAttribPointer(a_alpha, 1, GL.FLOAT, false, stride, 5*bytesPerFloat);\n    }\n\n    private var a_pos :Int;\n    private var a_rgb :Int;\n    private var a_alpha :Int;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.scene;\n\nimport flambe.Component;\n\n/**\n * Manages a stack of scenes. Only the front-most scene receives game updates.\n */\n// TODO(bruno): Major robustness cleanup and testing needed here\nclass Director extends Component\n{\n    /** The front-most scene. */\n    public var topScene (get, null) :Entity;\n\n    /** The complete list of scenes managed by this director, from back to front. */\n    public var scenes (default, null) :Array<Entity>;\n\n    /**\n     * The scenes that are partially occluded by a transparent or transitioning scene, from back to\n     * front. These scenes are not updated, but they're still drawn.\n     */\n    public var occludedScenes (default, null) :Array<Entity>;\n\n    /** Whether the director is currently transitioning between scenes. */\n    public var transitioning (get, null) :Bool;\n\n    /** The ideal width of the director's scenes. Used by some transitions. */\n    public var width (get, null) :Float;\n\n    /** The ideal height of the director's scenes. Used by some transitions. */\n    public var height (get, null) :Float;\n\n    public function new ()\n    {\n        scenes = [];\n        occludedScenes = [];\n        _root = new Entity();\n    }\n\n    /**\n     * Sets the ideal size of the scenes in this director. By default, the size is the full stage\n     * width and height. This size is used by some transitions, such as SlideTransition.\n     */\n    public function setSize (width :Float, height :Float) :Director\n    {\n        _width = width;\n        _height = height;\n        return this;\n    }\n\n    public function pushScene (scene :Entity, ?transition :Transition)\n    {\n        completeTransition();\n\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            playTransition(oldTop, scene, transition, function () {\n                hide(oldTop);\n            });\n        } else {\n            add(scene);\n            invalidateVisibility();\n        }\n    }\n\n    public function popScene (?transition :Transition)\n    {\n        completeTransition();\n\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            scenes.pop(); // Pop oldTop\n            var newTop = get_topScene();\n            if (newTop != null) {\n                playTransition(oldTop, newTop, transition, function () {\n                    hideAndDispose(oldTop);\n                });\n            } else {\n                hideAndDispose(oldTop);\n                invalidateVisibility();\n            }\n        }\n    }\n\n    /**\n     * Pops the scene stack until the given entity is the top scene, or adds the scene if the stack\n     * becomes empty while popping.\n     */\n    public function unwindToScene (scene :Entity, ?transition :Transition)\n    {\n        completeTransition();\n\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            if (oldTop == scene) {\n                return; // We're already there\n            }\n\n            scenes.pop(); // Pop oldTop\n            while (scenes.length > 0 && scenes[scenes.length-1] != scene) {\n                scenes.pop().dispose(); // Don't emit a hide, just dispose them\n            }\n\n            playTransition(oldTop, scene, transition, function () {\n                hideAndDispose(oldTop);\n            });\n\n        } else {\n            pushScene(scene, transition);\n        }\n    }\n\n    override public function onAdded ()\n    {\n        owner.addChild(_root);\n    }\n\n    override public function onRemoved ()\n    {\n        completeTransition();\n\n        for (scene in scenes) {\n            scene.dispose();\n        }\n        scenes = [];\n        occludedScenes = [];\n\n        _root.dispose();\n    }\n\n    override public function onUpdate (dt :Float)\n    {\n        if (_transitor != null && _transitor.update(dt)) {\n            completeTransition();\n        }\n    }\n\n    private function get_topScene () :Entity\n    {\n        var ll = scenes.length;\n        return (ll > 0) ? scenes[ll-1] : null;\n    }\n\n    inline private function get_transitioning () :Bool\n    {\n        return _transitor != null;\n    }\n\n    private function add (scene :Entity)\n    {\n        var oldTop = get_topScene();\n        if (oldTop != null) {\n            _root.removeChild(oldTop);\n        }\n\n        scenes.remove(scene);\n        scenes.push(scene);\n        _root.addChild(scene);\n    }\n\n    private function hide (scene :Entity)\n    {\n        var events = scene.get(Scene);\n        if (events != null) {\n            events.hidden.emit();\n        }\n    }\n\n    private function hideAndDispose (scene :Entity)\n    {\n        hide(scene);\n        scene.dispose();\n    }\n\n    private function show (scene :Entity)\n    {\n        var events = scene.get(Scene);\n        if (events != null) {\n            events.shown.emit();\n        }\n    }\n\n    private function invalidateVisibility ()\n    {\n        // Find the last index of an opaque scene, or 0\n        var ii = scenes.length;\n        while (ii > 0) {\n            var scene = scenes[--ii];\n            var comp = scene.get(Scene);\n            if (comp == null || comp.opaque) {\n                break;\n            }\n        }\n\n        // All visible scenes up to, but not including, the top scene\n        occludedScenes = (scenes.length > 0) ? scenes.slice(ii, scenes.length-1) : [];\n\n        // Notify the new top scene that it's being shown\n        var scene = get_topScene();\n        if (scene != null) {\n            show(scene);\n        }\n    }\n\n    // Notes:\n    // - Any method that modifies the scene stack should immediately call completeTransition.\n    private function completeTransition ()\n    {\n        if (_transitor != null) {\n            _transitor.complete();\n            _transitor = null;\n\n            invalidateVisibility();\n        }\n    }\n\n    private function playTransition (from :Entity, to :Entity,\n        transition :Transition, onComplete :Void->Void)\n    {\n        completeTransition();\n        add(to);\n\n        if (transition != null) {\n            occludedScenes.push(from);\n\n            _transitor = new Transitor(from, to, transition, onComplete);\n            _transitor.init(this);\n        } else {\n            onComplete();\n            invalidateVisibility();\n        }\n    }\n\n    private function get_width () :Float\n    {\n        return (_width < 0) ? System.stage.width : _width;\n    }\n\n    private function get_height () :Float\n    {\n        return (_height < 0) ? System.stage.height : _height;\n    }\n\n    /** The container for the current scene. */\n    private var _root :Entity;\n\n    private var _transitor :Transitor = null;\n    private var _width :Float = -1;\n    private var _height :Float = -1;\n}\n\nprivate class Transitor\n{\n    public function new (from :Entity, to :Entity, transition :Transition, onComplete :Void->Void)\n    {\n        _from = from;\n        _to = to;\n        _transition = transition;\n        _onComplete = onComplete;\n    }\n\n    public function init (director :Director)\n    {\n        _transition.init(director, _from, _to);\n    }\n\n    public function update (dt :Float) :Bool\n    {\n        return _transition.update(dt);\n    }\n\n    public function complete ()\n    {\n        _transition.complete();\n        _onComplete();\n    }\n\n    private var _from :Entity;\n    private var _to :Entity;\n    private var _transition :Transition;\n\n    private var _onComplete :Void->Void;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.scene;\n\nimport flambe.Component;\nimport flambe.util.Signal0;\n\n/**\n * Optional, extra functionality for scene entities that are added to a Director.\n */\nclass Scene extends Component\n{\n    /** Emitted by the Director when this scene becomes the top scene. */\n    public var shown (default, null) :Signal0;\n\n    /** Emitted by the Director when this scene is no longer the top scene. */\n    public var hidden (default, null) :Signal0;\n\n    /**\n     * When true, hints that scenes below this one don't need to be rendered. Scenes that don't fill\n     * the entire stage or have a transparent background should set this to false.\n     */\n    public var opaque (default, null) :Bool;\n\n    public function new (opaque :Bool = true)\n    {\n        this.opaque = opaque;\n        shown = new Signal0();\n        hidden = new Signal0();\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.scene;\n\n/**\n * A transition between two scenes.\n */\nclass Transition\n{\n    /**\n     * Called by the Director to start the transition.\n     * @param director The director that requested the transition.\n     * @param from The old scene being transitioned from.\n     * @param to The new scene being transitioned to.\n     */\n    public function init (director :Director, from :Entity, to :Entity)\n    {\n        _director = director;\n        _from = from;\n        _to = to;\n    }\n\n    /**\n     * Called by the Director to update the transition.\n     * @returns True if the transition is complete.\n     */\n    public function update (dt :Float) :Bool\n    {\n        // See subclasses\n        return true;\n    }\n\n    /**\n     * Completes the transition. Note that the Director may call this at any time to fast-forward\n     * the transition.\n     */\n    public function complete ()\n    {\n        // See subclasses\n    }\n\n    private var _director :Director;\n    private var _from :Entity;\n    private var _to :Entity;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\nusing flambe.util.Strings;\n\n/**\n * Simple runtime assertions. A failed assertion throws an error, which should NOT be caught and\n * handled. Assertions are stripped from release builds, unless the -D flambe_keep_asserts compiler\n * flag is used.\n */\nclass Assert\n{\n#if (debug || flambe_keep_asserts)\n    /**\n     * Asserts that a condition is true.\n     * @param message If this assertion fails, the message to include in the thrown error.\n     * @param fields Optional fields to be formatted with the message, see Strings.withFields.\n     */\n    public static function that (condition :Bool, ?message :String, ?fields :Array<Dynamic>)\n    {\n        if (!condition) {\n            fail(message, fields);\n        }\n    }\n\n    /**\n     * Immediately fails an assertion. Same as Assert.that(false).\n     * @param message The message to include in the thrown error.\n     * @param fields Optional fields to be formatted with the message, see Strings.withFields.\n     */\n    public static function fail (?message :String, ?fields :Array<Dynamic>)\n    {\n        var error = \"Assertion failed!\";\n        if (message != null) {\n            error += \" \" + message;\n        }\n        if (fields != null) {\n            error = error.withFields(fields);\n        }\n        throw error;\n    }\n\n#else\n    // In release builds, assertions are stripped out\n    inline public static function that (condition :Bool, ?message :String, ?fields :Array<Dynamic>) {}\n    inline public static function fail (?message :String, ?fields :Array<Dynamic>) {}\n#end\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Utility mixins for bit sets. Designed to be imported with 'using' to supplement regular Ints with\n * bitset functions.\n */\nclass BitSets\n{\n    /**\n     * Adds all the bits included in the mask, and returns the new bitset.\n     */\n    inline public static function add (bits :Int, mask :Int) :Int\n    {\n        return bits | mask;\n    }\n\n    /**\n     * Removes all the bits included in the mask, and returns the new bitset.\n     */\n    inline public static function remove (bits :Int, mask :Int) :Int\n    {\n        return bits & ~mask;\n    }\n\n    /**\n     * Toggles all the bits included in the mask, and returns the new bitset.\n     */\n    inline public static function toggle (bits :Int, mask :Int) :Int\n    {\n        return bits ^ mask;\n    }\n\n    /**\n     * Returns true if the bitset contains ANY of the bits in the given mask.\n     */\n    inline public static function contains (bits :Int, mask :Int) :Bool\n    {\n        return bits & mask != 0;\n    }\n\n    /**\n     * Returns true if the bitset contains ALL of the bits in the given mask.\n     */\n    inline public static function containsAll (bits :Int, mask :Int) :Bool\n    {\n        return bits & mask == mask;\n    }\n\n    /**\n     * Either adds or removes all the bits included in the mask, and returns the new bitset.\n     */\n    public static function set (bits :Int, mask :Int, enabled :Bool) :Int\n    {\n        return enabled ? add(bits, mask) : remove(bits, mask);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * Represents a value that isn't ready yet, but may become available in the future.\n */\nclass Promise<A>\n{\n    /**\n     * The end result fulfilled by the promise. When accessing, throws an error if the result is not\n     * yet available. Read hasResult to check availability first, or use get(). When setting, throws\n     * an error if the result was already previously assigned.\n     */\n    public var result (get, set) :A;\n\n    /**\n     * Whether the result is available yet.\n     */\n    public var hasResult (default, null) :Bool;\n\n    /**\n     * Emitted when the promise is fulfilled and the result has become available.\n     */\n    public var success (default, null) :Signal1<A>;\n\n    /**\n     * An error message emitted if there was a problem during loading.\n     */\n    public var error (default, null) :Signal1<String>;\n\n    /**\n     * May be emitted during loading when the progress or total counts have been updated.\n     */\n    public var progressChanged (default, null) :Signal0;\n\n    /**\n     * Context on how close this promise is to being fulfilled. For file IO, these are in bytes.\n     */\n    public var progress (get, set) :Float;\n    public var total (get, set) :Float;\n\n    public function new ()\n    {\n        success = new Signal1();\n        error = new Signal1();\n        progressChanged = new Signal0();\n        hasResult = false;\n        _progress = 0;\n        _total = 0;\n    }\n\n    private function get_result () :A\n    {\n        if (!hasResult) {\n            throw \"Promise result not yet available\";\n        }\n        return _result;\n    }\n\n    private function set_result (result :A) :A\n    {\n        if (hasResult) {\n            throw \"Promise result already assigned\";\n        }\n\n        _result = result;\n        hasResult = true;\n        success.emit(result);\n        return result;\n    }\n\n    /**\n     * Passes the result to the callback now if the result is available, otherwise calls it later.\n     * @returns If the callback was not called yet, a handle that can be disposed to cancel the\n     * request.\n     */\n    public function get (fn :A -> Void) :Disposable\n    {\n        if (hasResult) {\n            fn(_result);\n            return null;\n        }\n        return success.connect(fn).once();\n    }\n\n    inline private function get_progress () :Float\n    {\n        return _progress;\n    }\n\n    private function set_progress (progress :Float) :Float\n    {\n        if (_progress != progress) {\n            _progress = progress;\n            progressChanged.emit();\n        }\n        return progress;\n    }\n\n    private function set_total (total :Float) :Float\n    {\n        if (_total != total) {\n            _total = total;\n            progressChanged.emit();\n        }\n        return total;\n    }\n\n    inline private function get_total () :Float\n    {\n        return _total;\n    }\n\n    private var _result :A;\n    private var _progress :Float;\n    private var _total :Float;\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n/**\n * An alias for Signal0 listeners.\n */\ntypedef Listener0 = Void -> Void;\n\n/**\n * A zero-argument signal. See Signal1 and Signal2 for different arities.\n */\nclass Signal0 extends SignalBase\n{\n    /**\n     * @param listener An optional listener to immediately connect to the signal.\n     */\n    public function new (?listener :Listener0)\n    {\n        super(listener);\n    }\n\n    /**\n     * Connects a listener to this signal.\n     * @param prioritize True if this listener should fire before others.\n     * @returns A SignalConnection, that can be disposed to remove the listener.\n     */\n    public function connect (listener :Listener0, prioritize :Bool = false) :SignalConnection\n    {\n        return connectImpl(listener, prioritize);\n    }\n\n    /**\n     * Emit the signal, notifying each connected listener.\n     */\n    public function emit ()\n    {\n        if (dispatching()) {\n            defer(function () {\n                emitImpl();\n            });\n        } else {\n            emitImpl();\n        }\n    }\n\n    private function emitImpl ()\n    {\n        var head = willEmit();\n        var p = head;\n        while (p != null) {\n            p._listener();\n            if (!p.stayInList) {\n                p.dispose();\n            }\n            p = p._next;\n        }\n        didEmit(head);\n    }\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\npackage flambe.util;\n\nusing StringTools;\n\n/**\n * Utility mixins for Strings. Designed to be imported with 'using'.\n */\nclass Strings {\n\t/**\n\t * Gets the extension of a file name, or null if there is no extension.\n\t */\n\tpublic static function getFileExtension(fileName:String):String {\n\t\tvar dot = fileName.lastIndexOf(\".\");\n\t\treturn (dot > 0) ? fileName.substr(dot + 1) : null;\n\t}\n\n\t/**\n\t * Returns a file name without its extension.\n\t */\n\tpublic static function removeFileExtension(fileName:String):String {\n\t\tvar dot = fileName.lastIndexOf(\".\");\n\t\treturn (dot > 0) ? fileName.substr(0, dot) : fileName;\n\t}\n\n\t/**\n\t * Gets the extension of a full path or URL, with special handling for '/' and '?' characters.\n\t * Returns null if there is no extension.\n\t */\n\tpublic static function getUrlExtension(url:String):String {\n\t\tvar question = url.lastIndexOf(\"?\");\n\t\tif (question >= 0) {\n\t\t\turl = url.substr(0, question);\n\t\t}\n\t\tvar slash = url.lastIndexOf(\"/\");\n\t\tif (slash >= 0) {\n\t\t\turl = url.substr(slash + 1);\n\t\t}\n\t\treturn getFileExtension(url);\n\t}\n\n\t/**\n\t * Joins two strings with a path separator.\n\t */\n\tpublic static function joinPath(base:String, relative:String):String {\n\t\tif (base.length > 0 && base.fastCodeAt(base.length - 1) != \"/\".code) {\n\t\t\tbase += \"/\"; // Ensure base ends with a trailing slash\n\t\t}\n\t\treturn base + relative;\n\t}\n\n\tpublic static function hashCode(str:String):Int {\n\t\tvar code = 0;\n\t\tif (str != null) {\n\t\t\tfor (ii in 0...str.length) {\n\t\t\t\tcode = Std.int(31 * code + str.fastCodeAt(ii));\n\t\t\t}\n\t\t}\n\t\treturn code;\n\t}\n\n\t/**\n\t * Substitute all \"{n}\" tokens with the corresponding values.\n\t *\n\t * ```haxe\n\t * \"{1} sat on a {0}\".substitute([\"wall\", \"Humpty Dumpty\"]);\n\t * // returns \"Humpty Dumpty sat on a wall\"\n\t * ```\n\t */\n\tpublic static function substitute(str:String, values:Array<Dynamic>):String {\n\t\t// FIXME(bruno): If your {0} replacement has a {1} in it, then that'll get replaced next\n\t\t// iteration\n\t\tfor (ii in 0...values.length) {\n\t\t\tstr = str.replace(\"{\" + ii + \"}\", values[ii]);\n\t\t}\n\t\treturn str;\n\t}\n\n\t/**\n\t * Format a message with named parameters into a standard format for logging and errors.\n\t *\n\t * ```haxe\n\t * \"Wobbles were frobulated\".withFields([\"count\", 5, \"silly\", true]);\n\t * // returns \"Wobbles were frobulated [count=5, silly=true]\"\n\t * ```\n\t *\n\t * @param fields The field names and values to be formatted. Must have an even length.\n\t */\n\tpublic static function withFields(message:String, fields:Array<Dynamic>):String {\n\t\tvar ll = fields.length;\n\t\tif (ll > 0) {\n\t\t\tmessage += (message.length > 0) ? \" [\" : \"[\";\n\t\t\tvar ii = 0;\n\t\t\twhile (ii < ll) {\n\t\t\t\tif (ii > 0) {\n\t\t\t\t\tmessage += \", \";\n\t\t\t\t}\n\t\t\t\tvar name = fields[ii];\n\t\t\t\tvar value:Dynamic = fields[ii + 1];\n\n\t\t\t\t// Replace throwables with their stack trace\n\t\t\t\t#if flash\n\t\t\t\tif (Std.is(value, flash.errors.Error)) {\n\t\t\t\t\tvar stack:String = cast(value, flash.errors.Error).getStackTrace();\n\t\t\t\t\tif (stack != null) {\n\t\t\t\t\t\tvalue = stack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#elseif js\n\t\t\t\tif (Std.isOfType(value, js.Syntax.plainCode(\"Error\"))) {\n\t\t\t\t\tvar stack:String = value.stack;\n\t\t\t\t\tif (stack != null) {\n\t\t\t\t\t\tvalue = stack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#end\n\t\t\t\tmessage += name + \"=\" + value;\n\t\t\t\tii += 2;\n\t\t\t}\n\t\t\tmessage += \"]\";\n\t\t}\n\n\t\treturn message;\n\t}\n}\n","package game;\n\nimport flambe.display.Sprite;\nimport flambe.animation.Sine;\nimport flambe.display.ImageSprite;\nimport flambe.asset.AssetPack;\nimport flambe.Entity;\nimport flambe.Component;\n\nclass Background extends Component {\n\tpublic function new(pack:AssetPack) {\n\t\tthis.init(pack);\n\t}\n\n\toverride function onAdded() {\n\t\towner.addChild(this._root);\n\t}\n\n\toverride function onRemoved() {\n\t\towner.removeChild(this._root);\n\t}\n\n\tpublic function init(pack:AssetPack) {\n\t\tthis._root = new Entity();\n\t\tthis._root.add(new ImageSprite(pack.getTexture(\"mainBack\")));\n\t\tthis._title = new Entity().add(new ImageSprite(pack.getTexture(\"title\")).setXY(390, 179));\n\n\t\tvar CLOUD_X_DIST = 30;\n\t\tvar CLOUD_Y_DIST = 15;\n\t\tvar CLOUD_TIME = 5;\n\n\t\tthis._flamingo = new ImageSprite(pack.getTexture(\"flamingo\")).setXY(1131, 594);\n\t\tthis._flamingo.x.behavior = new Sine(1131 - CLOUD_X_DIST, 1131 + CLOUD_X_DIST, CLOUD_TIME);\n\t\tthis._flamingo.rotation.behavior = new Sine(-5, 5, CLOUD_TIME * 2);\n\n\t\tvar cloud1 = new ImageSprite(pack.getTexture(\"cloud\")).setXY(0, 54);\n\t\tvar cloud2 = new ImageSprite(pack.getTexture(\"cloud\")).setXY(1039, 168);\n\t\tvar cloud3 = new ImageSprite(pack.getTexture(\"cloud\")).setXY(1340, 51);\n\n\t\tcloud1.x.behavior = new Sine(-CLOUD_X_DIST, CLOUD_X_DIST, CLOUD_TIME);\n\t\tcloud1.y.behavior = new Sine(54 - CLOUD_Y_DIST, 54 + CLOUD_Y_DIST, CLOUD_TIME * 2);\n\t\tcloud2.x.behavior = new Sine(1039 - CLOUD_X_DIST, 1039 + CLOUD_X_DIST, CLOUD_TIME);\n\t\tcloud2.y.behavior = new Sine(168 - CLOUD_Y_DIST, 168 + CLOUD_Y_DIST, CLOUD_TIME * 2);\n\t\tcloud3.x.behavior = new Sine(1340 - CLOUD_X_DIST, 1340 + CLOUD_X_DIST, CLOUD_TIME);\n\t\tcloud3.y.behavior = new Sine(51 - CLOUD_Y_DIST, 51 + CLOUD_Y_DIST, CLOUD_TIME * 2);\n\n\t\tthis._root //\n\t\t\t.addChild(new Entity().add(cloud1))\n\t\t\t.addChild(new Entity().add(cloud2))\n\t\t\t.addChild(new Entity().add(cloud3))\n\t\t\t.addChild(this._title) //\n\t\t\t.addChild(new Entity().add(this._flamingo)); //\n\t}\n\n\tprivate var _root:Entity;\n\tprivate var _title:Entity;\n\tprivate var _flamingo:Sprite;\n}\n","package game;\n\nimport flambe.display.Graphics;\nimport flambe.math.Rectangle;\nimport flambe.display.Sprite;\n\nclass Container extends Sprite {\n\tpublic function new(width:Int, height:Int):Void {\n\t\tsuper();\n\t\tthis._width = width;\n\t\tthis._height = height;\n\t\tthis.scissor = new Rectangle(0, 0, this._width, this._height);\n\t}\n\n\toverride public function getNaturalWidth():Float {\n\t\treturn this._width;\n\t}\n\n\toverride public function getNaturalHeight():Float {\n\t\treturn this._height;\n\t}\n\n\toverride function draw(g:Graphics) {\n\t\tg.fillRect(0xcccccc, 0, 0, this._width, this._height);\n\t}\n\n\t@:expose public static function getSize(imgWidth:Int, imgHeight:Int, containerWidth:Int, containerHeight:Int):{x:Float, y:Float, scale:Float} {\n\t\tvar imgRatio = (imgHeight / imgWidth); // original img ratio\n\t\tvar containerRatio = (containerHeight / containerWidth); // container ratio\n\n\t\tvar finalWidth = 0.0; // the scaled img width\n\t\tvar finalHeight = 0.0;\n\n\t\tif (containerRatio < imgRatio) {\n\t\t\tfinalHeight = containerHeight;\n\t\t\tfinalWidth = (containerHeight / imgRatio);\n\t\t} else {\n\t\t\tfinalWidth = containerWidth;\n\t\t\tfinalHeight = (containerWidth * imgRatio);\n\t\t}\n\n\t\t_scratch.scale = finalWidth / imgWidth;\n\t\t_scratch.x = (containerWidth - finalWidth) / 2;\n\t\t_scratch.y = (containerHeight - finalHeight) / 2;\n\n\t\treturn _scratch;\n\t}\n\n\tpublic function setSize(containerWidth:Int, containerHeight:Int):Container {\n\t\tvar size = getSize(this._width, this._height, containerWidth, containerHeight);\n\t\tthis.setScale(size.scale);\n\t\tthis.setXY(size.x, size.y);\n\n\t\treturn this;\n\t}\n\n\tprivate var _width:Int;\n\tprivate var _height:Int;\n\tprivate static var _scratch:{x:Float, y:Float, scale:Float} = {x: 0, y: 0, scale: 1};\n}\n","package game;\n\nimport flambe.display.ImageSprite;\nimport flambe.SpeedAdjuster;\nimport flambe.animation.Sine;\nimport flambe.animation.AnimatedFloat;\nimport flambe.input.PointerEvent;\nimport flambe.System;\nimport flambe.Disposer;\nimport game.cafe.ThirstyArms;\nimport game.cafe.Meter;\nimport game.cafe.BarTable;\nimport game.cafe.ThirstyPerson;\nimport flambe.asset.AssetPack;\nimport flambe.Entity;\nimport flambe.Component;\n\nclass Game extends Component {\n\tpublic function new(pack:AssetPack, width:Int, height:Int) {\n\t\tthis.init(pack, width, height);\n\t}\n\n\toverride public function onAdded() {\n\t\tthis.owner.addChild(this._root);\n\t}\n\n\toverride public function onRemoved() {\n\t\tthis.owner.removeChild(this._root);\n\t\tthis._disposer.dispose();\n\t}\n\n\toverride function onUpdate(dt:Float) {\n\t\treturn;\n\t\t_anchorX.update(dt);\n\t\t_anchorY.update(dt);\n\t\t_rotation.update(dt);\n\t\t_elapsed += dt;\n\t\tif (_elapsed > 5) {\n\t\t\t_elapsed = 0;\n\t\t\tif (Math.random() > 0.5) {\n\t\t\t\t_thirstyArms.wave();\n\t\t\t} else {\n\t\t\t\t_thirstyArms.slam();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic function init(pack:AssetPack, width:Int, height:Int) {\n\t\t_anchorX.behavior = new Sine(-40, 40, 2);\n\t\t_anchorY.behavior = new Sine(-10, 20, 3);\n\t\t_rotation.behavior = new Sine(-5, 5, 4);\n\n\t\tthis._disposer = new Disposer();\n\t\tthis._root = new Entity();\n\t\tthis._meterTime = new Entity().add(new Meter(20, 40));\n\t\tthis._meterDrink = new Entity().add(new Meter(width - 120, 40).setFill(.25));\n\t\tthis._root //\n\t\t\t.add(new Background(pack)) //\n\t\t\t\t// .add(this._thirstyPerson = new ThirstyPerson(width, height)) //\n\t\t\t.add(this._barTable = new BarTable(pack, height)); //\n\t\t// .add(this._thirstyArms = new ThirstyArms(width, height)) //\n\t\t// .addChild(this._meterTime) //\n\t\t// .addChild(this._meterDrink); //\n\n\t\t// this._thirstyPerson.bindTo(_anchorX, _anchorY, _rotation);\n\t\t// this._thirstyArms.bindTo(_anchorX, _anchorY, _rotation);\n\n\t\t// var isDown = false;\n\t\t// function onPointer(e:PointerEvent) {\n\t\t// \t_thirstyArms.setTarget(e.viewX, e.viewY);\n\t\t// }\n\n\t\t// this._disposer.add(System.pointer.down.connect(e -> {\n\t\t// \tisDown = true;\n\t\t// \tonPointer(e);\n\t\t// }));\n\t\t// this._disposer.add(System.pointer.up.connect(e -> {\n\t\t// \tif (isDown) {\n\t\t// \t\tonPointer(e);\n\t\t// \t\tthis._thirstyArms.reset();\n\t\t// \t\tisDown = false;\n\t\t// \t}\n\t\t// }));\n\t\t// this._disposer.add(System.pointer.move.connect(e -> {\n\t\t// \tif (isDown) {\n\t\t// \t\tonPointer(e);\n\t\t// \t}\n\t\t// }));\n\t}\n\n\tprivate var _root:Entity;\n\tprivate var _meterTime:Entity;\n\tprivate var _meterDrink:Entity;\n\tprivate var _barTable:BarTable;\n\tprivate var _thirstyPerson:ThirstyPerson;\n\tprivate var _thirstyArms:ThirstyArms;\n\tprivate var _disposer:Disposer;\n\tprivate var _elapsed = 0.0;\n\tprivate var _anchorX = new AnimatedFloat(0);\n\tprivate var _anchorY = new AnimatedFloat(0);\n\tprivate var _rotation = new AnimatedFloat(0);\n}\n","package game;\n\nimport flambe.animation.Sine;\nimport flambe.display.Sprite;\nimport flambe.display.ImageSprite;\nimport flambe.Disposer;\nimport flambe.asset.AssetPack;\nimport flambe.Entity;\nimport flambe.Component;\n\nclass Loader extends Component {\n\tpublic function new(pack:AssetPack, width:Int, height:Int) {\n\t\tthis.init(pack, width, height);\n\t}\n\n\toverride public function onAdded() {\n\t\tthis.owner.addChild(this._root);\n\t}\n\n\toverride public function onRemoved() {\n\t\tthis.owner.removeChild(this._root);\n\t\tthis._disposer.dispose();\n\t}\n\n\tpublic function init(pack:AssetPack, width:Int, height:Int) {\n\t\tthis._disposer = new Disposer();\n\t\tthis._root = new Entity();\n\n\t\tthis._root //\n\t\t\t.add(new ImageSprite(pack.getTexture(\"loadingBack\"))) //\n\t\t\t.add(new LoaderBall(pack, width, height));\n\t}\n\n\tprivate var _root:Entity;\n\tprivate var _disposer:Disposer;\n}\n\nclass LoaderBall extends Component {\n\tpublic function new(pack:AssetPack, width:Int, height:Int) {\n\t\tthis.init(pack, width, height);\n\t}\n\n\toverride public function onAdded() {\n\t\tthis.owner.addChild(this._root);\n\t}\n\n\toverride public function onRemoved() {\n\t\tthis.owner.removeChild(this._root);\n\t}\n\n\tpublic function init(pack:AssetPack, width:Int, height:Int) {\n\t\tvar BALL_X = 898;\n\t\tvar BALL_Y = 786;\n\t\tvar BALL_X_MOVE = 50;\n\t\tvar BALL_Y_MOVE = 10;\n\t\tthis._root = new Entity();\n\t\tvar rootSpr = new Sprite().setXY(BALL_X, BALL_Y);\n\t\tthis._root.add(rootSpr);\n\t\tvar lineSpr = new ImageSprite(pack.getTexture(\"ballLineWater\"));\n\t\tvar ballSpr = new ImageSprite(pack.getTexture(\"ball\")).centerAnchor().setXY(75, -250);\n\t\tthis._root.addChild(new Entity().add(ballSpr));\n\t\tthis._root.addChild(new Entity().add(lineSpr));\n\t\tballSpr.rotation.behavior = new Sine(-10, 10, 4);\n\t\trootSpr.x.behavior = new Sine(BALL_X - BALL_X_MOVE, BALL_X + BALL_X_MOVE, 4);\n\t\trootSpr.y.behavior = new Sine(BALL_Y, BALL_Y + BALL_Y_MOVE, 2);\n\t}\n\n\tprivate var _root:Entity;\n}\n","package game;\r\n\r\nimport flambe.web.WebView;\r\nimport flambe.asset.AssetPack;\r\nimport flambe.asset.Manifest;\r\nimport flambe.System;\r\n\r\nclass Main {\r\n\tstatic function main() {\r\n\t\tSystem.init();\r\n\t}\r\n\r\n\tpublic static var vueSplash = js.Lib.require(\"./src/components/Splash.vue\");\r\n\r\n\t@:expose static function start(width:Int, height:Int):Void {\r\n\t\tvar container = new Container(width, height);\r\n\t\tcontainer.visible = false;\r\n\t\tSystem.root.add(container);\r\n\t\tSystem.stage.resize.connect(() -> {\r\n\t\t\tcontainer.setSize(System.stage.width, System.stage.height);\r\n\t\t});\r\n\t\tSystem.stage.resize.emit();\r\n\t\tvar bootstrap = Manifest.fromAssets(\"bootstrap\");\r\n\t\tSystem.loadAssetPack(bootstrap).success.connect(onDev.bind(width, height)).once();\r\n\t}\r\n\r\n\tstatic function onDev(width:Int, height:Int, pack:AssetPack):Void {\r\n\t\tvar loader = new Loader(pack, width, height);\r\n\t\tSystem.root.add(loader);\r\n\t\tSystem.root.get(Container).visible = true;\r\n\t\tvar main = Manifest.fromAssets(\"main\");\r\n\t\tSystem.loadAssetPack(main).success.connect(mainPack -> {\r\n\t\t\tloader.dispose();\r\n\t\t\tonGameLoaded(width, height, mainPack);\r\n\t\t}).once();\r\n\t}\r\n\r\n\tstatic function onBootstrapLoaded(width:Int, height:Int, pack:AssetPack):Void {\r\n\t\tvar splash:WebView = null;\r\n\t\tsplash = System.web.addView(vueSplash, {\r\n\t\t\tonClick: () -> {\r\n\t\t\t\t// initialize audio\r\n\t\t\t\tpack.getSound(\"silence\").play();\r\n\t\t\t\t// remove splash screen\r\n\t\t\t\tsplash.dispose();\r\n\t\t\t\tvar loader = new Loader(pack, width, height);\r\n\r\n\t\t\t\tSystem.root.add(loader);\r\n\t\t\t\t// show game container\r\n\t\t\t\tSystem.root.get(Container).visible = true;\r\n\t\t\t\t// load Main\r\n\t\t\t\tvar main = Manifest.fromAssets(\"main\");\r\n\t\t\t\tSystem.loadAssetPack(main).success.connect(mainPack -> {\r\n\t\t\t\t\tloader.dispose();\r\n\t\t\t\t\tonGameLoaded(width, height, mainPack);\r\n\t\t\t\t}).once();\r\n\t\t\t}\r\n\t\t}, {width: width, height: height});\r\n\t}\r\n\r\n\tstatic function onGameLoaded(width:Int, height:Int, pack:AssetPack):Void {\r\n\t\tSystem.root.add(new Game(pack, width, height));\r\n\t}\r\n}\r\n","package game.cafe;\n\nimport flambe.display.ImageSprite;\nimport flambe.asset.AssetPack;\nimport flambe.display.FillSprite;\nimport flambe.Entity;\nimport flambe.Component;\n\nclass BarTable extends Component {\n\tpublic function new(pack:AssetPack, height:Int) {\n\t\tthis.init(pack, height);\n\t}\n\n\toverride function onAdded() {\n\t\towner.addChild(this._root);\n\t}\n\n\toverride function onRemoved() {\n\t\towner.removeChild(this._root);\n\t}\n\n\tpublic function init(pack:AssetPack, height:Int) {\n\t\tthis._root = new Entity();\n\t\tvar table = pack.getTexture(\"table\");\n\t\tthis._root.add(new ImageSprite(table).setXY(-3, height - table.height));\n\t\t_slots = [];\n\t\tfor (i in 0...5) {\n\t\t\tvar x = 250 * i + 380;\n\t\t\tvar y = i % 2 == 0 ? 80 : 150;\n\t\t\tvar e = new Entity().add(new FillSprite(0xff00ff, 80, 80).setXY(x, y));\n\t\t\t_slots.push(e);\n\t\t\tthis._root.addChild(e);\n\t\t}\n\t}\n\n\tprivate var _root:Entity;\n\tprivate var _slots:Array<Entity>;\n}\n","package game.cafe;\n\nimport flambe.math.FMath;\nimport flambe.display.FillSprite;\nimport flambe.display.Sprite;\nimport flambe.Entity;\nimport flambe.Component;\n\nclass Meter extends Component {\n\tpublic function new(x:Float, y:Float) {\n\t\tthis.init(x, y);\n\t}\n\n\toverride function onAdded() {\n\t\towner.addChild(this._root);\n\t}\n\n\toverride function onRemoved() {\n\t\towner.removeChild(this._root);\n\t}\n\n\tpublic function setFill(percent:Float):Meter {\n\t\tvar p = FMath.clamp(percent, 0, 1);\n\t\tthis._fill.height._ = HEIGHT_MAX * p;\n\t\tthis._fill.y._ = HEIGHT_MAX - this._fill.height._ + 3;\n\t\treturn this;\n\t}\n\n\tpublic function init(x:Float, y:Float) {\n\t\tthis._root = new Entity().add(new Sprite().setXY(x, y));\n\n\t\tvar backing = new Entity().add(new FillSprite(0x111111, 100, 700));\n\t\tvar fill = new Entity().add(this._fill = cast new FillSprite(0xffaaee, 94, HEIGHT_MAX).setXY(3, 3));\n\n\t\tthis._root.addChild(backing).addChild(fill);\n\t}\n\n\tprivate var _fill:FillSprite;\n\tprivate var _root:Entity;\n\n\tprivate static var HEIGHT_MAX = 694;\n}\n","package haxe;\n\nimport js.lib.Error;\n\n@:coreApi\nclass Exception extends NativeException {\n\tpublic var message(get,never):String;\n\tpublic var stack(get,never):CallStack;\n\tpublic var previous(get,never):Null<Exception>;\n\tpublic var native(get,never):Any;\n\n\t@:ifFeature(\"haxe.Exception.get_stack\")\n\t@:noCompletion var __skipStack:Int;\n\t@:noCompletion var __exceptionStack(get,set):Null<CallStack>;\n\t@:noCompletion var __nativeException:Any;\n\t@:noCompletion var __previousException:Null<Exception>;\n\n\tstatic function caught(value:Any):Exception {\n\t\tif(Std.isOfType(value, Exception)) {\n\t\t\treturn value;\n\t\t} else if(Std.isOfType(value, Error)) {\n\t\t\treturn new Exception((cast value:Error).message, null, value);\n\t\t} else {\n\t\t\treturn new ValueException(value, null, value);\n\t\t}\n\t}\n\n\tstatic function thrown(value:Any):Any {\n\t\tif(Std.isOfType(value, Exception)) {\n\t\t\treturn (value:Exception).native;\n\t\t} else if(Std.isOfType(value, Error)) {\n\t\t\treturn value;\n\t\t} else {\n\t\t\tvar e = new ValueException(value);\n\t\t\tuntyped __feature__(\"haxe.Exception.get_stack\", e.__shiftStack());\n\t\t\treturn e;\n\t\t}\n\t}\n\n\tpublic function new(message:String, ?previous:Exception, ?native:Any) {\n\t\tsuper(message);\n\t\t(cast this).message = message;\n\t\t__previousException = previous;\n\t\t__nativeException = native != null ? native : this;\n\t\tuntyped __feature__('haxe.Exception.stack', {\n\t\t\t__skipStack = 0;\n\t\t\tvar old = js.Syntax.code('Error.prepareStackTrace');\n\t\t\tjs.Syntax.code('Error.prepareStackTrace = function(e) { return e.stack; }');\n\t\t\tif(Std.isOfType(native, Error)) {\n\t\t\t\t(cast this).stack = native.stack;\n\t\t\t} else {\n\t\t\t\tvar e:Error = null;\n\t\t\t\tif ((cast Error).captureStackTrace) {\n\t\t\t\t\t(cast Error).captureStackTrace(this, Exception);\n\t\t\t\t\te = cast this;\n\t\t\t\t} else {\n\t\t\t\t\te = new Error();\n\t\t\t\t\t//Internet Explorer provides call stack only if error was thrown\n\t\t\t\t\tif(js.Syntax.typeof(e.stack) == \"undefined\") {\n\t\t\t\t\t\tjs.Syntax.code('try { throw {0}; } catch(_) {}', e);\n\t\t\t\t\t\t__skipStack++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t(cast this).stack = e.stack;\n\t\t\t}\n\t\t\tjs.Syntax.code('Error.prepareStackTrace = {0}', old);\n\t\t});\n\t}\n\n\tfunction unwrap():Any {\n\t\treturn __nativeException;\n\t}\n\n\tpublic function toString():String {\n\t\treturn message;\n\t}\n\n\tpublic function details():String {\n\t\treturn inline CallStack.exceptionToString(this);\n\t}\n\n\t@:noCompletion\n\t@:ifFeature(\"haxe.Exception.get_stack\")\n\tinline function __shiftStack():Void {\n\t\t__skipStack++;\n\t}\n\n\tfunction get_message():String {\n\t\treturn (cast this:Error).message;\n\t}\n\n\tfunction get_previous():Null<Exception> {\n\t\treturn __previousException;\n\t}\n\n\tfinal function get_native():Any {\n\t\treturn __nativeException;\n\t}\n\n\t@:ifFeature('haxe.NativeStackTrace.exceptionStack')\n\tfunction get_stack():CallStack {\n\t\treturn switch __exceptionStack {\n\t\t\tcase null:\n\t\t\t\t__exceptionStack = NativeStackTrace.toHaxe(NativeStackTrace.normalize((cast this).stack), __skipStack);\n\t\t\tcase s: s;\n\t\t}\n\t}\n\n\t@:noCompletion\n\tfunction setProperty(name:String, value:Any):Void {\n\t\ttry {\n\t\t\tjs.lib.Object.defineProperty(this, name, {value:value});\n\t\t} catch(e:Exception) {\n\t\t\tjs.Syntax.code('{0}[{1}] = {2}', this, name, value);\n\t\t}\n\t}\n\n\t@:noCompletion\n\tinline function get___exceptionStack():CallStack {\n\t\treturn (cast this).__exceptionStack;\n\t}\n\n\t@:noCompletion\n\tinline function set___exceptionStack(value:CallStack):CallStack {\n\t\tsetProperty('__exceptionStack', value);\n\t\treturn value;\n\t}\n\n\t@:noCompletion\n\tinline function get___skipStack():Int {\n\t\treturn (cast this).__skipStack;\n\t}\n\n\t@:noCompletion\n\tinline function set___skipStack(value:Int):Int {\n\t\tsetProperty('__skipStack', value);\n\t\treturn value;\n\t}\n\n\t@:noCompletion\n\tinline function get___nativeException():Any {\n\t\treturn (cast this).__nativeException;\n\t}\n\n\t@:noCompletion\n\tinline function set___nativeException(value:Any):Any {\n\t\tsetProperty('__nativeException', value);\n\t\treturn value;\n\t}\n\n\t@:noCompletion\n\tinline function get___previousException():Null<Exception> {\n\t\treturn (cast this).__previousException;\n\t}\n\n\t@:noCompletion\n\tinline function set___previousException(value:Null<Exception>):Null<Exception> {\n\t\tsetProperty('__previousException', value);\n\t\treturn value;\n\t}\n}\n\n@:dox(hide)\n@:noCompletion\n@:native('Error')\nprivate extern class NativeException {\n\t// private var message:String; //redefined in haxe.Exception\n\t// private var stack(default, null):String; //redefined in haxe.Exception\n\n\tfunction new(?message:String);\n}\n","package haxe;\n\n/**\n\tAn exception containing arbitrary value.\n\n\tThis class is automatically used for throwing values, which don't extend `haxe.Exception`\n\tor native exception type.\n\tFor example:\n\t```haxe\n\tthrow \"Terrible error\";\n\t```\n\twill be compiled to\n\t```haxe\n\tthrow new ValueException(\"Terrible error\");\n\t```\n**/\nclass ValueException extends Exception {\n\t/**\n\t\tThrown value.\n\t**/\n\tpublic var value(default,null):Any;\n\n\tpublic function new(value:Any, ?previous:Exception, ?native:Any):Void {\n\t\tsuper(#if js js.Syntax.code('String({0})', value) #else Std.string(value) #end, previous, native);\n\t\tthis.value = value;\n\t}\n\n\t/**\n\t\tExtract an originally thrown value.\n\n\t\tThis method must return the same value on subsequent calls.\n\t\tUsed internally for catching non-native exceptions.\n\t\tDo _not_ override unless you know what you are doing.\n\t**/\n\toverride function unwrap():Any {\n\t\treturn value;\n\t}\n}","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\n@:coreApi class IntMap<T> implements haxe.Constraints.IMap<Int, T> {\n\tprivate var h:Dynamic;\n\n\tpublic inline function new():Void {\n\t\th = {};\n\t}\n\n\tpublic inline function set(key:Int, value:T):Void {\n\t\th[key] = value;\n\t}\n\n\tpublic inline function get(key:Int):Null<T> {\n\t\treturn h[key];\n\t}\n\n\tpublic inline function exists(key:Int):Bool {\n\t\treturn (cast h).hasOwnProperty(key);\n\t}\n\n\tpublic function remove(key:Int):Bool {\n\t\tif (!(cast h).hasOwnProperty(key))\n\t\t\treturn false;\n\t\tjs.Syntax.delete(h, key);\n\t\treturn true;\n\t}\n\n\tpublic function keys():Iterator<Int> {\n\t\tvar a = [];\n\t\tjs.Syntax.code(\"for( var key in {0} ) if({0}.hasOwnProperty(key)) {1}.push(key | 0)\", h, a);\n\t\treturn a.iterator();\n\t}\n\n\tpublic function iterator():Iterator<T> {\n\t\treturn untyped {\n\t\t\tref: h,\n\t\t\tit: keys(),\n\t\t\thasNext: function() {\n\t\t\t\treturn __this__.it.hasNext();\n\t\t\t},\n\t\t\tnext: function() {\n\t\t\t\tvar i = __this__.it.next();\n\t\t\t\treturn __this__.ref[i];\n\t\t\t}\n\t\t};\n\t}\n\n\t@:runtime public inline function keyValueIterator():KeyValueIterator<Int, T> {\n\t\treturn new haxe.iterators.MapKeyValueIterator(this);\n\t}\n\n\tpublic function copy():IntMap<T> {\n\t\tvar copied = new IntMap();\n\t\tfor (key in keys())\n\t\t\tcopied.set(key, get(key));\n\t\treturn copied;\n\t}\n\n\tpublic function toString():String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar it = keys();\n\t\tfor (i in it) {\n\t\t\ts.add(i);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(i)));\n\t\t\tif (it.hasNext())\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\tpublic inline function clear():Void {\n\t\th = {};\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.ds;\n\nimport js.lib.Object;\nimport haxe.Constraints.IMap;\nimport haxe.DynamicAccess;\n\n#if (js_es >= 5)\n@:coreApi class StringMap<T> implements IMap<String, T> {\n\tvar h:Dynamic;\n\n\tpublic inline function new() {\n\t\th = Object.create(null);\n\t}\n\n\tpublic inline function exists(key:String):Bool {\n\t\treturn Object.prototype.hasOwnProperty.call(h, key);\n\t}\n\n\tpublic inline function get(key:String):Null<T> {\n\t\treturn h[cast key];\n\t}\n\n\tpublic inline function set(key:String, value:T):Void {\n\t\th[cast key] = value;\n\t}\n\n\tpublic inline function remove(key:String):Bool {\n\t\treturn if (exists(key)) {\n\t\t\tjs.Syntax.delete(h, key); true;\n\t\t} else {\n\t\t\tfalse;\n\t\t}\n\t}\n\n\tpublic inline function keys():Iterator<String> {\n\t\treturn new StringMapKeyIterator(h);\n\t}\n\n\tpublic inline function iterator():Iterator<T> {\n\t\treturn new StringMapValueIterator(h);\n\t}\n\n\tpublic inline function keyValueIterator():KeyValueIterator<String, T> {\n\t\treturn new StringMapKeyValueIterator(h);\n\t}\n\n\tpublic inline function copy():StringMap<T> {\n\t\treturn createCopy(h);\n\t}\n\n\tpublic inline function clear():Void {\n\t\th = Object.create(null);\n\t}\n\n\tpublic inline function toString():String {\n\t\treturn stringify(h);\n\t}\n\n\t// impl\n\tstatic function createCopy<T>(h:Dynamic):StringMap<T> {\n\t\tvar copy = new StringMap();\n\t\tjs.Syntax.code(\"for (var key in {0}) {1}[key] = {0}[key]\", h, copy.h);\n\t\treturn copy;\n\t}\n\n\t@:analyzer(no_optimize)\n\tstatic function stringify(h:Dynamic):String {\n\t\tvar s = \"{\", first = true;\n\t\tjs.Syntax.code(\"for (var key in {0}) {\", h);\n\t\tjs.Syntax.code(\"\\tif ({0}) {0} = false; else {1} += ',';\", first, s);\n\t\tjs.Syntax.code(\"\\t{0} += key + ' => ' + {1}({2}[key]);\", s, Std.string, h);\n\t\tjs.Syntax.code(\"}\");\n\t\treturn s + \"}\";\n\t}\n}\n\nprivate class StringMapKeyIterator {\n\tfinal h:Dynamic;\n\tfinal keys:Array<String>;\n\tfinal length:Int;\n\tvar current:Int;\n\n\tpublic inline function new(h:Dynamic) {\n\t\tthis.h = h;\n\t\tkeys = Object.keys(h);\n\t\tlength = keys.length;\n\t\tcurrent = 0;\n\t}\n\n\tpublic inline function hasNext():Bool {\n\t\treturn current < length;\n\t}\n\n\tpublic inline function next():String {\n\t\treturn keys[current++];\n\t}\n}\n\nprivate class StringMapValueIterator<T> {\n\tfinal h:Dynamic;\n\tfinal keys:Array<String>;\n\tfinal length:Int;\n\tvar current:Int;\n\n\tpublic inline function new(h:Dynamic) {\n\t\tthis.h = h;\n\t\tkeys = Object.keys(h);\n\t\tlength = keys.length;\n\t\tcurrent = 0;\n\t}\n\n\tpublic inline function hasNext():Bool {\n\t\treturn current < length;\n\t}\n\n\tpublic inline function next():T {\n\t\treturn h[cast keys[current++]];\n\t}\n}\n\nprivate class StringMapKeyValueIterator<T> {\n\tfinal h:Dynamic;\n\tfinal keys:Array<String>;\n\tfinal length:Int;\n\tvar current:Int;\n\n\tpublic inline function new(h:Dynamic) {\n\t\tthis.h = h;\n\t\tkeys = Object.keys(h);\n\t\tlength = keys.length;\n\t\tcurrent = 0;\n\t}\n\n\tpublic inline function hasNext():Bool {\n\t\treturn current < length;\n\t}\n\n\tpublic inline function next():{key:String, value:T} {\n\t\tvar key = keys[current++];\n\t\treturn {key: key, value: h[cast key]};\n\t}\n}\n#else\nprivate class StringMapIterator<T> {\n\tvar map:StringMap<T>;\n\tvar keys:Array<String>;\n\tvar index:Int;\n\tvar count:Int;\n\n\tpublic inline function new(map:StringMap<T>, keys:Array<String>) {\n\t\tthis.map = map;\n\t\tthis.keys = keys;\n\t\tthis.index = 0;\n\t\tthis.count = keys.length;\n\t}\n\n\tpublic inline function hasNext() {\n\t\treturn index < count;\n\t}\n\n\tpublic inline function next() {\n\t\treturn map.get(keys[index++]);\n\t}\n}\n\n@:coreApi class StringMap<T> implements haxe.Constraints.IMap<String, T> {\n\tprivate var h:Dynamic;\n\tprivate var rh:Dynamic;\n\n\tpublic inline function new():Void {\n\t\th = {};\n\t}\n\n\tinline function isReserved(key:String):Bool {\n\t\treturn js.Syntax.code(\"__map_reserved[{0}]\", key) != null;\n\t}\n\n\tpublic inline function set(key:String, value:T):Void {\n\t\tif (isReserved(key))\n\t\t\tsetReserved(key, value);\n\t\telse\n\t\t\th[cast key] = value;\n\t}\n\n\tpublic inline function get(key:String):Null<T> {\n\t\tif (isReserved(key))\n\t\t\treturn getReserved(key);\n\t\treturn h[cast key];\n\t}\n\n\tpublic inline function exists(key:String):Bool {\n\t\tif (isReserved(key))\n\t\t\treturn existsReserved(key);\n\t\treturn h.hasOwnProperty(key);\n\t}\n\n\tfunction setReserved(key:String, value:T):Void {\n\t\tif (rh == null)\n\t\t\trh = {};\n\t\trh[cast \"$\" + key] = value;\n\t}\n\n\tfunction getReserved(key:String):Null<T> {\n\t\treturn rh == null ? null : rh[cast \"$\" + key];\n\t}\n\n\tfunction existsReserved(key:String):Bool {\n\t\tif (rh == null)\n\t\t\treturn false;\n\t\treturn (cast rh).hasOwnProperty(\"$\" + key);\n\t}\n\n\tpublic function remove(key:String):Bool {\n\t\tif (isReserved(key)) {\n\t\t\tkey = \"$\" + key;\n\t\t\tif (rh == null || !rh.hasOwnProperty(key))\n\t\t\t\treturn false;\n\t\t\tjs.Syntax.delete(rh, key);\n\t\t\treturn true;\n\t\t} else {\n\t\t\tif (!h.hasOwnProperty(key))\n\t\t\t\treturn false;\n\t\t\tjs.Syntax.delete(h, key);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tpublic function keys():Iterator<String> {\n\t\treturn arrayKeys().iterator();\n\t}\n\n\tfunction arrayKeys():Array<String> {\n\t\tvar out = [];\n\t\tuntyped {\n\t\t\tjs.Syntax.code(\"for( var key in this.h ) {\");\n\t\t\tif (h.hasOwnProperty(key))\n\t\t\t\tout.push(key);\n\t\t\tjs.Syntax.code(\"}\");\n\t\t}\n\t\tif (rh != null)\n\t\t\tuntyped {\n\t\t\t\tjs.Syntax.code(\"for( var key in this.rh ) {\");\n\t\t\t\tif (key.charCodeAt(0) == \"$\".code)\n\t\t\t\t\tout.push(key.substr(1));\n\t\t\t\tjs.Syntax.code(\"}\");\n\t\t\t}\n\t\treturn out;\n\t}\n\n\tpublic inline function iterator():Iterator<T> {\n\t\treturn new StringMapIterator(this, arrayKeys());\n\t}\n\n\t@:runtime public inline function keyValueIterator():KeyValueIterator<String, T> {\n\t\treturn new haxe.iterators.MapKeyValueIterator(this);\n\t}\n\n\tpublic function copy():StringMap<T> {\n\t\tvar copied = new StringMap();\n\t\tfor (key in keys())\n\t\t\tcopied.set(key, get(key));\n\t\treturn copied;\n\t}\n\n\tpublic function toString():String {\n\t\tvar s = new StringBuf();\n\t\ts.add(\"{\");\n\t\tvar keys = arrayKeys();\n\t\tfor (i in 0...keys.length) {\n\t\t\tvar k = keys[i];\n\t\t\ts.add(k);\n\t\t\ts.add(\" => \");\n\t\t\ts.add(Std.string(get(k)));\n\t\t\tif (i < keys.length - 1)\n\t\t\t\ts.add(\", \");\n\t\t}\n\t\ts.add(\"}\");\n\t\treturn s.toString();\n\t}\n\n\tpublic inline function clear():Void {\n\t\th = {};\n\t\trh = null;\n\t}\n\n\tstatic function __init__():Void {\n\t\tjs.Syntax.code(\"var __map_reserved = {};\");\n\t}\n}\n#end\n","/*\n * Copyright (C)2005-2018 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.iterators;\n\n/**\n\tThis iterator is used only when `Array<T>` is passed to `Iterable<T>`\n**/\nclass ArrayIterator<T> {\n\tfinal array:Array<T>;\n\tvar current:Int = 0;\n\n\t/**\n\t\tCreate a new `ArrayIterator`.\n\t**/\n\t#if !hl inline #end\n\tpublic function new(array:Array<T>) {\n\t\tthis.array = array;\n\t}\n\n\t/**\n\t\tSee `Iterator.hasNext`\n\t**/\n\t#if !hl inline #end\n\tpublic function hasNext() {\n\t\treturn current < array.length;\n\t}\n\n\t/**\n\t\tSee `Iterator.next`\n\t**/\n\t#if !hl inline #end\n\tpublic function next() {\n\t\treturn array[current++];\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage haxe.rtti;\n\nprivate typedef MetaObject = {\n\t?fields:Dynamic<Dynamic<Null<Array<Dynamic>>>>,\n\t?statics:Dynamic<Dynamic<Null<Array<Dynamic>>>>,\n\t?obj:Dynamic<Null<Array<Dynamic>>>\n};\n\n/**\n\tAn API to access classes and enums metadata at runtime.\n\n\t@see <https://haxe.org/manual/cr-rtti.html>\n**/\nclass Meta {\n\t/**\n\t\tReturns the metadata that were declared for the given type (class or enum)\n\t**/\n\tpublic static function getType(t:Dynamic):Dynamic<Array<Dynamic>> {\n\t\tvar meta = getMeta(t);\n\t\treturn (meta == null || meta.obj == null) ? {} : meta.obj;\n\t}\n\n\t// Could move this to Type.hx?\n\tprivate static function isInterface(t:Dynamic):Bool {\n\t\t#if java\n\t\treturn java.Lib.toNativeType(t).isInterface();\n\t\t#elseif cs\n\t\treturn cs.Lib.toNativeType(t).IsInterface;\n\t\t#else\n\t\tthrow \"Something went wrong\";\n\t\t#end\n\t}\n\n\tprivate static function getMeta(t:Dynamic):MetaObject {\n\t\t#if php\n\t\treturn php.Boot.getMeta(t.phpClassName);\n\t\t#elseif (java || cs)\n\t\tvar ret = Reflect.field(t, \"__meta__\");\n\t\tif (ret == null && Std.isOfType(t, Class)) {\n\t\t\tif (isInterface(t)) {\n\t\t\t\tvar name = Type.getClassName(t),\n\t\t\t\t\tcls = Type.resolveClass(name + '_HxMeta');\n\t\t\t\tif (cls != null)\n\t\t\t\t\treturn Reflect.field(cls, \"__meta__\");\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t\t#elseif hl\n\t\tvar t:hl.BaseType = t;\n\t\treturn t.__meta__;\n\t\t#else\n\t\treturn untyped t.__meta__;\n\t\t#end\n\t}\n\n\t/**\n\t\tReturns the metadata that were declared for the given class static fields\n\t**/\n\tpublic static function getStatics(t:Dynamic):Dynamic<Dynamic<Array<Dynamic>>> {\n\t\tvar meta = getMeta(t);\n\t\treturn (meta == null || meta.statics == null) ? {} : meta.statics;\n\t}\n\n\t/**\n\t\tReturns the metadata that were declared for the given class fields or enum constructors\n\t**/\n\tpublic static function getFields(t:Dynamic):Dynamic<Dynamic<Array<Dynamic>>> {\n\t\tvar meta = getMeta(t);\n\t\treturn (meta == null || meta.fields == null) ? {} : meta.fields;\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage js;\n\nimport js.Syntax; // import it here so it's always available in the compiler\n\n@:dox(hide)\nclass Boot {\n\tstatic inline function isClass(o:Dynamic):Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isClass\", o.__name__);\n\t}\n\n\tstatic inline function isInterface(o:Class<Dynamic>):Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isInterface\", o.__isInterface__);\n\t}\n\n\tstatic inline function isEnum(e:Dynamic):Bool {\n\t\treturn untyped __define_feature__(\"js.Boot.isEnum\", e.__ename__);\n\t}\n\n\t@:pure static function getClass(o:Null<Dynamic>):Null<Dynamic> {\n\t\tif (o == null) {\n\t\t\treturn null;\n\t\t} else if (Std.isOfType(o, Array)) {\n\t\t\treturn Array;\n\t\t} else {\n\t\t\tvar cl = untyped __define_feature__(\"js.Boot.getClass\", o.__class__);\n\t\t\tif (cl != null)\n\t\t\t\treturn cl;\n\t\t\tvar name = __nativeClassName(o);\n\t\t\tif (name != null)\n\t\t\t\treturn __resolveNativeClass(name);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t@:ifFeature(\"has_enum\")\n\tprivate static function __string_rec(o, s:String) {\n\t\tuntyped {\n\t\t\tif (o == null)\n\t\t\t\treturn \"null\";\n\t\t\tif (s.length >= 5)\n\t\t\t\treturn \"<...>\"; // too much deep recursion\n\t\t\tvar t = js.Syntax.typeof(o);\n\t\t\tif (t == \"function\" && (isClass(o) || isEnum(o)))\n\t\t\t\tt = \"object\";\n\t\t\tswitch (t) {\n\t\t\t\tcase \"object\":\n\t\t\t\t\t#if !js_enums_as_arrays\n\t\t\t\t\t__feature__(\"has_enum\", if (o.__enum__) {\n\t\t\t\t\t\tvar e = $hxEnums[o.__enum__];\n\t\t\t\t\t\tvar con = e.__constructs__[o._hx_index];\n\t\t\t\t\t\tvar n = con._hx_name;\n\t\t\t\t\t\tif (con.__params__) {\n\t\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\t\treturn n + \"(\" + [for (p in (con.__params__ : Array<String>)) __string_rec(o[p], s)].join(\",\") + \")\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn n;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t#end\n\t\t\t\t\tif (js.Syntax.instanceof(o, Array)) {\n\t\t\t\t\t\t#if js_enums_as_arrays\n\t\t\t\t\t\t__feature__(\"has_enum\", if (o.__enum__) {\n\t\t\t\t\t\t\tif (o.length == 2)\n\t\t\t\t\t\t\t\treturn o[0];\n\t\t\t\t\t\t\tvar str = o[0] + \"(\";\n\t\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\t\tfor (i in 2...o.length) {\n\t\t\t\t\t\t\t\tif (i != 2)\n\t\t\t\t\t\t\t\t\tstr += \",\" + __string_rec(o[i], s);\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tstr += __string_rec(o[i], s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn str + \")\";\n\t\t\t\t\t\t});\n\t\t\t\t\t\t#end\n\t\t\t\t\t\tvar str = \"[\";\n\t\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\t\tfor (i in 0...o.length)\n\t\t\t\t\t\t\tstr += (if (i > 0) \",\" else \"\") + __string_rec(o[i], s);\n\t\t\t\t\t\tstr += \"]\";\n\t\t\t\t\t\treturn str;\n\t\t\t\t\t}\n\t\t\t\t\tvar tostr;\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttostr = untyped o.toString;\n\t\t\t\t\t} catch (e:Dynamic) {\n\t\t\t\t\t\t// strange error on IE\n\t\t\t\t\t\treturn \"???\";\n\t\t\t\t\t}\n\t\t\t\t\tif (tostr != null && tostr != js.Syntax.code(\"Object.toString\") && js.Syntax.typeof(tostr) == \"function\") {\n\t\t\t\t\t\tvar s2 = o.toString();\n\t\t\t\t\t\tif (s2 != \"[object Object]\")\n\t\t\t\t\t\t\treturn s2;\n\t\t\t\t\t}\n\t\t\t\t\tvar str = \"{\\n\";\n\t\t\t\t\ts += \"\\t\";\n\t\t\t\t\tvar hasp = (o.hasOwnProperty != null);\n\t\t\t\t\tvar k:String = null;\n\t\t\t\t\tjs.Syntax.code(\"for( {0} in {1} ) {\", k, o);\n\t\t\t\t\tif (hasp && !o.hasOwnProperty(k))\n\t\t\t\t\t\tjs.Syntax.code(\"continue\");\n\t\t\t\t\tif (k == \"prototype\" || k == \"__class__\" || k == \"__super__\" || k == \"__interfaces__\" || k == \"__properties__\")\n\t\t\t\t\t\tjs.Syntax.code(\"continue\");\n\t\t\t\t\tif (str.length != 2)\n\t\t\t\t\t\tstr += \", \\n\";\n\t\t\t\t\tstr += s + k + \" : \" + __string_rec(o[k], s);\n\t\t\t\t\tjs.Syntax.code(\"}\");\n\t\t\t\t\ts = s.substring(1);\n\t\t\t\t\tstr += \"\\n\" + s + \"}\";\n\t\t\t\t\treturn str;\n\t\t\t\tcase \"function\":\n\t\t\t\t\treturn \"<function>\";\n\t\t\t\tcase \"string\":\n\t\t\t\t\treturn o;\n\t\t\t\tdefault:\n\t\t\t\t\treturn String(o);\n\t\t\t}\n\t\t}\n\t}\n\n\t@:pure private static function __interfLoop(cc:Dynamic, cl:Dynamic) {\n\t\tif (cc == null)\n\t\t\treturn false;\n\t\tif (cc == cl)\n\t\t\treturn true;\n\t\tvar intf:Dynamic = cc.__interfaces__;\n\t\tif (intf != null\n\t\t\t// ES6 classes inherit statics, so we want to avoid accessing inherited `__interfaces__`\n\t\t\t#if (js_es >= 6) && (cc.__super__ == null || cc.__super__.__interfaces__ != intf) #end\n\t\t) {\n\t\t\tfor (i in 0...intf.length) {\n\t\t\t\tvar i:Dynamic = intf[i];\n\t\t\t\tif (i == cl || __interfLoop(i, cl))\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn __interfLoop(cc.__super__, cl);\n\t}\n\n\t@:pure private static function __instanceof(o:Dynamic, cl:Dynamic) {\n\t\tif (cl == null)\n\t\t\treturn false;\n\t\tswitch (cl) {\n\t\t\tcase Int:\n\t\t\t\treturn js.Syntax.typeof(o) == \"number\" && js.Syntax.strictEq(o | 0, o);\n\t\t\tcase Float:\n\t\t\t\treturn js.Syntax.typeof(o) == \"number\";\n\t\t\tcase Bool:\n\t\t\t\treturn js.Syntax.typeof(o) == \"boolean\";\n\t\t\tcase String:\n\t\t\t\treturn js.Syntax.typeof(o) == \"string\";\n\t\t\tcase Array:\n\t\t\t\treturn js.Syntax.instanceof(o, Array) #if js_enums_as_arrays && o.__enum__ == null #end;\n\t\t\tcase Dynamic:\n\t\t\t\treturn o != null;\n\t\t\tdefault:\n\t\t\t\tif (o != null) {\n\t\t\t\t\t// Check if o is an instance of a Haxe class or a native JS object\n\t\t\t\t\tif (js.Syntax.typeof(cl) == \"function\") {\n\t\t\t\t\t\tif (__downcastCheck(o, cl))\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else if (js.Syntax.typeof(cl) == \"object\" && __isNativeObj(cl)) {\n\t\t\t\t\t\tif (js.Syntax.instanceof(o, cl))\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// do not use isClass/isEnum here\n\t\t\t\tuntyped __feature__(\"Class.*\", if (cl == Class && o.__name__ != null) return true);\n\t\t\t\tuntyped __feature__(\"Enum.*\", if (cl == Enum && o.__ename__ != null) return true);\n\t\t\t\t#if js_enums_as_arrays\n\t\t\t\treturn o.__enum__ == cl;\n\t\t\t\t#else\n\t\t\t\treturn untyped __feature__(\n\t\t\t\t\t\"has_enum\",\n\t\t\t\t\tif (o.__enum__ != null) ($hxEnums[o.__enum__]) == cl else false,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t\t\t#end\n\t\t}\n\t}\n\n\tstatic function __downcastCheck(o:Dynamic, cl:Class<Dynamic>):Bool {\n\t\treturn js.Syntax.instanceof(o, cl) || (isInterface(cl) && inline __implements(o, cl));\n\t}\n\n\tstatic function __implements(o:Dynamic, iface:Class<Dynamic>):Bool {\n\t\treturn __interfLoop(getClass(o), iface);\n\t}\n\n\t@:ifFeature(\"typed_cast\") private static function __cast(o:Dynamic, t:Dynamic) {\n\t\tif (o == null || __instanceof(o, t))\n\t\t\treturn o;\n\t\telse\n\t\t\tthrow \"Cannot cast \" + Std.string(o) + \" to \" + Std.string(t);\n\t}\n\n\tstatic var __toStr:js.lib.Function;\n\n\tstatic function __init__() {\n\t\tBoot.__toStr = (cast {}).toString;\n\t}\n\n\t// get native JS [[Class]]\n\tstatic function __nativeClassName(o:Dynamic):String {\n\t\tvar name:String = __toStr.call(o).slice(8, -1);\n\t\t// exclude general Object and Function\n\t\t// also exclude Math and JSON, because instanceof cannot be called on them\n\t\tif (name == \"Object\" || name == \"Function\" || name == \"Math\" || name == \"JSON\")\n\t\t\treturn null;\n\t\treturn name;\n\t}\n\n\t// check for usable native JS object\n\tstatic function __isNativeObj(o:Dynamic):Bool {\n\t\treturn __nativeClassName(o) != null;\n\t}\n\n\t// resolve native JS class in the global scope:\n\tstatic function __resolveNativeClass(name:String) {\n\t\treturn js.Lib.global[cast name];\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\npackage js;\n\nimport js.html.Storage;\nimport js.html.XMLHttpRequest;\n\nclass Browser {\n\t/** The global scope typed with fields available only in a worker context. */\n\tpublic static var self(get, never):js.html.WorkerGlobalScope;\n\n\tstatic inline function get_self():js.html.WorkerGlobalScope {\n\t\treturn js.Lib.global;\n\t}\n\n\t/** The global window object. */\n\tpublic static var window(get, never):js.html.Window;\n\n\textern inline static function get_window()\n\t\treturn js.Syntax.code(\"window\");\n\n\t/** Shortcut to Window.document. */\n\tpublic static var document(get, never):js.html.HTMLDocument;\n\n\textern inline static function get_document()\n\t\treturn window.document;\n\n\t/** Shortcut to Window.location. */\n\tpublic static var location(get, never):js.html.Location;\n\n\textern inline static function get_location()\n\t\treturn js.Lib.global.location;\n\n\t/** Shortcut to Window.navigator. */\n\tpublic static var navigator(get, never):js.html.Navigator;\n\n\textern inline static function get_navigator()\n\t\treturn js.Lib.global.navigator;\n\n\t/** Shortcut to Window.console. */\n\tpublic static var console(get, never):js.html.ConsoleInstance;\n\n\textern inline static function get_console()\n\t\treturn js.Lib.global.console;\n\n\t/**\n\t * True if a window object exists, false otherwise.\n\t *\n\t * This can be used to check if the code is being executed in a non-browser\n\t * environment such as node.js.\n\t */\n\tpublic static var supported(get, never):Bool;\n\n\tstatic function get_supported()\n\t\treturn\n\t\t\tjs.Syntax.typeof(window) != \"undefined\" &&\n\t\t\tjs.Syntax.typeof(window.location) != \"undefined\" &&\n\t\t\tjs.Syntax.typeof(window.location.protocol) == \"string\";\n\t/**\n\t * Safely gets the browser's local storage, or returns null if localStorage is unsupported or\n\t * disabled.\n\t */\n\tpublic static function getLocalStorage():Null<Storage> {\n\t\ttry {\n\t\t\tvar s = window.localStorage;\n\t\t\ts.getItem(\"\");\n\t\t\tif (s.length == 0) {\n\t\t\t\tvar key = \"_hx_\" + Math.random();\n\t\t\t\ts.setItem(key, key);\n\t\t\t\ts.removeItem(key);\n\t\t\t}\n\t\t\treturn s;\n\t\t} catch (e:Dynamic) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Safely gets the browser's session storage, or returns null if sessionStorage is unsupported\n\t * or disabled.\n\t */\n\tpublic static function getSessionStorage():Storage {\n\t\ttry {\n\t\t\tvar s = window.sessionStorage;\n\t\t\ts.getItem(\"\");\n\t\t\tif (s.length == 0) {\n\t\t\t\tvar key = \"_hx_\" + Math.random();\n\t\t\t\ts.setItem(key, key);\n\t\t\t\ts.removeItem(key);\n\t\t\t}\n\t\t\treturn s;\n\t\t} catch (e:Dynamic) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\t/**\n\t * Creates an XMLHttpRequest, with a fallback to ActiveXObject for ancient versions of Internet\n\t * Explorer.\n\t */\n\tpublic static function createXMLHttpRequest():XMLHttpRequest {\n\t\tif (js.Syntax.code(\"typeof XMLHttpRequest\") != \"undefined\") {\n\t\t\treturn new XMLHttpRequest();\n\t\t}\n\t\tif (js.Syntax.code(\"typeof ActiveXObject\") != \"undefined\") {\n\t\t\treturn js.Syntax.construct(\"ActiveXObject\", \"Microsoft.XMLHTTP\");\n\t\t}\n\t\tthrow \"Unable to create XMLHttpRequest object.\";\n\t}\n\n\t/**\n\t\tDisplay an alert message box containing the given message. See also `Window.alert()`.\n\t**/\n\tpublic static inline function alert(v:Dynamic) {\n\t\twindow.alert(Std.string(v));\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n\n// This file is generated from mozilla\\HTMLCanvasElement.webidl. Do not edit!\n\npackage js.html;\n\n/**\n\tThe `HTMLCanvasElement` interface provides properties and methods for manipulating the layout and presentation of canvas elements. The `HTMLCanvasElement` interface also inherits the properties and methods of the `HTMLElement` interface.\n\n\tDocumentation [HTMLCanvasElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement) by [Mozilla Contributors](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement$history), licensed under [CC-BY-SA 2.5](https://creativecommons.org/licenses/by-sa/2.5/).\n\n\t@see <https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement>\n**/\n@:native(\"HTMLCanvasElement\")\nextern class CanvasElement extends Element {\n\t\n\t/**\n\t\tIs a positive `integer` reflecting the `width` HTML attribute of the `canvas` element interpreted in CSS pixels. When the attribute is not specified, or if it is set to an invalid value, like a negative, the default value of `300` is used.\n\t**/\n\tvar width : Int;\n\t\n\t/**\n\t\tIs a positive `integer` reflecting the `height` HTML attribute of the `canvas` element interpreted in CSS pixels. When the attribute is not specified, or if it is set to an invalid value, like a negative, the default value of `150` is used.\n\t**/\n\tvar height : Int;\n\t\n\t\n\t/**\n\t\tReturns a drawing context on the canvas, or null if the context ID is not supported. A drawing context lets you draw on the canvas. Calling getContext with `\"2d\"` returns a `CanvasRenderingContext2D` object, whereas calling it with `\"webgl\"` (or `\"experimental-webgl\"`) returns a `WebGLRenderingContext` object. This context is only available on browsers that implement WebGL.\n\t\t@throws DOMError\n\t**/\n\tfunction getContext( contextId : String, ?contextOptions : Dynamic ) : Dynamic;\n\t\n\t/**\n\t\tReturns a data-URL containing a representation of the image in the format specified by the `type` parameter (defaults to `png`). The returned image is in a resolution of 96dpi.\n\t\t@throws DOMError\n\t**/\n\tfunction toDataURL( type : String = \"\", ?encoderOptions : Dynamic ) : String;\n\t\n\t/**\n\t\tCreates a `Blob` object representing the image contained in the canvas; this file may be cached on the disk or stored in memory at the discretion of the user agent.\n\t\t@throws DOMError\n\t**/\n\tfunction toBlob( callback : Blob -> Void, type : String = \"\", ?encoderOptions : Dynamic ) : Void;\n\t\n\t/**\n\t\tReturns a `CanvasCaptureMediaStream` that is a real-time video capture of the surface of the canvas.\n\t\t@throws DOMError\n\t**/\n\tfunction captureStream( ?frameRate : Float ) : CanvasCaptureMediaStream;\n\t\n\t/** Shorthand for getting a CanvasRenderingContext2D. */\n\tinline function getContext2d( ?attribs : {} ) : CanvasRenderingContext2D {\n\t\treturn cast getContext(\"2d\", attribs);\n\t}\n\t/** Shorthand for getting a js.html.webgl.RenderingContext. */\n\tinline function getContextWebGL( ?attribs : js.html.webgl.ContextAttributes ) : js.html.webgl.RenderingContext {\n\t\treturn CanvasUtil.getContextWebGL(this, attribs);\n\t}\n\t/** Shorthand for getting a js.html.webgl.WebGL2RenderingContext. */\n\tinline function getContextWebGL2( ?attribs : js.html.webgl.ContextAttributes ) : js.html.webgl.WebGL2RenderingContext {\n\t\treturn this.getContext('webgl2', attribs);\n\t}\n}\n\nprivate class CanvasUtil {\n\tpublic static function getContextWebGL( canvas :CanvasElement, attribs :{} ) {\n\t\tfor (name in [\"webgl\", \"experimental-webgl\"]) {\n\t\t\tvar ctx = canvas.getContext(name, attribs);\n\t\t\tif (ctx != null) return ctx;\n\t\t}\n\t\treturn null;\n\t}\n}\n","/*\n * Copyright (C)2005-2019 Haxe Foundation\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n */\n@:coreApi extern class String {\n\tvar length(default, null):Int;\n\n\t@:pure function new(string:String):Void;\n\t@:pure function toUpperCase():String;\n\t@:pure function toLowerCase():String;\n\t@:pure function charAt(index:Int):String;\n\t@:pure function indexOf(str:String, ?startIndex:Int):Int;\n\t@:pure function lastIndexOf(str:String, ?startIndex:Int):Int;\n\t@:pure function split(delimiter:String):Array<String>;\n\t@:pure function toString():String;\n\t@:pure function substring(startIndex:Int, ?endIndex:Int):String;\n\n\t@:pure inline function charCodeAt(index:Int):Null<Int> {\n\t\treturn @:privateAccess HxOverrides.cca(this, index);\n\t}\n\n\t@:pure inline function substr(pos:Int, ?len:Int):String {\n\t\treturn @:privateAccess HxOverrides.substr(this, pos, len);\n\t}\n\n\t@:pure static inline function fromCharCode(code:Int):String {\n\t\treturn untyped __define_feature__('String.fromCharCode', js.Syntax.code(\"String.fromCodePoint({0})\", code));\n\t}\n\n\tstatic function __init__():Void {\n\t\tuntyped __feature__('String.fromCharCode',\n\t\t\tjs.Syntax.code(\"if( String.fromCodePoint == null ) String.fromCodePoint = function(c) { return c < 0x10000 ? String.fromCharCode(c) : String.fromCharCode((c>>10)+0xD7C0)+String.fromCharCode((c&0x3FF)+0xDC00); }\"));\n\t}\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.util;\n\n#if macro\nimport haxe.macro.Context;\nimport haxe.macro.Expr;\nimport haxe.macro.Type;\n\nimport flambe.util.Logger;\n\n#else\n\n/**\n * Classes that extend PackageLog will have static logging methods generated for them. The methods\n * correspond to the methods in `Logger`.\n *\n * Creating a class that extends PackageLog at the base of your project is a convenient way to\n * include logging across a whole codebase. The package name is used as the log tag.\n *\n * ```haxe\n * // In src/foobar/Log.hx\n * class Log extends PackageLog {}\n *\n * // In src/foobar/something/deeper/Widget.hx\n * // (Importing foobar.Log is not needed, as Haxe automatically imports classes in parent directories)\n * Log.info(\"Hello world\"); // Logs \"foobar: Hello world\"\n * ```\n */\n@:autoBuild(flambe.util.PackageLog.build())\n#end\nclass PackageLog\n{\n#if macro\n    public static function build () :Array<Field>\n    {\n        var pos = Context.currentPos();\n        var cl = Context.getLocalClass().get();\n\n        var tag = Context.makeExpr(cl.pack.join(\".\"), pos);\n        var logger = Context.defined(\"flambe-server\")\n            ? macro flambe.server.Node.createLogger($tag)\n            : macro flambe.System.createLogger($tag);\n\n        return Macros.buildFields(macro {\n            var public__static__logger :flambe.util.Logger = $logger;\n\n            function inline__public__static__info (?text :String, ?args :Array<Dynamic>) {\n                logger.info(text, args);\n            }\n\n            function inline__public__static__warn (?text :String, ?args :Array<Dynamic>) {\n                logger.warn(text, args);\n            }\n\n            function inline__public__static__error (?text :String, ?args :Array<Dynamic>) {\n                logger.error(text, args);\n            }\n\n            function inline__public__static__log (level :flambe.util.Logger.LogLevel,\n                    ?text :String, ?args :Array<Dynamic>) {\n                logger.log(level, text, args);\n            }\n        }).concat(Context.getBuildFields());\n    }\n#end\n}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe;\n\nimport flambe.util.PackageLog;\n\n/**\n * Flambe's internal logger. Games should use their own by calling `System.createLogger()` or\n * extending `PackageLog`.\n */\nclass Log extends PackageLog {}\n","//\n// Flambe - Rapid game development\n// https://github.com/aduros/flambe/blob/master/LICENSE.txt\n\npackage flambe.platform;\n\nimport sys.FileSystem;\nimport sys.io.File;\n\nimport haxe.macro.Context;\n\nusing StringTools;\n\n/**\n * Creates the asset manifests from the files in /assets\n */\nclass ManifestBuilder\n{\n    macro public static function use (assetsDir :String)\n    {\n        switch (Context.getType(\"flambe.asset.Manifest\")) {\n        case TInst(cl,_):\n            var cl = cl.get();\n            var meta = cl.meta;\n\n            if (!assetsDir.endsWith(\"/\")) {\n                assetsDir += \"/\";\n            }\n\n            var data = {};\n            for (packName in FileSystem.readDirectory(assetsDir)) {\n                var entries = [];\n                if (FileSystem.isDirectory(assetsDir + packName)) {\n                    for (file in readRecursive(assetsDir + packName)) {\n                        var path = assetsDir + packName + \"/\" + file;\n                        entries.push({\n                            name: file,\n                            md5: Context.signature(File.getBytes(path)),\n                            bytes: FileSystem.stat(path).size,\n                        });\n                    }\n                }\n                Reflect.setField(data, packName, entries);\n            }\n\n            meta.remove(\"assets\");\n            meta.add(\"assets\", [macro $v{data}], cl.pos);\n\n        default:\n            throw \"assert\";\n        }\n\n        return macro {};\n    }\n\n    private static function readRecursive (root, dir = \"\")\n    {\n        var result = [];\n        for (file in readDirectoryNoHidden(root + \"/\" + dir)) {\n            var fullPath = root + \"/\" + dir + \"/\" + file;\n            var relPath = if (dir == \"\") file else dir + \"/\" + file;\n            if (FileSystem.isDirectory(fullPath)) {\n                result = result.concat(readRecursive(root, relPath));\n            } else {\n                result.push(relPath);\n            }\n        }\n        return result;\n    }\n\n    private static function readDirectoryNoHidden (dir :String)\n    {\n        if (dir.fastCodeAt(dir.length - 1) == \"/\".code) {\n            // Trim off the trailing slash. On Windows, FileSystem.exists() doesn't find directories\n            // with trailing slashes?\n            dir = dir.substr(0, -1);\n        }\n        return FileSystem.exists(dir) && FileSystem.isDirectory(dir) ?\n            FileSystem.readDirectory(dir).filter(\n                function (file) return file.fastCodeAt(0) != \".\".code) :\n            cast [];\n    }\n}\n","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{attrs:{\"id\":\"app\"}},[(_vm.ui)?_c(_vm.ui.def,_vm._b({tag:\"component\",staticClass:\"ui\",style:({ width: _vm.gameWidth + 'px' })},'component',_vm.uiprops,false)):_vm._e(),_c('canvas',{ref:\"canvas\"})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"app\">\n    <component\n      class=\"ui\"\n      v-if=\"ui\"\n      :is=\"ui.def\"\n      v-bind=\"uiprops\"\n      :style=\"{ width: gameWidth + 'px' }\"\n    />\n    <canvas ref=\"canvas\" />\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"App\",\n  data() {\n    return {\n      gameWidth: 1920,\n      gameHeight: 1080,\n      stack: [],\n    };\n  },\n  computed: {\n    ui() {\n      const last = this.stack.length - 1;\n      return this.stack[last];\n    },\n    uiprops() {\n      return { ...this.ui.props };\n    },\n  },\n  mounted() {\n    window.flambe = {\n      canvas: this.$refs.canvas,\n    };\n    const flambe = require(\"../build.hxml\");\n    this.stack = flambe.flambe.System.get_web().stack;\n    const sizer = flambe.game.Container.getSize;\n    window.addEventListener(\"resize\", this.layoutScale.bind(this, sizer));\n    this.layoutScale(sizer);\n    flambe.game.Main.start(this.gameWidth, this.gameHeight);\n  },\n  methods: {\n    layoutScale(sizer) {\n      var size = sizer(\n        this.gameWidth,\n        this.gameHeight,\n        window.innerWidth,\n        window.innerHeight\n      );\n      document.documentElement.style.setProperty(\"--layout-scale\", size.scale);\n      document.documentElement.style.setProperty(\"--layout-x\", size.x + \"px\");\n      document.documentElement.style.setProperty(\"--layout-y\", size.y + \"px\");\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n#app,\nhtml,\nbody {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  margin: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\nbody {\n  background: radial-gradient(\n      circle at 100% 50%,\n      transparent 20%,\n      #00d4f0 21%,\n      #00d4f0 34%,\n      transparent 35%,\n      transparent\n    ),\n    radial-gradient(\n        circle at 0% 50%,\n        transparent 20%,\n        #00d4f0 21%,\n        #00d4f0 34%,\n        transparent 35%,\n        transparent\n      )\n      0 -50px;\n  background-color: #eeeeee;\n  background-size: 75px 100px;\n}\n.ui {\n  position: absolute;\n  top: var(--layout-y);\n  left: var(--layout-x);\n  transform: scale(var(--layout-scale));\n  transform-origin: 0 0;\n}\ncanvas {\n  display: block;\n  width: 100%;\n  height: 100%;\n}\n#app {\n  width: 100%;\n  height: 100%;\n}\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=d3d46af6&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&id=d3d46af6&prod&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\nimport App from './App.vue'\n\nVue.config.productionTip = false\n\nnew Vue({\n  render: h => h(App),\n}).$mount('#app')\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&id=d3d46af6&prod&lang=scss&\""],"sourceRoot":""}